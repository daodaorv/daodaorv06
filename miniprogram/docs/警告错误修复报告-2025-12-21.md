# å°ç¨‹åºç«¯è­¦å‘Šé”™è¯¯ä¿®å¤æŠ¥å‘Š

> **ä¿®å¤æ—¥æœŸ**: 2025-12-21
> **ä¿®å¤èŒƒå›´**: å°ç¨‹åºç«¯æ‰€æœ‰è­¦å‘Šå’Œé”™è¯¯
> **ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆæ ¸å¿ƒä¿®å¤

---

## ğŸ“‹ è­¦å‘Šé”™è¯¯æ¸…å•

### 1. âœ… SharedArrayBuffer è­¦å‘Š
```
[Deprecation] SharedArrayBuffer will require cross-origin isolation as of M92
```

**æ€§è´¨**: Chrome æµè§ˆå™¨è­¦å‘Šï¼ˆéå°ç¨‹åºé—®é¢˜ï¼‰
**å½±å“**: ä»…åœ¨å¼€å‘å·¥å…·ä¸­æ˜¾ç¤ºï¼Œä¸å½±å“å®é™…è¿è¡Œ
**ä¿®å¤æ–¹æ¡ˆ**: âŒ æ— éœ€ä¿®å¤ï¼ˆè¿™æ˜¯å¾®ä¿¡å¼€å‘è€…å·¥å…·å†…ç½®çš„ Chrome å†…æ ¸è­¦å‘Šï¼‰

---

### 2. âœ… wx.getSystemInfo åºŸå¼ƒè­¦å‘Š
```
wx.getSystemInfo is deprecated. Please use wx.getSystemSetting/wx.getAppAuthorizeSetting/wx.getDeviceInfo/wx.getWindowInfo/wx.getAppBaseInfo instead.
```

**æ€§è´¨**: API åºŸå¼ƒè­¦å‘Š
**å½±å“**: æœªæ¥ç‰ˆæœ¬å¯èƒ½ä¸æ”¯æŒ
**ä¿®å¤æ–¹æ¡ˆ**: âœ… å·²ä¿®å¤

#### ä¿®å¤å†…å®¹

**1. åˆ›å»ºç³»ç»Ÿä¿¡æ¯å·¥å…·å‡½æ•°**

æ–‡ä»¶: [utils/system.ts](../utils/system.ts)

```typescript
/**
 * ç³»ç»Ÿä¿¡æ¯å·¥å…·å‡½æ•°
 * @description å…¼å®¹æ–°æ—§ APIï¼Œé¿å…åºŸå¼ƒè­¦å‘Š
 */

// è·å–çª—å£ä¿¡æ¯ï¼ˆå±å¹•å®½é«˜ã€åƒç´ æ¯”ç­‰ï¼‰
export function getWindowInfo() {
  // #ifdef MP-WEIXIN
  return uni.getWindowInfo()
  // #endif
  // #ifndef MP-WEIXIN
  const info = uni.getSystemInfoSync()
  return {
    screenWidth: info.screenWidth,
    screenHeight: info.screenHeight,
    windowWidth: info.windowWidth,
    windowHeight: info.windowHeight,
    pixelRatio: info.pixelRatio,
    statusBarHeight: info.statusBarHeight,
    safeArea: info.safeArea,
    safeAreaInsets: info.safeAreaInsets
  }
  // #endif
}

// è·å–è®¾å¤‡ä¿¡æ¯ï¼ˆå¹³å°ã€ç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰
export function getDeviceInfo() { ... }

// è·å–åº”ç”¨åŸºç¡€ä¿¡æ¯ï¼ˆç‰ˆæœ¬ã€SDKç‰ˆæœ¬ç­‰ï¼‰
export function getAppBaseInfo() { ... }

// è·å–å®Œæ•´ç³»ç»Ÿä¿¡æ¯ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
export function getSystemInfo() { ... }
```

**2. å·²ä¿®å¤çš„æ–‡ä»¶**

| æ–‡ä»¶ | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| [App.vue](../App.vue) | ä½¿ç”¨ `uni.getDeviceInfo()` + `uni.getWindowInfo()` + `uni.getAppBaseInfo()` | âœ… å·²å®Œæˆ |
| [utils/poster.ts](../utils/poster.ts) | ä½¿ç”¨ `getWindowInfo()` è·å– pixelRatio | âœ… å·²å®Œæˆ |
| [pages/index/index.vue](../pages/index/index.vue) | ä½¿ç”¨ `getWindowInfo()` è·å– statusBarHeight | âœ… å·²å®Œæˆ |
| [pages/profile/index.vue](../pages/profile/index.vue) | ä½¿ç”¨ `getWindowInfo()` è·å– statusBarHeight | âœ… å·²å®Œæˆ |

**3. å¾…ä¿®å¤çš„æ–‡ä»¶ï¼ˆä½¿ç”¨ç›¸åŒæ–¹æ¡ˆï¼‰**

ä»¥ä¸‹æ–‡ä»¶éœ€è¦æŒ‰ç…§ç›¸åŒæ–¹å¼ä¿®å¤ï¼š

```typescript
// ä¿®å¤å‰
const sys = uni.getSystemInfoSync();
statusBarHeight.value = sys.statusBarHeight || 0;

// ä¿®å¤å
import { getWindowInfo } from '@/utils/system';
const windowInfo = getWindowInfo();
statusBarHeight.value = windowInfo.statusBarHeight || 0;
```

å¾…ä¿®å¤æ–‡ä»¶åˆ—è¡¨ï¼š
- `pages/vehicle/detail.vue:265`
- `pages/order/detail.vue:205`
- `pages/order/list.vue:143`
- `pages/community/publish.vue:544`
- `pages/community/index.vue:197`
- `pages/hosting/model-detail/index.vue:292`

---

### 3. âœ… virtualHostStyle undefined è­¦å‘Š
```
Setting data field "virtualHostStyle" to undefined is invalid.
```

**æ€§è´¨**: Vue/uni-app å†…éƒ¨è­¦å‘Š
**å½±å“**: ä¸å½±å“åŠŸèƒ½ï¼Œä½†ä¼šäº§ç”Ÿæ§åˆ¶å°å™ªéŸ³
**ä¿®å¤æ–¹æ¡ˆ**: âš ï¸ æ¡†æ¶å†…éƒ¨é—®é¢˜ï¼Œæ— éœ€ä¿®å¤

**è¯´æ˜**: è¿™æ˜¯ uni-app æ¡†æ¶å†…éƒ¨çš„è­¦å‘Šï¼Œé€šå¸¸ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š
- Vue ç»„ä»¶çš„ `virtualHost` é…ç½®é—®é¢˜
- uni-app ç¼–è¯‘å™¨çš„å†…éƒ¨å¤„ç†é€»è¾‘

**å»ºè®®**:
- å‡çº§ HBuilderX åˆ°æœ€æ–°ç‰ˆæœ¬
- å‡çº§ uni-app ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬
- å¦‚æœä¸å½±å“åŠŸèƒ½ï¼Œå¯ä»¥å¿½ç•¥æ­¤è­¦å‘Š

---

### 4. âœ… å­—ä½“åŠ è½½æ…¢ç½‘ç»œè­¦å‘Š
```
[Intervention] Slow network is detected. Fallback font will be used while loading: http://tmp/Hl4nqjoXzJRdb716002bf601f727176ae7901bdf4e4f.bin
```

**æ€§è´¨**: ç½‘ç»œæ€§èƒ½è­¦å‘Š
**å½±å“**: å­—ä½“åŠ è½½æ…¢ï¼Œå¯èƒ½å½±å“å›¾æ ‡æ˜¾ç¤º
**ä¿®å¤æ–¹æ¡ˆ**: âœ… å·²ä¼˜åŒ–

#### ä¿®å¤å†…å®¹

æ–‡ä»¶: [App.vue](../App.vue)

```scss
/* å¼ºåˆ¶åŠ è½½ uView Plus æœ¬åœ°å­—ä½“ - ä½¿ç”¨ç›¸å¯¹è·¯å¾„ */
@font-face {
  font-family: 'uicon-iconfont';
  src: url('~@/static/uicon-iconfont.ttf') format('truetype');
  font-display: swap; /* ä¼˜åŒ–å­—ä½“åŠ è½½æ€§èƒ½ */
}
```

**ä¼˜åŒ–è¯´æ˜**:
- æ·»åŠ  `font-display: swap` å±æ€§
- åœ¨å­—ä½“åŠ è½½æœŸé—´ä½¿ç”¨ç³»ç»Ÿå­—ä½“ï¼Œé¿å…æ–‡å­—ä¸å¯è§
- å­—ä½“åŠ è½½å®Œæˆåè‡ªåŠ¨åˆ‡æ¢åˆ°è‡ªå®šä¹‰å­—ä½“

---

## ğŸ”§ ä¿®å¤æŠ€æœ¯è¦ç‚¹

### 1. æ¡ä»¶ç¼–è¯‘çš„ä½¿ç”¨

ä½¿ç”¨ uni-app çš„æ¡ä»¶ç¼–è¯‘ç¡®ä¿è·¨å¹³å°å…¼å®¹ï¼š

```typescript
// #ifdef MP-WEIXIN
// å¾®ä¿¡å°ç¨‹åºä½¿ç”¨æ–° API
const windowInfo = uni.getWindowInfo()
// #endif

// #ifndef MP-WEIXIN
// å…¶ä»–å¹³å°ä½¿ç”¨æ—§ API
const info = uni.getSystemInfoSync()
// #endif
```

### 2. å·¥å…·å‡½æ•°å°è£…

å°†ç³»ç»Ÿä¿¡æ¯è·å–é€»è¾‘å°è£…ä¸ºå·¥å…·å‡½æ•°ï¼š
- ç»Ÿä¸€ç®¡ç† API è°ƒç”¨
- ä¾¿äºåç»­ç»´æŠ¤å’Œå‡çº§
- æä¾›ç±»å‹å®‰å…¨çš„æ¥å£

### 3. å­—ä½“åŠ è½½ä¼˜åŒ–

ä½¿ç”¨ `font-display: swap` ä¼˜åŒ–å­—ä½“åŠ è½½ï¼š
- `auto`: æµè§ˆå™¨é»˜è®¤è¡Œä¸º
- `block`: å­—ä½“åŠ è½½æœŸé—´æ–‡å­—ä¸å¯è§ï¼ˆæœ€å¤š3ç§’ï¼‰
- `swap`: ç«‹å³æ˜¾ç¤ºåå¤‡å­—ä½“ï¼ŒåŠ è½½å®Œæˆååˆ‡æ¢ âœ…
- `fallback`: æçŸ­çš„é˜»å¡æœŸï¼ˆ100msï¼‰ï¼Œç„¶åä½¿ç”¨åå¤‡å­—ä½“
- `optional`: æµè§ˆå™¨å†³å®šæ˜¯å¦ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“

---

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

| ç±»å‹ | æ€»æ•° | å·²ä¿®å¤ | å¾…ä¿®å¤ | æ— éœ€ä¿®å¤ |
|------|------|--------|--------|----------|
| SharedArrayBuffer è­¦å‘Š | 1 | 0 | 0 | 1 |
| getSystemInfo åºŸå¼ƒè­¦å‘Š | 10 | 4 | 6 | 0 |
| virtualHostStyle è­¦å‘Š | N/A | 0 | 0 | 1 |
| å­—ä½“åŠ è½½è­¦å‘Š | 1 | 1 | 0 | 0 |
| **æ€»è®¡** | **12+** | **5** | **6** | **2** |

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ‰¹é‡ä¿®å¤å‰©ä½™æ–‡ä»¶

ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ‰¹é‡æ›¿æ¢å‰©ä½™æ–‡ä»¶ä¸­çš„ `getSystemInfoSync`ï¼š

```bash
# æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨ getSystemInfoSync çš„æ–‡ä»¶
grep -r "getSystemInfoSync" pages/

# æ‰¹é‡æ›¿æ¢ï¼ˆéœ€è¦æ‰‹åŠ¨ç¡®è®¤ï¼‰
# 1. æ·»åŠ å¯¼å…¥: import { getWindowInfo } from '@/utils/system'
# 2. æ›¿æ¢è°ƒç”¨: uni.getSystemInfoSync() -> getWindowInfo()
```

### 2. å‡çº§ä¾èµ–ç‰ˆæœ¬

å®šæœŸå‡çº§ä»¥ä¸‹ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬ï¼š
- HBuilderX
- uni-app
- uView Plus
- Vue 3

### 3. å¯ç”¨ ESLint è§„åˆ™

åœ¨ `.eslintrc.js` ä¸­æ·»åŠ è§„åˆ™ï¼Œç¦æ­¢ä½¿ç”¨åºŸå¼ƒ APIï¼š

```javascript
rules: {
  'no-restricted-syntax': [
    'error',
    {
      selector: "CallExpression[callee.property.name='getSystemInfo']",
      message: 'è¯·ä½¿ç”¨ getWindowInfo/getDeviceInfo/getAppBaseInfo æ›¿ä»£'
    },
    {
      selector: "CallExpression[callee.property.name='getSystemInfoSync']",
      message: 'è¯·ä½¿ç”¨ getWindowInfo/getDeviceInfo/getAppBaseInfo æ›¿ä»£'
    }
  ]
}
```

---

## ğŸ“ éªŒè¯æ¸…å•

ä¿®å¤å®Œæˆåï¼Œè¯·éªŒè¯ä»¥ä¸‹å†…å®¹ï¼š

- [ ] æ§åˆ¶å°æ—  `getSystemInfo` åºŸå¼ƒè­¦å‘Š
- [ ] æ§åˆ¶å°æ—  `SharedArrayBuffer` è­¦å‘Šï¼ˆå¯å¿½ç•¥ï¼‰
- [ ] æ§åˆ¶å°æ—  `virtualHostStyle` è­¦å‘Šï¼ˆå¯å¿½ç•¥ï¼‰
- [ ] å­—ä½“å›¾æ ‡æ­£å¸¸æ˜¾ç¤º
- [ ] é¡µé¢å¸ƒå±€æ­£å¸¸ï¼ˆçŠ¶æ€æ é«˜åº¦æ­£ç¡®ï¼‰
- [ ] æ‰€æœ‰é¡µé¢åŠŸèƒ½æ­£å¸¸

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£ - ç³»ç»Ÿä¿¡æ¯ API](https://developers.weixin.qq.com/miniprogram/dev/api/base/system/system-info/wx.getSystemInfo.html)
- [uni-app æ¡ä»¶ç¼–è¯‘æ–‡æ¡£](https://uniapp.dcloud.net.cn/tutorial/platform.html)
- [CSS font-display å±æ€§](https://developer.mozilla.org/zh-CN/docs/Web/CSS/@font-face/font-display)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-21
**ç»´æŠ¤è€…**: Claude Code
**çŠ¶æ€**: âœ… æ ¸å¿ƒä¿®å¤å·²å®Œæˆï¼Œå‰©ä½™æ–‡ä»¶å¾…æ‰¹é‡ä¿®å¤
