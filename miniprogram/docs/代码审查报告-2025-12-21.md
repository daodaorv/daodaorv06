# å°ç¨‹åºç«¯ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ–æŠ¥å‘Š

**é¡¹ç›®**: å¨å¨æˆ¿è½¦ç§Ÿèµå°ç¨‹åº (miniprogram)
**å®¡æŸ¥æ—¥æœŸ**: 2025-12-21
**å®¡æŸ¥èŒƒå›´**: å…¨é‡ä»£ç å®¡æŸ¥ã€ä¼˜åŒ–å’Œbugä¿®å¤

---

## ä¸€ã€é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®è§„æ¨¡ç»Ÿè®¡

| ç±»åˆ« | æ•°é‡ |
|------|------|
| **é¡µé¢æ€»æ•°** | 62 |
| **ç»„ä»¶æ€»æ•°** | 15 |
| **API æ¥å£æ–‡ä»¶** | 22 |
| **å·¥å…·å‡½æ•°æ–‡ä»¶** | 7 |
| **ç»„åˆå¼å‡½æ•°** | 6 (æ–°å¢4ä¸ª) |
| **çŠ¶æ€ç®¡ç†æ–‡ä»¶** | 5 |
| **ç±»å‹å®šä¹‰æ–‡ä»¶** | 8 |
| **æ€»ä»£ç è¡Œæ•°** | ~39,000 |

### 1.2 æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: uni-app 3 + Vue 3
- **è¯­è¨€**: TypeScript 5.1.6
- **UIç»„ä»¶åº“**: uView-Plus 3.6.18
- **çŠ¶æ€ç®¡ç†**: Pinia
- **æ ·å¼**: SCSS + uni.scss å˜é‡ç³»ç»Ÿ
- **ç¬¬ä¸‰æ–¹åº“**: dayjs, clipboard, qqmap-wx-jssdk

### 1.3 ä»£ç é‡æœ€å¤§çš„é¡µé¢ (Top 10)

| æ’å | é¡µé¢ | ä»£ç è¡Œæ•° |
|------|------|---------|
| 1 | pages/order/confirm.vue | 2,402 |
| 2 | pages/tour/booking.vue | 1,648 |
| 3 | pages/campsite/booking.vue | 1,611 |
| 4 | pages/community/publish.vue | 1,117 |
| 5 | pages/auth/login.vue | 1,034 |
| 6 | pages/tour/detail.vue | 1,024 |
| 7 | pages/campsite/detail.vue | 1,019 |
| 8 | pages/hosting/index.vue | 978 |
| 9 | pages/profile/promotion-center.vue | 946 |
| 10 | pages/special-offer/detail.vue | 923 |

---

## äºŒã€å·²ä¿®å¤çš„é—®é¢˜

### 2.1 é«˜ä¼˜å…ˆçº§é—®é¢˜ä¿®å¤

#### âœ… App.vue å¯åŠ¨é€»è¾‘ä¼˜åŒ–
**æ–‡ä»¶**: `App.vue`
- **é—®é¢˜**: `checkAndUpdateLoginStatus()` æœªæ­£ç¡®å¤„ç†å¼‚æ­¥ï¼Œconsole.log åº”ä½¿ç”¨ logger
- **ä¿®å¤**:
  - æ·»åŠ  `.catch()` å¤„ç†å¼‚æ­¥é”™è¯¯
  - å°† `console.log` æ›¿æ¢ä¸º `logger`
  - ä»…åœ¨å¼€å‘ç¯å¢ƒè¾“å‡ºç³»ç»Ÿä¿¡æ¯
  - ä¿®å¤èƒŒæ™¯è‰²ä¸ uni.scss ä¸ä¸€è‡´é—®é¢˜ (`#F5F7FA` â†’ `#F8F9FC`)

#### âœ… é¦–é¡µé˜²æŠ–æ ‡å¿—ä¿®å¤
**æ–‡ä»¶**: `pages/index/index.vue`
- **é—®é¢˜**: é˜²æŠ–æ ‡å¿—ä½¿ç”¨æ™®é€šå˜é‡ `let isLocating = false`ï¼Œå¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶
- **ä¿®å¤**: æ”¹ä¸ºå“åº”å¼æ•°æ® `const isLocating = ref(false)`
- **é¢å¤–ä¼˜åŒ–**:
  - æ·»åŠ å®Œæ•´çš„ç±»å‹å®šä¹‰ (Notice, Banner, CommunityItem, DatePickerData, DateConfirmData)
  - ä¿®å¤ç»„ä»¶å¼•ç”¨ç±»å‹ (`ref<InstanceType<typeof BookingForm> | null>(null)`)
  - æ”¹è¿›é”™è¯¯å¤„ç†çš„ç±»å‹å®‰å…¨

#### âœ… ç”¨æˆ·ä¿¡æ¯è§£æé”™è¯¯å¤„ç†
**æ–‡ä»¶**: `utils/auth.ts`
- **é—®é¢˜**: `JSON.parse` å¤±è´¥æ—¶æœªæ¸…ç†å¼‚å¸¸ç¼“å­˜
- **ä¿®å¤**: æ·»åŠ å†…å±‚ try-catchï¼Œè§£æå¤±è´¥æ—¶æ¸…ç†ç¼“å­˜å¹¶è®°å½•æ—¥å¿—

#### âœ… æ—¥å¿—ç³»ç»Ÿç¯å¢ƒæ£€æµ‹
**æ–‡ä»¶**: `utils/logger.ts`
- **é—®é¢˜**: ä½¿ç”¨ `@ts-ignore` ç»•è¿‡ç±»å‹æ£€æŸ¥
- **ä¿®å¤**: ä½¿ç”¨ try-catch å®‰å…¨æ£€æµ‹ `process.env.NODE_ENV`

#### âœ… è¯·æ±‚å“åº”éªŒè¯
**æ–‡ä»¶**: `utils/request.ts`
- **é—®é¢˜**: å“åº”æ•°æ®ç±»å‹è½¬æ¢ä¸å®‰å…¨
- **ä¿®å¤**: æ·»åŠ å“åº”æ•°æ®ç»“æ„éªŒè¯ï¼Œæ”¹è¿›é”™è¯¯å¯¹è±¡å¤„ç†

### 2.2 ç»„ä»¶é—®é¢˜ä¿®å¤

#### âœ… ConfirmDialog ç±»å‹å®šä¹‰
**æ–‡ä»¶**: `components/base/ConfirmDialog.vue`
- **é—®é¢˜**: emit å®šä¹‰ç¼ºå°‘ç±»å‹
- **ä¿®å¤**: æ·»åŠ å®Œæ•´çš„ emit ç±»å‹å®šä¹‰

#### âœ… ErrorState é¢œè‰²ç¡¬ç¼–ç 
**æ–‡ä»¶**: `components/base/ErrorState.vue`
- **é—®é¢˜**: ç¡¬ç¼–ç é¢œè‰²å€¼ `#FF4D4F`
- **ä¿®å¤**: æå–ä¸ºå¸¸é‡ï¼Œä¸ uni.scss ä¿æŒä¸€è‡´

#### âœ… NoticeBanner æ ·å¼è§„èŒƒ
**æ–‡ä»¶**: `components/base/NoticeBanner.vue`
- **é—®é¢˜**: ç¡¬ç¼–ç é¢œè‰²å€¼ï¼Œemit ç¼ºå°‘ç±»å‹
- **ä¿®å¤**:
  - ä½¿ç”¨ SCSS å˜é‡ (`$uni-bg-color-card`, `$uni-text-color`)
  - æ·»åŠ  emit ç±»å‹å®šä¹‰
  - æå–ä¸»é¢˜è‰²ä¸ºå¸¸é‡

---

## ä¸‰ã€æ–°å¢çš„å¯å¤ç”¨ä»£ç 

### 3.1 Composables (ç»„åˆå¼å‡½æ•°)

#### ğŸ“¦ useVerificationCode
**æ–‡ä»¶**: `composables/useVerificationCode.ts`
**ç”¨é€”**: éªŒè¯ç å€’è®¡æ—¶åŠŸèƒ½
**é€‚ç”¨é¡µé¢**: login, register, reset-password, bind-phone

```typescript
const { countdown, codeSending, codeButtonText, canSend, sendCode } = useVerificationCode({
  countdownSeconds: 60,
  sendCodeApi: authApi.sendCode,
  codeType: 'login'
})
```

#### ğŸ“¦ useContactSelector
**æ–‡ä»¶**: `composables/useContactSelector.ts`
**ç”¨é€”**: è”ç³»äººé€‰æ‹©å’Œç®¡ç†
**é€‚ç”¨é¡µé¢**: order/confirm, tour/booking, campsite/booking

```typescript
const {
  contactList,
  contactDisplayText,
  loadContacts,
  openContactSelector,
  handleContactSelect
} = useContactSelector()
```

#### ğŸ“¦ usePageAuth
**æ–‡ä»¶**: `composables/usePageAuth.ts`
**ç”¨é€”**: é¡µé¢è®¤è¯æ£€æŸ¥
**é€‚ç”¨é¡µé¢**: æ‰€æœ‰éœ€è¦ç™»å½•çš„é¡µé¢

```typescript
const { pageReady, redirectUrl } = usePageAuth({
  pagePath: '/pages/order/confirm',
  onSetup: (options) => loadOrderData(options.orderId)
})
```

#### ğŸ“¦ useListPagination
**æ–‡ä»¶**: `composables/useListPagination.ts`
**ç”¨é€”**: åˆ—è¡¨åˆ†é¡µã€ä¸‹æ‹‰åˆ·æ–°ã€ä¸Šæ‹‰åŠ è½½
**é€‚ç”¨é¡µé¢**: æ‰€æœ‰åˆ—è¡¨é¡µé¢

```typescript
const { list, loading, hasMore, isEmpty, refresh, loadMore } = useListPagination({
  fetchApi: orderApi.getOrderList,
  pageSize: 10
})
```

### 3.2 å¸¸é‡æ–‡ä»¶

#### ğŸ“¦ ä¸»é¢˜é¢œè‰²å¸¸é‡
**æ–‡ä»¶**: `constants/theme.ts`
**ç”¨é€”**: åœ¨ JS/TS ä¸­ä½¿ç”¨ç»Ÿä¸€çš„é¢œè‰²å€¼

```typescript
import { THEME_COLORS } from '@/constants'
// THEME_COLORS.primary === '#FF9F29'
```

#### ğŸ“¦ z-index å±‚çº§ç®¡ç†
**æ–‡ä»¶**: `constants/zIndex.ts`
**ç”¨é€”**: ç»Ÿä¸€ç®¡ç†å¼¹çª—å±‚çº§

```typescript
import { Z_INDEX } from '@/constants'
// Z_INDEX.MODAL === 10100
```

---

## å››ã€ä»£ç é‡å¤æ€§åˆ†æ

### 4.1 å·²è¯†åˆ«çš„é‡å¤æ¨¡å¼

| é‡å¤ç±»å‹ | å—å½±å“é¡µé¢æ•° | é‡å¤ä»£ç è¡Œæ•° | çŠ¶æ€ |
|---------|-----------|-----------|------|
| éªŒè¯ç å€’è®¡æ—¶ | 4 | ~60 | âœ… å·²æå– Composable |
| è”ç³»äººç®¡ç† | 3 | ~200 | âœ… å·²æå– Composable |
| é¡µé¢è®¤è¯æ£€æŸ¥ | 3+ | ~80 | âœ… å·²æå– Composable |
| åˆ—è¡¨åˆ†é¡µé€»è¾‘ | 10+ | ~150 | âœ… å·²æå– Composable |
| ä¿é™©æ–¹æ¡ˆé€‰æ‹© | 3 | ~150 | ğŸ“‹ å»ºè®®åç»­æå– |
| é™„åŠ æœåŠ¡é€‰æ‹© | 3 | ~120 | ğŸ“‹ å»ºè®®åç»­æå– |
| ä¼˜æƒ åˆ¸å¤„ç† | 3 | ~80 | ğŸ“‹ å»ºè®®åç»­æå– |

### 4.2 åç»­ä¼˜åŒ–å»ºè®®

é¢„è®¢æµç¨‹é¡µé¢ (order/confirm, tour/booking, campsite/booking) ä»å­˜åœ¨ä»¥ä¸‹å¯æå–çš„é‡å¤ä»£ç ï¼š

1. **ä¿é™©æ–¹æ¡ˆé€‰æ‹©ç»„ä»¶** - å»ºè®®æå–ä¸º `InsuranceSelector.vue`
2. **é™„åŠ æœåŠ¡é€‰æ‹©ç»„ä»¶** - å»ºè®®æå–ä¸º `ServiceSelector.vue`
3. **ä¼˜æƒ åˆ¸é€‰æ‹©é€»è¾‘** - å»ºè®®æå–ä¸º `useCouponSelector` Composable
4. **ä»·æ ¼è®¡ç®—é€»è¾‘** - å»ºè®®æå–ä¸º `usePriceCalculation` Composable

---

## äº”ã€æ½œåœ¨é—®é¢˜æ¸…å• (å¾…åç»­å¤„ç†)

### 5.1 ä¸­ä¼˜å…ˆçº§é—®é¢˜

| æ–‡ä»¶ | é—®é¢˜ | å»ºè®® |
|------|------|------|
| `api/payment.ts` | ç¼ºå°‘é‡‘é¢å‚æ•°éªŒè¯ | æ·»åŠ  amount > 0 éªŒè¯ |
| `api/order.ts` | page/limit æœªéªŒè¯èŒƒå›´ | æ·»åŠ  page >= 1, limit <= 100 éªŒè¯ |
| `api/vehicle.ts` | æ—¥æœŸå‚æ•°æœªéªŒè¯æ ¼å¼ | æ·»åŠ  ISO 8601 æ ¼å¼éªŒè¯ |
| `utils/location.ts` | å®šæ—¶å™¨åœ¨é¡µé¢å¸è½½æ—¶å¯èƒ½æœªæ¸…ç† | æ·»åŠ  onUnmounted æ¸…ç† |
| `utils/poster.ts` | Canvas åˆå§‹åŒ–é”™è¯¯å¤„ç†ä¸å®Œæ•´ | æ”¹è¿›é”™è¯¯ä¿¡æ¯ |

### 5.2 ä½ä¼˜å…ˆçº§é—®é¢˜

| æ–‡ä»¶ | é—®é¢˜ | å»ºè®® |
|------|------|------|
| `components/business/CityStorePicker.vue` | çƒ­é—¨åŸå¸‚ç¡¬ç¼–ç  | ä»é…ç½®æˆ– props è·å– |
| `components/business/RentDatePicker.vue` | z-index ä¸º 11000 | ä½¿ç”¨ Z_INDEX å¸¸é‡ |
| `components/business/VehicleCard.vue` | é»˜è®¤å›¾ç‰‡è·¯å¾„å¯èƒ½ä¸å­˜åœ¨ | éªŒè¯è·¯å¾„æˆ–ä½¿ç”¨å ä½å›¾ |

---

## å…­ã€æ–‡ä»¶å˜æ›´æ¸…å•

### 6.1 ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `App.vue` | å¯åŠ¨é€»è¾‘ä¼˜åŒ–ã€æ—¥å¿—è§„èŒƒã€èƒŒæ™¯è‰²ä¿®å¤ |
| `pages/index/index.vue` | é˜²æŠ–æ ‡å¿—ä¿®å¤ã€ç±»å‹å®šä¹‰å®Œå–„ |
| `utils/auth.ts` | JSON.parse é”™è¯¯å¤„ç†æ”¹è¿› |
| `utils/logger.ts` | ç¯å¢ƒæ£€æµ‹å®‰å…¨æ”¹è¿› |
| `utils/request.ts` | å“åº”æ•°æ®éªŒè¯æ”¹è¿› |
| `components/base/ConfirmDialog.vue` | emit ç±»å‹å®šä¹‰ |
| `components/base/ErrorState.vue` | é¢œè‰²å¸¸é‡æå– |
| `components/base/NoticeBanner.vue` | æ ·å¼å˜é‡ç»Ÿä¸€ã€emit ç±»å‹ |

### 6.2 æ–°å¢çš„æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `composables/useVerificationCode.ts` | éªŒè¯ç å€’è®¡æ—¶ |
| `composables/useContactSelector.ts` | è”ç³»äººé€‰æ‹©å™¨ |
| `composables/usePageAuth.ts` | é¡µé¢è®¤è¯æ£€æŸ¥ |
| `composables/useListPagination.ts` | åˆ—è¡¨åˆ†é¡µ |
| `composables/index.ts` | Composables ç»Ÿä¸€å¯¼å‡º |
| `constants/theme.ts` | ä¸»é¢˜é¢œè‰²å¸¸é‡ |
| `constants/zIndex.ts` | z-index å±‚çº§å¸¸é‡ |
| `constants/index.ts` | å¸¸é‡ç»Ÿä¸€å¯¼å‡º |

---

## ä¸ƒã€ä½¿ç”¨å»ºè®®

### 7.1 æ–°å¢ Composables çš„ä½¿ç”¨æ–¹å¼

```typescript
// ç»Ÿä¸€å¯¼å…¥
import {
  useVerificationCode,
  useContactSelector,
  usePageAuth,
  useListPagination
} from '@/composables'

// æˆ–å•ç‹¬å¯¼å…¥
import { useVerificationCode } from '@/composables/useVerificationCode'
```

### 7.2 å¸¸é‡çš„ä½¿ç”¨æ–¹å¼

```typescript
// ç»Ÿä¸€å¯¼å…¥
import { THEME_COLORS, Z_INDEX } from '@/constants'

// ä½¿ç”¨ç¤ºä¾‹
const iconColor = THEME_COLORS.primary
const popupZIndex = Z_INDEX.MODAL
```

### 7.3 åç»­å¼€å‘å»ºè®®

1. **æ–°é¡µé¢å¼€å‘æ—¶**ï¼šä¼˜å…ˆä½¿ç”¨å·²æå–çš„ Composablesï¼Œé¿å…é‡å¤ä»£ç 
2. **æ ·å¼å¼€å‘æ—¶**ï¼šä½¿ç”¨ uni.scss å˜é‡ï¼ŒJS ä¸­ä½¿ç”¨ THEME_COLORS å¸¸é‡
3. **å¼¹çª—å¼€å‘æ—¶**ï¼šä½¿ç”¨ Z_INDEX å¸¸é‡ç®¡ç†å±‚çº§
4. **åˆ—è¡¨é¡µé¢**ï¼šä½¿ç”¨ useListPagination å¤„ç†åˆ†é¡µé€»è¾‘
5. **éœ€è¦ç™»å½•çš„é¡µé¢**ï¼šä½¿ç”¨ usePageAuth å¤„ç†è®¤è¯æ£€æŸ¥

---

## å…«ã€æ€»ç»“

æœ¬æ¬¡ä»£ç å®¡æŸ¥å…±ï¼š

- âœ… ä¿®å¤ **8** ä¸ªé«˜ä¼˜å…ˆçº§é—®é¢˜
- âœ… æ–°å¢ **4** ä¸ªå¯å¤ç”¨ Composables
- âœ… æ–°å¢ **2** ä¸ªå¸¸é‡æ–‡ä»¶
- âœ… ç»Ÿä¸€ **3** ä¸ªç»„ä»¶çš„æ ·å¼è§„èŒƒ
- ğŸ“‹ è¯†åˆ« **12** ä¸ªå¾…åç»­å¤„ç†çš„é—®é¢˜

**ä»£ç è´¨é‡æå‡**ï¼š
- ç±»å‹å®‰å…¨æ€§æ˜¾è‘—æé«˜
- é”™è¯¯å¤„ç†æ›´åŠ å®Œå–„
- ä»£ç å¤ç”¨æ€§å¢å¼º
- æ ·å¼è§„èŒƒæ›´åŠ ç»Ÿä¸€

**é¢„è®¡å¯å‡å°‘é‡å¤ä»£ç **ï¼šçº¦ 500+ è¡Œï¼ˆé€šè¿‡ä½¿ç”¨æ–°å¢çš„ Composablesï¼‰

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-21
**å®¡æŸ¥å·¥å…·**: Claude Code
