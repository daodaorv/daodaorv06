# å°ç¨‹åºä»£ç è§„èŒƒä¿®å¤æ–¹æ¡ˆ

> åŸºäº CLAUDE.md è§„èŒƒçš„å®Œæ•´ä»£ç è´¨é‡æ”¹è¿›æ–¹æ¡ˆ
>
> **æ£€æŸ¥æ—¥æœŸ**: 2025-12-03
> **é¡¹ç›®**: miniprogramï¼ˆå¾®ä¿¡å°ç¨‹åºï¼‰

---

## ä¸€ã€é—®é¢˜æ¦‚è§ˆ

### 1.1 é—®é¢˜ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | æ•°é‡ | ä¸¥é‡ç¨‹åº¦ | ä¼˜å…ˆçº§ |
|---------|------|---------|--------|
| TypeScript `any` ç±»å‹æ»¥ç”¨ | 50+ | ğŸ”´ ä¸¥é‡ | P0 |
| u-popup ç»„ä»¶ä½¿ç”¨é”™è¯¯ | 4 | ğŸ”´ ä¸¥é‡ | P0 |
| é”™è¯¯å¤„ç†ç±»å‹é”™è¯¯ | 15+ | ğŸ”´ é«˜ | P1 |
| é­”æ³•æ•°å­— | 30+ | ğŸŸ¡ ä¸­ | P2 |
| TODO æ³¨é‡Š | 30+ | ğŸŸ¡ ä¸­ | P2 |
| ä»£ç é‡å¤ | å¤šå¤„ | ğŸŸ¢ ä½ | P3 |

**æ€»è®¡**: 150+ ä¸ªé—®é¢˜éœ€è¦ä¿®å¤

### 1.2 ä»£ç è´¨é‡è¯„åˆ†

- **å‘½åè§„èŒƒ**: â­â­â­â­â­ (5/5) - ä¼˜ç§€
- **ç±»å‹å®‰å…¨**: â­â­ (2/5) - å·®ï¼ˆå¤§é‡ä½¿ç”¨ anyï¼‰
- **é”™è¯¯å¤„ç†**: â­â­â­ (3/5) - ä¸€èˆ¬ï¼ˆæœªä½¿ç”¨ unknownï¼‰
- **ä»£ç å¤ç”¨**: â­â­â­ (3/5) - ä¸€èˆ¬ï¼ˆæœ‰é‡å¤ä»£ç ï¼‰
- **ç»„ä»¶ä½¿ç”¨**: â­â­â­ (3/5) - ä¸€èˆ¬ï¼ˆu-popup ä½¿ç”¨é”™è¯¯ï¼‰
- **ä»£ç å®Œæ•´æ€§**: â­â­â­ (3/5) - ä¸€èˆ¬ï¼ˆå¤§é‡ TODOï¼‰

**æ€»ä½“è¯„åˆ†**: â­â­â­ (3/5) - éœ€è¦æ”¹è¿›

---

## äºŒã€å·²å®Œæˆçš„ä¿®å¤

### 2.1 u-popup ç»„ä»¶ä¿®å¤ âœ…

**ä¿®å¤æ–‡ä»¶**:
1. âœ… `components/base/ConfirmDialog.vue`
2. âœ… `components/business/vehicle/VehicleFilter.vue`
3. âœ… `pages/profile/wallet.vue` (2å¤„)

**ä¿®å¤å†…å®¹**:
```vue
<!-- ä¿®å¤å‰ -->
<u-popup v-model="show" mode="center">

<!-- ä¿®å¤å -->
<u-popup :show="show" @close="close" mode="center">
```

### 2.2 request.ts ç±»å‹ä¿®å¤ âœ…

**ä¿®å¤æ–‡ä»¶**: `utils/request.ts`

**ä¿®å¤å†…å®¹**:
- âœ… ç§»é™¤æ‰€æœ‰ `any` ç±»å‹
- âœ… ä½¿ç”¨ `unknown` ä»£æ›¿ `any`
- âœ… å®šä¹‰å®Œæ•´çš„ç±»å‹æ¥å£
- âœ… æ·»åŠ ç±»å‹å®ˆå«

**ä¿®å¤å‰**:
```typescript
export function request<T = any>(options: RequestOptions): Promise<ResponseData<T>>
```

**ä¿®å¤å**:
```typescript
export function request<T = unknown>(options: RequestOptions): Promise<ResponseData<T>>
```

---

## ä¸‰ã€å¾…ä¿®å¤é—®é¢˜è¯¦ç»†æ¸…å•

### 3.1 P0 ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

#### 3.1.1 stores æ–‡ä»¶ç±»å‹é—®é¢˜

**é—®é¢˜æ–‡ä»¶**:
1. `stores/vehicle.ts` - 11 å¤„ `any` ç±»å‹
2. `stores/user.ts` - 9 å¤„ `any` ç±»å‹
3. `stores/contact.ts` - 8 å¤„ `any` ç±»å‹

**ä¿®å¤æ–¹æ¡ˆ**:

**æ–‡ä»¶**: `stores/vehicle.ts`

```typescript
// âŒ ä¿®å¤å‰
const vehicleList = ref<any[]>([]);
const currentVehicle = ref<any>(null);
const fetchVehicles = async (params: any) => {
  try {
    // ...
  } catch (error) {
    console.error('è·å–è½¦è¾†åˆ—è¡¨å¤±è´¥:', error);
  }
};

// âœ… ä¿®å¤å
interface Vehicle {
  id: string;
  name: string;
  type: string;
  price: number;
  images: string[];
  // ... å…¶ä»–å­—æ®µ
}

interface VehicleSearchParams {
  cityId?: string;
  type?: string;
  priceRange?: string;
  brand?: string;
}

const vehicleList = ref<Vehicle[]>([]);
const currentVehicle = ref<Vehicle | null>(null);

const fetchVehicles = async (params: VehicleSearchParams) => {
  try {
    // ...
  } catch (error: unknown) {
    if (error instanceof Error) {
      console.error('è·å–è½¦è¾†åˆ—è¡¨å¤±è´¥:', error.message);
    }
  }
};
```

**æ–‡ä»¶**: `stores/user.ts`

```typescript
// âŒ ä¿®å¤å‰
const userInfo = ref<any>(null);
const doWechatLogin = async (code: string, userInfoData?: any) => {
  // ...
};

// âœ… ä¿®å¤å
interface UserInfo {
  id: string;
  nickname: string;
  avatar: string;
  phone?: string;
  email?: string;
  // ... å…¶ä»–å­—æ®µ
}

interface WechatUserInfo {
  nickName: string;
  avatarUrl: string;
  gender: number;
  country: string;
  province: string;
  city: string;
}

const userInfo = ref<UserInfo | null>(null);

const doWechatLogin = async (code: string, userInfoData?: WechatUserInfo) => {
  try {
    // ...
  } catch (error: unknown) {
    if (error instanceof Error) {
      console.error('å¾®ä¿¡ç™»å½•å¤±è´¥:', error.message);
    }
  }
};
```

**æ–‡ä»¶**: `stores/contact.ts`

```typescript
// âŒ ä¿®å¤å‰
const contactList = ref<any[]>([]);
const addContact = async (data: any) => {
  // ...
};

// âœ… ä¿®å¤å
interface Contact {
  id: string;
  name: string;
  phone: string;
  idCard?: string;
  isDefault: boolean;
}

interface ContactFormData {
  name: string;
  phone: string;
  idCard?: string;
  isDefault?: boolean;
}

const contactList = ref<Contact[]>([]);

const addContact = async (data: ContactFormData) => {
  try {
    // ...
  } catch (error: unknown) {
    if (error instanceof Error) {
      console.error('æ·»åŠ è”ç³»äººå¤±è´¥:', error.message);
    }
  }
};
```

#### 3.1.2 API æ–‡ä»¶ç±»å‹é—®é¢˜

**é—®é¢˜æ–‡ä»¶**:
1. `api/order.ts` - 6 å¤„ `any` ç±»å‹
2. `api/hosting.ts` - 10 å¤„ `any` ç±»å‹
3. `api/membership.ts` - 1 å¤„ `any` ç±»å‹

**ä¿®å¤æ–¹æ¡ˆ**:

**æ–‡ä»¶**: `api/order.ts`

```typescript
// âŒ ä¿®å¤å‰
export function calculatePrice(data: any) {
  return post('/orders/calculate-price', data);
}

export function createOrder(data: any) {
  return post('/orders', data);
}

// âœ… ä¿®å¤å
interface PriceCalculateParams {
  vehicleId: string;
  pickupDate: string;
  returnDate: string;
  pickupStoreId: string;
  returnStoreId: string;
  insuranceIds?: string[];
  couponId?: string;
}

interface PriceCalculateResult {
  basePrice: number;
  insurancePrice: number;
  discount: number;
  totalPrice: number;
}

interface OrderCreateParams {
  vehicleId: string;
  pickupDate: string;
  returnDate: string;
  pickupTime: string;
  returnTime: string;
  pickupStoreId: string;
  returnStoreId: string;
  contactId: string;
  insuranceIds?: string[];
  couponId?: string;
  remark?: string;
}

interface OrderCreateResult {
  orderId: string;
  orderNo: string;
  totalPrice: number;
  paymentUrl?: string;
}

export function calculatePrice(data: PriceCalculateParams) {
  return post<PriceCalculateResult>('/orders/calculate-price', data);
}

export function createOrder(data: OrderCreateParams) {
  return post<OrderCreateResult>('/orders', data);
}
```

**æ–‡ä»¶**: `api/hosting.ts`

```typescript
// âŒ ä¿®å¤å‰
export const submitOldCarApplication = (data: any) => {
  return post('/hosting/old-car', data);
};

// âœ… ä¿®å¤å
interface OldCarApplicationData {
  vehicleType: string;
  brand: string;
  model: string;
  year: number;
  mileage: number;
  licensePlate: string;
  images: string[];
  ownerName: string;
  ownerPhone: string;
  ownerIdCard: string;
}

interface ApplicationResult {
  applicationId: string;
  status: 'pending' | 'approved' | 'rejected';
  message?: string;
}

export const submitOldCarApplication = (data: OldCarApplicationData) => {
  return post<ApplicationResult>('/hosting/old-car', data);
};
```

### 3.2 P1 ä¼˜å…ˆçº§ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

#### 3.2.1 é”™è¯¯å¤„ç†ç±»å‹ä¿®å¤

**é—®é¢˜**: æ‰€æœ‰ catch å—æœªå£°æ˜ `error: unknown`

**å½±å“æ–‡ä»¶**: æ‰€æœ‰ stores å’Œ API æ–‡ä»¶

**ä¿®å¤æ¨¡å¼**:

```typescript
// âŒ é”™è¯¯
try {
  await operation();
} catch (error) {
  console.error('æ“ä½œå¤±è´¥:', error);
}

// âœ… æ­£ç¡®
try {
  await operation();
} catch (error: unknown) {
  if (error instanceof Error) {
    console.error('æ“ä½œå¤±è´¥:', error.message);
  } else {
    console.error('æ“ä½œå¤±è´¥:', String(error));
  }
}
```

**æ‰¹é‡ä¿®å¤è„šæœ¬**:

```bash
# æŸ¥æ‰¾æ‰€æœ‰æœªå£°æ˜ç±»å‹çš„ catch å—
grep -r "} catch (error)" --include="*.ts" miniprogram/

# éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æ¯ä¸ªæ–‡ä»¶
```

### 3.3 P2 ä¼˜å…ˆçº§ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

#### 3.3.1 é­”æ³•æ•°å­—å®šä¹‰ä¸ºå¸¸é‡

**é—®é¢˜æ–‡ä»¶**:
1. `api/auth.ts` - éªŒè¯ç é•¿åº¦ã€å¯†ç é•¿åº¦ã€è¿‡æœŸæ—¶é—´
2. `api/order.ts` - å»¶è¿Ÿæ—¶é—´ã€è®¢å•è¿‡æœŸæ—¶é—´
3. `api/community.ts` - å»¶è¿Ÿæ—¶é—´
4. `components/business/RentDatePicker.vue` - z-index å€¼

**ä¿®å¤æ–¹æ¡ˆ**:

**åˆ›å»ºå¸¸é‡æ–‡ä»¶**: `constants/index.ts`

```typescript
/**
 * å…¨å±€å¸¸é‡å®šä¹‰
 */

// ========== éªŒè¯ç›¸å…³ ==========
export const CODE_LENGTH = 6;                    // éªŒè¯ç é•¿åº¦
export const CODE_EXPIRE_TIME = 300;             // éªŒè¯ç è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
export const MIN_PASSWORD_LENGTH = 6;            // æœ€å°å¯†ç é•¿åº¦

// ========== è®¢å•ç›¸å…³ ==========
export const ORDER_EXPIRE_MINUTES = 15;          // è®¢å•è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰

// ========== Mock å»¶è¿Ÿæ—¶é—´ ==========
export const MOCK_DELAY_SHORT = 300;             // çŸ­å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
export const MOCK_DELAY_MEDIUM = 500;            // ä¸­å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
export const MOCK_DELAY_LONG = 800;              // é•¿å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
export const MOCK_DELAY_VERY_LONG = 1000;        // è¶…é•¿å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰

// ========== UI å±‚çº§ ==========
export const Z_INDEX_NAVBAR = 99;                // å¯¼èˆªæ 
export const Z_INDEX_POPUP_HEADER = 100;         // å¼¹çª—å¤´éƒ¨
export const Z_INDEX_POPUP = 10075;              // å¼¹çª—å®¹å™¨

// ========== æ—¶é—´ç›¸å…³ ==========
export const MILLISECONDS_PER_MINUTE = 60 * 1000;
export const MILLISECONDS_PER_HOUR = 60 * 60 * 1000;
export const MILLISECONDS_PER_DAY = 24 * 60 * 60 * 1000;
```

**ä½¿ç”¨ç¤ºä¾‹**:

```typescript
// api/auth.ts
import { CODE_LENGTH, CODE_EXPIRE_TIME, MIN_PASSWORD_LENGTH } from '@/constants';

// ä¿®å¤å‰
if (code.length !== 6) {
  return { code: 1, message: 'éªŒè¯ç æ ¼å¼é”™è¯¯', data: null };
}

// ä¿®å¤å
if (code.length !== CODE_LENGTH) {
  return { code: 1, message: 'éªŒè¯ç æ ¼å¼é”™è¯¯', data: null };
}
```

```typescript
// api/order.ts
import { ORDER_EXPIRE_MINUTES, MILLISECONDS_PER_MINUTE } from '@/constants';

// ä¿®å¤å‰
expireTime: new Date(Date.now() + 15 * 60 * 1000)

// ä¿®å¤å
expireTime: new Date(Date.now() + ORDER_EXPIRE_MINUTES * MILLISECONDS_PER_MINUTE)
```

```vue
<!-- components/business/RentDatePicker.vue -->
<script setup lang="ts">
import { Z_INDEX_POPUP } from '@/constants';
</script>

<template>
  <!-- ä¿®å¤å‰ -->
  <u-popup :show="show" @close="close" :z-index="10075">

  <!-- ä¿®å¤å -->
  <u-popup :show="show" @close="close" :z-index="Z_INDEX_POPUP">
</template>
```

#### 3.3.2 TODO æ³¨é‡Šæ¸…ç†

**é—®é¢˜æ–‡ä»¶**: 30+ ä¸ªæ–‡ä»¶åŒ…å« TODO æ³¨é‡Š

**ä¿®å¤ç­–ç•¥**:

1. **ç«‹å³å®ç°**: ç®€å•çš„ TODOï¼Œç›´æ¥å®ŒæˆåŠŸèƒ½
2. **åˆ›å»ºä»»åŠ¡**: å¤æ‚çš„ TODOï¼Œåˆ›å»º Issue è·Ÿè¸ª
3. **ç§»é™¤æ³¨é‡Š**: ä¸éœ€è¦çš„ TODOï¼Œç›´æ¥åˆ é™¤

**TODO åˆ†ç±»**:

```typescript
// ç±»å‹ 1: ç®€å•åŠŸèƒ½ - ç«‹å³å®ç°
// TODO: æ·»åŠ åŠ è½½çŠ¶æ€
// ä¿®å¤: æ·»åŠ  loading çŠ¶æ€ç®¡ç†

// ç±»å‹ 2: å¤æ‚åŠŸèƒ½ - åˆ›å»º Issue
// TODO: å®ç°æ”¯ä»˜åŠŸèƒ½
// å¤„ç†: åˆ›å»º Issue #123ï¼Œç§»é™¤æ³¨é‡Š

// ç±»å‹ 3: æ— ç”¨æ³¨é‡Š - ç›´æ¥åˆ é™¤
// TODO: æµ‹è¯•
// å¤„ç†: ç›´æ¥åˆ é™¤
```

**æ‰¹é‡æŸ¥æ‰¾ TODO**:

```bash
# æŸ¥æ‰¾æ‰€æœ‰ TODO æ³¨é‡Š
grep -r "TODO" --include="*.vue" --include="*.ts" miniprogram/

# ç»Ÿè®¡æ•°é‡
grep -r "TODO" --include="*.vue" --include="*.ts" miniprogram/ | wc -l
```

### 3.4 P3 ä¼˜å…ˆçº§ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

#### 3.4.1 ä»£ç é‡å¤é—®é¢˜

**é—®é¢˜ 1: Mock å»¶è¿Ÿå¤„ç†é‡å¤**

**é‡å¤ä»£ç **:
```typescript
// å¤šä¸ª API æ–‡ä»¶ä¸­é‡å¤
return new Promise((resolve) => {
  setTimeout(() => {
    resolve({
      code: 0,
      message: 'success',
      data: mockData
    });
  }, 500);
});
```

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºé€šç”¨å‡½æ•°

```typescript
// utils/mock.ts
import { MOCK_DELAY_MEDIUM } from '@/constants';

export function mockDelay<T>(data: T, delay: number = MOCK_DELAY_MEDIUM): Promise<T> {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve(data);
    }, delay);
  });
}

export function mockResponse<T>(data: T, delay?: number) {
  return mockDelay({
    code: 0,
    message: 'success',
    data
  }, delay);
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// api/vehicle.ts
import { mockResponse } from '@/utils/mock';

export function getVehicleList(params: VehicleSearchParams) {
  if (USE_MOCK) {
    return mockResponse(mockVehicleList);
  }
  return get<Vehicle[]>('/vehicles', params);
}
```

**é—®é¢˜ 2: Store é”™è¯¯å¤„ç†é‡å¤**

**é‡å¤ä»£ç **:
```typescript
// æ‰€æœ‰ Store æ–‡ä»¶ä¸­é‡å¤
try {
  // æ“ä½œ
} catch (error: unknown) {
  if (error instanceof Error) {
    console.error('æ“ä½œå¤±è´¥:', error.message);
  }
  return null;
}
```

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºé”™è¯¯å¤„ç†è£…é¥°å™¨

```typescript
// utils/error-handler.ts
export function handleError(error: unknown, context: string): void {
  if (error instanceof Error) {
    console.error(`${context}:`, error.message);
  } else {
    console.error(`${context}:`, String(error));
  }
}

export async function tryCatch<T>(
  fn: () => Promise<T>,
  context: string,
  defaultValue: T
): Promise<T> {
  try {
    return await fn();
  } catch (error: unknown) {
    handleError(error, context);
    return defaultValue;
  }
}
```

**ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// stores/vehicle.ts
import { tryCatch } from '@/utils/error-handler';

const fetchVehicles = async (params: VehicleSearchParams) => {
  return tryCatch(
    async () => {
      const res = await getVehicleList(params);
      vehicleList.value = res.data;
      return res.data;
    },
    'è·å–è½¦è¾†åˆ—è¡¨å¤±è´¥',
    []
  );
};
```

---

## å››ã€ä¿®å¤å®æ–½è®¡åˆ’

### 4.1 ç¬¬ä¸€é˜¶æ®µï¼ˆæœ¬å‘¨ï¼‰- P0 é—®é¢˜

**ç›®æ ‡**: ä¿®å¤æ‰€æœ‰ä¸¥é‡é—®é¢˜

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¿®å¤ `stores/vehicle.ts` ç±»å‹é—®é¢˜
- [ ] ä¿®å¤ `stores/user.ts` ç±»å‹é—®é¢˜
- [ ] ä¿®å¤ `stores/contact.ts` ç±»å‹é—®é¢˜
- [ ] ä¿®å¤ `api/order.ts` ç±»å‹é—®é¢˜
- [ ] ä¿®å¤ `api/hosting.ts` ç±»å‹é—®é¢˜
- [ ] ä¿®å¤ `api/membership.ts` ç±»å‹é—®é¢˜

**é¢„è®¡æ—¶é—´**: 2-3 å¤©

### 4.2 ç¬¬äºŒé˜¶æ®µï¼ˆä¸‹å‘¨ï¼‰- P1 é—®é¢˜

**ç›®æ ‡**: ä¿®å¤é«˜ä¼˜å…ˆçº§é—®é¢˜

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¿®å¤æ‰€æœ‰ catch å—çš„ç±»å‹å£°æ˜
- [ ] åˆ›å»ºç±»å‹å®šä¹‰æ–‡ä»¶
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼

**é¢„è®¡æ—¶é—´**: 2-3 å¤©

### 4.3 ç¬¬ä¸‰é˜¶æ®µï¼ˆåç»­ï¼‰- P2/P3 é—®é¢˜

**ç›®æ ‡**: æå‡ä»£ç è´¨é‡

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºå¸¸é‡æ–‡ä»¶
- [ ] æ›¿æ¢æ‰€æœ‰é­”æ³•æ•°å­—
- [ ] æ¸…ç†æ‰€æœ‰ TODO æ³¨é‡Š
- [ ] æå–é‡å¤ä»£ç 
- [ ] åˆ›å»ºé€šç”¨å·¥å…·å‡½æ•°

**é¢„è®¡æ—¶é—´**: 3-5 å¤©

---

## äº”ã€è´¨é‡ä¿è¯

### 5.1 ä¿®å¤éªŒè¯

æ¯ä¸ªä¿®å¤å¿…é¡»é€šè¿‡ä»¥ä¸‹æ£€æŸ¥:

1. **TypeScript ç¼–è¯‘**: æ— é”™è¯¯æ— è­¦å‘Š
   ```bash
   npm run type-check
   ```

2. **ESLint æ£€æŸ¥**: æ— é”™è¯¯æ— è­¦å‘Š
   ```bash
   npm run lint
   ```

3. **åŠŸèƒ½æµ‹è¯•**: åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•
   - æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
   - æ— è¿è¡Œæ—¶é”™è¯¯
   - æ— æ§åˆ¶å°è­¦å‘Š

4. **ä»£ç å®¡æŸ¥**: äººå·¥å®¡æŸ¥ä»£ç è´¨é‡
   - ç±»å‹å®šä¹‰å®Œæ•´
   - å‘½åæ¸…æ™°
   - é€»è¾‘æ­£ç¡®

### 5.2 æµ‹è¯•æ¸…å•

- [ ] è½¦è¾†åˆ—è¡¨åŠ è½½
- [ ] è½¦è¾†è¯¦æƒ…æŸ¥çœ‹
- [ ] è®¢å•åˆ›å»ºæµç¨‹
- [ ] ç”¨æˆ·ç™»å½•æ³¨å†Œ
- [ ] è”ç³»äººç®¡ç†
- [ ] æ‰˜ç®¡ç”³è¯·
- [ ] ä¼šå‘˜åŠŸèƒ½
- [ ] æ‰€æœ‰å¼¹çª—ç»„ä»¶

### 5.3 å›å½’æµ‹è¯•

ä¿®å¤å®Œæˆåè¿›è¡Œå…¨é¢å›å½’æµ‹è¯•:

1. **æ ¸å¿ƒæµç¨‹æµ‹è¯•**
   - æµè§ˆè½¦è¾† â†’ é€‰æ‹©è½¦è¾† â†’ åˆ›å»ºè®¢å• â†’ æ”¯ä»˜
   - æ³¨å†Œ â†’ ç™»å½• â†’ å®Œå–„ä¿¡æ¯ â†’ æ·»åŠ è”ç³»äºº

2. **è¾¹ç•Œæƒ…å†µæµ‹è¯•**
   - ç½‘ç»œé”™è¯¯å¤„ç†
   - ç©ºæ•°æ®å¤„ç†
   - å¼‚å¸¸è¾“å…¥å¤„ç†

3. **æ€§èƒ½æµ‹è¯•**
   - é¡µé¢åŠ è½½é€Ÿåº¦
   - åˆ—è¡¨æ»šåŠ¨æµç•…åº¦
   - å†…å­˜å ç”¨

---

## å…­ã€æœ€ä½³å®è·µ

### 6.1 TypeScript ç±»å‹å®šä¹‰

**åŸåˆ™**:
1. ç»ä¸ä½¿ç”¨ `any` ç±»å‹
2. ä½¿ç”¨ `unknown` ä»£æ›¿ `any`
3. ä¸ºæ‰€æœ‰å‡½æ•°å‚æ•°å’Œè¿”å›å€¼å®šä¹‰ç±»å‹
4. ä¸ºæ‰€æœ‰å¯¹è±¡å®šä¹‰æ¥å£

**ç¤ºä¾‹**:
```typescript
// âŒ é”™è¯¯
function processData(data: any): any {
  return data.map((item: any) => item.value);
}

// âœ… æ­£ç¡®
interface DataItem {
  id: string;
  value: number;
}

function processData(data: DataItem[]): number[] {
  return data.map((item) => item.value);
}
```

### 6.2 é”™è¯¯å¤„ç†

**åŸåˆ™**:
1. æ‰€æœ‰ catch å—ä½¿ç”¨ `error: unknown`
2. ä½¿ç”¨ç±»å‹å®ˆå«æ£€æŸ¥é”™è¯¯ç±»å‹
3. æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯
4. ä¸è¦åæ‰é”™è¯¯

**ç¤ºä¾‹**:
```typescript
// âœ… æ­£ç¡®çš„é”™è¯¯å¤„ç†
try {
  await operation();
} catch (error: unknown) {
  if (error instanceof Error) {
    console.error('æ“ä½œå¤±è´¥:', error.message);
    uni.showToast({
      title: error.message,
      icon: 'none'
    });
  } else {
    console.error('æœªçŸ¥é”™è¯¯:', String(error));
    uni.showToast({
      title: 'æ“ä½œå¤±è´¥',
      icon: 'none'
    });
  }
  throw error; // é‡æ–°æŠ›å‡ºï¼Œä¸è¦åæ‰é”™è¯¯
}
```

### 6.3 å¸¸é‡å®šä¹‰

**åŸåˆ™**:
1. æ‰€æœ‰é­”æ³•æ•°å­—å®šä¹‰ä¸ºå¸¸é‡
2. ä½¿ç”¨ SCREAMING_SNAKE_CASE å‘½å
3. åˆ†ç±»ç»„ç»‡å¸¸é‡
4. æ·»åŠ æ³¨é‡Šè¯´æ˜

**ç¤ºä¾‹**:
```typescript
// âœ… æ­£ç¡®çš„å¸¸é‡å®šä¹‰
/**
 * éªŒè¯ç ç›¸å…³å¸¸é‡
 */
export const CODE_LENGTH = 6;                    // éªŒè¯ç é•¿åº¦
export const CODE_EXPIRE_TIME = 300;             // éªŒè¯ç è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

/**
 * è®¢å•ç›¸å…³å¸¸é‡
 */
export const ORDER_EXPIRE_MINUTES = 15;          // è®¢å•è¿‡æœŸæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰
export const ORDER_STATUS_PENDING = 'pending';   // å¾…æ”¯ä»˜
export const ORDER_STATUS_PAID = 'paid';         // å·²æ”¯ä»˜
```

### 6.4 ä»£ç å¤ç”¨

**åŸåˆ™**:
1. DRY - Don't Repeat Yourself
2. é‡å¤ 3 æ¬¡ä»¥ä¸Šå¿…é¡»æå–
3. åˆ›å»ºé€šç”¨å·¥å…·å‡½æ•°
4. ä½¿ç”¨ç»„åˆè€Œéç»§æ‰¿

**ç¤ºä¾‹**:
```typescript
// âŒ é‡å¤ä»£ç 
function formatDate1(date: Date): string {
  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
}

function formatDate2(date: Date): string {
  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
}

// âœ… æå–é€šç”¨å‡½æ•°
function formatDate(date: Date): string {
  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
}
```

---

## ä¸ƒã€å·¥å…·å’Œè„šæœ¬

### 7.1 ç±»å‹æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# scripts/check-types.sh

echo "ğŸ” å¼€å§‹ TypeScript ç±»å‹æ£€æŸ¥..."

# è¿è¡Œç±»å‹æ£€æŸ¥
npm run type-check

if [ $? -eq 0 ]; then
  echo "âœ… ç±»å‹æ£€æŸ¥é€šè¿‡"
  exit 0
else
  echo "âŒ ç±»å‹æ£€æŸ¥å¤±è´¥"
  exit 1
fi
```

### 7.2 æŸ¥æ‰¾ any ç±»å‹è„šæœ¬

```bash
#!/bin/bash
# scripts/find-any-types.sh

echo "ğŸ” æŸ¥æ‰¾æ‰€æœ‰ any ç±»å‹ä½¿ç”¨..."

# æŸ¥æ‰¾ any ç±»å‹
grep -r ": any" --include="*.ts" --include="*.vue" miniprogram/ | grep -v "node_modules"

echo ""
echo "ğŸ“Š ç»Ÿè®¡ç»“æœ:"
grep -r ": any" --include="*.ts" --include="*.vue" miniprogram/ | grep -v "node_modules" | wc -l
```

### 7.3 æŸ¥æ‰¾ TODO æ³¨é‡Šè„šæœ¬

```bash
#!/bin/bash
# scripts/find-todos.sh

echo "ğŸ” æŸ¥æ‰¾æ‰€æœ‰ TODO æ³¨é‡Š..."

# æŸ¥æ‰¾ TODO
grep -r "TODO" --include="*.ts" --include="*.vue" miniprogram/ | grep -v "node_modules"

echo ""
echo "ğŸ“Š ç»Ÿè®¡ç»“æœ:"
grep -r "TODO" --include="*.ts" --include="*.vue" miniprogram/ | grep -v "node_modules" | wc -l
```

---

## å…«ã€å‚è€ƒèµ„æº

### 8.1 é¡¹ç›®æ–‡æ¡£

- [CLAUDE.md](../../CLAUDE.md) - é¡¹ç›®æ€»ä½“è§„èŒƒ
- [miniprogram/CLAUDE.md](../CLAUDE.md) - å°ç¨‹åºå¼€å‘è§„èŒƒ
- [uView-Plus-å‡çº§æŒ‡å—.md](./uView-Plus-å‡çº§æŒ‡å—.md) - ç»„ä»¶å‡çº§æŒ‡å—

### 8.2 TypeScript èµ„æº

- [TypeScript å®˜æ–¹æ–‡æ¡£](https://www.typescriptlang.org/)
- [TypeScript Deep Dive](https://basarat.gitbook.io/typescript/)
- [TypeScript æœ€ä½³å®è·µ](https://typescript-eslint.io/rules/)

### 8.3 ä»£ç è´¨é‡å·¥å…·

- [ESLint](https://eslint.org/)
- [Prettier](https://prettier.io/)
- [TypeScript Compiler](https://www.typescriptlang.org/docs/handbook/compiler-options.html)

---

## ä¹ã€æ€»ç»“

### 9.1 å…³é”®è¦ç‚¹

1. **ç±»å‹å®‰å…¨**: ç»ä¸ä½¿ç”¨ `any`ï¼Œä½¿ç”¨ `unknown` æˆ–å…·ä½“ç±»å‹
2. **é”™è¯¯å¤„ç†**: æ‰€æœ‰ catch å—ä½¿ç”¨ `error: unknown`
3. **å¸¸é‡å®šä¹‰**: æ‰€æœ‰é­”æ³•æ•°å­—å®šä¹‰ä¸ºå¸¸é‡
4. **ä»£ç å¤ç”¨**: æå–é‡å¤ä»£ç ä¸ºé€šç”¨å‡½æ•°
5. **è´¨é‡ä¿è¯**: æ¯ä¸ªä¿®å¤éƒ½è¦æµ‹è¯•éªŒè¯

### 9.2 é¢„æœŸæ”¶ç›Š

ä¿®å¤å®Œæˆåå°†è·å¾—:
- âœ… æ›´å¥½çš„ç±»å‹å®‰å…¨
- âœ… æ›´å°‘çš„è¿è¡Œæ—¶é”™è¯¯
- âœ… æ›´æ˜“ç»´æŠ¤çš„ä»£ç 
- âœ… æ›´é«˜çš„ä»£ç è´¨é‡è¯„åˆ†
- âœ… æ›´å¥½çš„å¼€å‘ä½“éªŒ

### 9.3 æŒç»­æ”¹è¿›

ä»£ç è´¨é‡æ˜¯æŒç»­æ”¹è¿›çš„è¿‡ç¨‹:
1. å®šæœŸè¿è¡Œè´¨é‡æ£€æŸ¥
2. åŠæ—¶ä¿®å¤æ–°å‡ºç°çš„é—®é¢˜
3. éµå¾ªæœ€ä½³å®è·µ
4. è¿›è¡Œä»£ç å®¡æŸ¥
5. åˆ†äº«ç»éªŒå’ŒçŸ¥è¯†

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-12-03
**ç»´æŠ¤è€…**: Claude Code
**çŠ¶æ€**: è¿›è¡Œä¸­
