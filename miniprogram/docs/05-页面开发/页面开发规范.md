# å¨å¨æˆ¿è½¦å°ç¨‹åºé¡µé¢å¼€å‘è§„èŒƒ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0 | **åˆ›å»ºæ—¶é—´**: 2025-11-24 | **ç»´æŠ¤å›¢é˜Ÿ**: å¨å¨æˆ¿è½¦æŠ€æœ¯å›¢é˜Ÿ

> ğŸ“– **æœ¬æ–‡æ¡£è§„å®šäº†å°ç¨‹åºé¡µé¢å¼€å‘çš„æ ‡å‡†è§„èŒƒ**ï¼ŒåŒ…æ‹¬é¡µé¢ç»“æ„ã€è·¯ç”±ç®¡ç†ã€çŠ¶æ€ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸç­‰ã€‚

---

## ğŸ“‹ ç›®å½•

1. [é¡µé¢ç»“æ„è§„èŒƒ](#1-é¡µé¢ç»“æ„è§„èŒƒ)
2. [è·¯ç”±ç®¡ç†è§„èŒƒ](#2-è·¯ç”±ç®¡ç†è§„èŒƒ)
3. [çŠ¶æ€ç®¡ç†è§„èŒƒ](#3-çŠ¶æ€ç®¡ç†è§„èŒƒ)
4. [é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†](#4-é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†)
5. [æ•°æ®æµç®¡ç†è§„èŒƒ](#5-æ•°æ®æµç®¡ç†è§„èŒƒ)
6. [é¡µé¢é€šä¿¡è§„èŒƒ](#6-é¡µé¢é€šä¿¡è§„èŒƒ)
7. [æ€§èƒ½ä¼˜åŒ–è§„èŒƒ](#7-æ€§èƒ½ä¼˜åŒ–è§„èŒƒ)

---

## 1. é¡µé¢ç»“æ„è§„èŒƒ

### 1.1 æ ‡å‡†é¡µé¢ç»“æ„

```vue
<template>
  <!-- é¡µé¢å®¹å™¨ -->
  <view class="page-container" :class="pageClass">
    <!-- é¡¶éƒ¨çŠ¶æ€æ å ä½ -->
    <view class="status-bar" :style="{ height: statusBarHeight + 'px' }" />

    <!-- é¡µé¢å¤´éƒ¨ -->
    <view v-if="showHeader" class="page-header">
      <view class="nav-bar">
        <!-- è¿”å›æŒ‰é’® -->
        <view
          v-if="canGoBack"
          class="nav-back"
          @click="goBack"
        >
          <uni-icons type="back" size="20" color="#333" />
        </view>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <view class="nav-title">{{ pageTitle }}</view>

        <!-- å³ä¾§æ“ä½œæŒ‰é’® -->
        <view class="nav-actions">
          <slot name="nav-actions"></slot>
        </view>
      </view>
    </view>

    <!-- é¡µé¢ä¸»ä½“ -->
    <view class="page-content" :style="{ minHeight: contentMinHeight }">
      <!-- é¡µé¢å†…å®¹ -->
      <slot></slot>
    </view>

    <!-- é¡µé¢åº•éƒ¨ -->
    <view v-if="showFooter" class="page-footer">
      <slot name="footer"></slot>
    </view>

    <!-- å…¨å±€åŠ è½½ -->
    <view v-if="pageLoading" class="page-loading">
      <uni-load-more status="loading" />
    </view>
  </view>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnload } from 'vue'

// Propså®šä¹‰
interface PageProps {
  pageTitle?: string
  showHeader?: boolean
  showFooter?: boolean
  canGoBack?: boolean
  pageLoading?: boolean
  backgroundColor?: string
}

const props = withDefaults(defineProps<PageProps>(), {
  pageTitle: '',
  showHeader: true,
  showFooter: false,
  canGoBack: true,
  pageLoading: false,
  backgroundColor: '#ffffff'
})

// å“åº”å¼æ•°æ®
const statusBarHeight = ref(0)

// è®¡ç®—å±æ€§
const pageClass = computed(() => {
  return [
    `page-${getCurrentPages().length}`,
    props.backgroundColor ? `bg-${props.backgroundColor}` : ''
  ].filter(Boolean)
})

const contentMinHeight = computed(() => {
  const headerHeight = props.showHeader ? 88 : 0
  const footerHeight = props.showFooter ? 100 : 0
  const statusBar = statusBarHeight.value
  return `calc(100vh - ${statusBar}px - ${headerHeight}rpx - ${footerHeight}rpx)`
})

// æ–¹æ³•
const goBack = () => {
  const pages = getCurrentPages()
  if (pages.length > 1) {
    uni.navigateBack()
  } else {
    uni.switchTab({
      url: '/pages/home/index'
    })
  }
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  // è·å–çŠ¶æ€æ é«˜åº¦
  const systemInfo = uni.getSystemInfoSync()
  statusBarHeight.value = systemInfo.statusBarHeight || 0
})
</script>

<style scoped lang="scss">
.page-container {
  min-height: 100vh;
  background-color: v-bind(backgroundColor);
}

.status-bar {
  background-color: v-bind(backgroundColor);
}

.page-header {
  .nav-bar {
    display: flex;
    align-items: center;
    height: 88rpx;
    padding: 0 30rpx;
    background-color: v-bind(backgroundColor);
    border-bottom: 1rpx solid #f0f0f0;
  }

  .nav-back {
    width: 60rpx;
    height: 60rpx;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 30rpx;

    &:active {
      background-color: rgba(0, 0, 0, 0.1);
    }
  }

  .nav-title {
    flex: 1;
    text-align: center;
    font-size: 32rpx;
    font-weight: 600;
    color: #333;
    margin: 0 60rpx;
    @include text-ellipsis;
  }

  .nav-actions {
    display: flex;
    align-items: center;
    gap: 20rpx;
  }
}

.page-content {
  flex: 1;
  padding-bottom: env(safe-area-inset-bottom);
}

.page-footer {
  background-color: #ffffff;
  border-top: 1rpx solid #f0f0f0;
  padding-bottom: env(safe-area-inset-bottom);
}

.page-loading {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 9999;
}
</style>
```

### 1.2 é¡µé¢æ–‡ä»¶å‘½åè§„èŒƒ

**æ–‡ä»¶å‘½å**:
- **é¡µé¢ç›®å½•**: kebab-caseï¼ˆå¦‚ `vehicle-list/`ã€`user-profile/`ï¼‰
- **é¡µé¢æ–‡ä»¶**: `index.vue`ï¼ˆç»Ÿä¸€ä½¿ç”¨index.vueä½œä¸ºé¡µé¢æ–‡ä»¶åï¼‰
- **ç»„ä»¶æ–‡ä»¶**: PascalCaseï¼ˆå¦‚ `VehicleCard.vue`ï¼‰

**ç›®å½•ç»“æ„**:
```
pages/
â”œâ”€â”€ home/
â”‚   â””â”€â”€ index.vue
â”œâ”€â”€ vehicles/
â”‚   â”œâ”€â”€ index.vue           # åˆ—è¡¨é¡µ
â”‚   â”œâ”€â”€ detail.vue          # è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ filter.vue          # ç­›é€‰é¡µ
â”‚   â””â”€â”€ search.vue          # æœç´¢é¡µ
â”œâ”€â”€ order/
â”‚   â”œâ”€â”€ index.vue           # è®¢å•åˆ—è¡¨
â”‚   â”œâ”€â”€ create.vue          # åˆ›å»ºè®¢å•
â”‚   â”œâ”€â”€ detail.vue          # è®¢å•è¯¦æƒ…
â”‚   â””â”€â”€ payment.vue         # æ”¯ä»˜é¡µé¢
â””â”€â”€ components/             # é¡µé¢çº§ç»„ä»¶
    â”œâ”€â”€ OrderStatus.vue
    â””â”€â”€ PaymentFlow.vue
```

### 1.3 é¡µé¢ä»£ç ç»“æ„è§„èŒƒ

```vue
<template>
  <PageLayout
    :page-title="pageTitle"
    :can-go-back="canGoBack"
    :page-loading="pageLoading"
  >
    <!-- é¡µé¢ä¸»ä½“å†…å®¹ -->
    <view class="page-content">
      <!-- é¡µé¢å…·ä½“å†…å®¹ -->
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <template #footer>
      <view class="page-actions">
        <button @click="handleAction">æ“ä½œæŒ‰é’®</button>
      </view>
    </template>
  </PageLayout>
</template>

<script setup lang="ts">
import { ref, computed, onMounted, onUnload } from 'vue'
import { useStore } from '@/stores/user'
import PageLayout from '@/components/PageLayout.vue'

// é¡µé¢æ ‡é¢˜
defineOptions({
  navigationBarTitleText: 'é¡µé¢æ ‡é¢˜'
})

// çŠ¶æ€ç®¡ç†
const userStore = useStore()

// é¡µé¢çŠ¶æ€
const pageTitle = ref('é¡µé¢æ ‡é¢˜')
const canGoBack = ref(true)
const pageLoading = ref(false)

// é¡µé¢æ•°æ®
const pageData = ref({})
const listData = ref([])

// è®¡ç®—å±æ€§
const computedData = computed(() => {
  return pageData.value.processed || {}
})

// é¡µé¢æ–¹æ³•
const handleAction = async () => {
  try {
    pageLoading.value = true

    // ä¸šåŠ¡é€»è¾‘
    await apiCall()

    uni.showToast({
      title: 'æ“ä½œæˆåŠŸ',
      icon: 'success'
    })
  } catch (error) {
    uni.showToast({
      title: 'æ“ä½œå¤±è´¥',
      icon: 'error'
    })
  } finally {
    pageLoading.value = false
  }
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadPageData()
})

onUnload(() => {
  // é¡µé¢å¸è½½æ—¶æ¸…ç†å·¥ä½œ
  cleanup()
})

// ç§æœ‰æ–¹æ³•
const loadPageData = async () => {
  try {
    pageLoading.value = true
    const response = await api.getPageData()
    pageData.value = response.data
  } catch (error) {
    console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
  } finally {
    pageLoading.value = false
  }
}

const cleanup = () => {
  // æ¸…ç†å®šæ—¶å™¨ã€å–æ¶ˆç½‘ç»œè¯·æ±‚ç­‰
}
</script>

<style scoped lang="scss">
@import '@/styles/variables.scss';

.page-content {
  padding: 30rpx;
}

.page-actions {
  padding: 30rpx;
  background-color: #ffffff;
  border-top: 1rpx solid #f0f0f0;

  button {
    width: 100%;
    height: 88rpx;
    background-color: $primary-color;
    color: #ffffff;
    border-radius: 44rpx;
    font-size: 32rpx;
  }
}
</style>
```

---

## 2. è·¯ç”±ç®¡ç†è§„èŒƒ

### 2.1 è·¯ç”±é…ç½®è§„èŒƒ

**pages.jsoné…ç½®**:
```json
{
  "pages": [
    {
      "path": "pages/home/index",
      "style": {
        "navigationBarTitleText": "å¨å¨æˆ¿è½¦",
        "navigationBarBackgroundColor": "#ffffff",
        "navigationBarTextStyle": "black",
        "backgroundColor": "#f5f5f5",
        "enablePullDownRefresh": false
      }
    },
    {
      "path": "pages/vehicles/index",
      "style": {
        "navigationBarTitleText": "æˆ¿è½¦åˆ—è¡¨",
        "enablePullDownRefresh": true,
        "onReachBottomDistance": 100
      }
    }
  ],
  "tabBar": {
    "color": "#7A7E83",
    "selectedColor": "#007AFF",
    "backgroundColor": "#ffffff",
    "borderStyle": "black",
    "list": [
      {
        "pagePath": "pages/home/index",
        "text": "é¦–é¡µ",
        "iconPath": "static/tabbar/home.png",
        "selectedIconPath": "static/tabbar/home-active.png"
      }
    ]
  },
  "globalStyle": {
    "navigationBarTextStyle": "black",
    "navigationBarTitleText": "å¨å¨æˆ¿è½¦",
    "navigationBarBackgroundColor": "#ffffff",
    "backgroundColor": "#f5f5f5",
    "backgroundTextStyle": "dark"
  }
}
```

### 2.2 è·¯ç”±è·³è½¬è§„èŒƒ

**ç»Ÿä¸€çš„è·¯ç”±å·¥å…·å‡½æ•°**:
```typescript
// utils/router.ts

export interface NavigationOptions {
  url: string
  params?: Record<string, any>
  animationType?: 'pop-in' | 'slide-in-right' | 'fade-in'
  animationDuration?: number
  success?: () => void
  fail?: (error: any) => void
  complete?: () => void
}

class Router {
  /**
   * ä¿ç•™å½“å‰é¡µï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
   */
  push(options: NavigationOptions) {
    const url = this.buildUrl(options.url, options.params)

    return new Promise((resolve, reject) => {
      uni.navigateTo({
        url,
        animationType: options.animationType || 'pop-in',
        animationDuration: options.animationDuration || 300,
        success: () => {
          options.success?.()
          resolve(true)
        },
        fail: (error) => {
          options.fail?.(error)
          reject(error)
        },
        complete: options.complete
      })
    })
  }

  /**
   * å…³é—­å½“å‰é¡µé¢ï¼Œè·³è½¬åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
   */
  replace(options: NavigationOptions) {
    const url = this.buildUrl(options.url, options.params)

    return new Promise((resolve, reject) => {
      uni.redirectTo({
        url,
        success: () => {
          options.success?.()
          resolve(true)
        },
        fail: (error) => {
          options.fail?.(error)
          reject(error)
        },
        complete: options.complete
      })
    })
  }

  /**
   * å…³é—­æ‰€æœ‰é¡µé¢ï¼Œæ‰“å¼€åˆ°åº”ç”¨å†…çš„æŸä¸ªé¡µé¢
   */
  restart(options: NavigationOptions) {
    const url = this.buildUrl(options.url, options.params)

    return new Promise((resolve, reject) => {
      uni.reLaunch({
        url,
        success: () => {
          options.success?.()
          resolve(true)
        },
        fail: (error) => {
          options.fail?.(error)
          reject(error)
        },
        complete: options.complete
      })
    })
  }

  /**
   * è·³è½¬åˆ° tabBar é¡µé¢
   */
  switchTab(options: { url: string, success?: () => void, fail?: (error: any) => void }) {
    return new Promise((resolve, reject) => {
      uni.switchTab({
        url: options.url,
        success: () => {
          options.success?.()
          resolve(true)
        },
        fail: (error) => {
          options.fail?.(error)
          reject(error)
        }
      })
    })
  }

  /**
   * å…³é—­å½“å‰é¡µé¢ï¼Œè¿”å›ä¸Šä¸€é¡µé¢æˆ–å¤šçº§é¡µé¢
   */
  back(delta: number = 1) {
    return new Promise((resolve) => {
      uni.navigateBack({
        delta,
        success: resolve,
        fail: resolve
      })
    })
  }

  /**
   * æ„å»ºå¸¦å‚æ•°çš„URL
   */
  private buildUrl(url: string, params?: Record<string, any>) {
    if (!params || Object.keys(params).length === 0) {
      return url
    }

    const queryString = Object.entries(params)
      .map(([key, value]) => {
        const encodedValue = typeof value === 'object'
          ? encodeURIComponent(JSON.stringify(value))
          : encodeURIComponent(String(value))
        return `${key}=${encodedValue}`
      })
      .join('&')

    return `${url}${url.includes('?') ? '&' : '?'}${queryString}`
  }
}

export const router = new Router()
```

**è·¯ç”±ä½¿ç”¨ç¤ºä¾‹**:
```typescript
// åœ¨é¡µé¢ä¸­ä½¿ç”¨
import { router } from '@/utils/router'

// æ™®é€šè·³è½¬
const goToDetail = (id: string) => {
  router.push({
    url: '/pages/vehicles/detail',
    params: { id }
  })
}

// å¸¦å¤æ‚å‚æ•°è·³è½¬
const createOrder = (orderData: OrderData) => {
  router.push({
    url: '/pages/order/create',
    params: {
      data: orderData,
      source: 'vehicle-list'
    }
  })
}

// è¿”å›ä¸Šä¸€é¡µ
const goBack = () => {
  router.back()
}

// è·³è½¬åˆ°TabBaré¡µé¢
const goToHome = () => {
  router.switchTab({
    url: '/pages/home/index'
  })
}
```

### 2.3 è·¯ç”±å‚æ•°å¤„ç†

**è·å–è·¯ç”±å‚æ•°**:
```typescript
// composables/useRouteParams.ts
import { ref, onMounted } from 'vue'

export function useRouteParams<T = Record<string, any>>() {
  const params = ref<T>({} as T)

  onMounted(() => {
    const pages = getCurrentPages()
    const currentPage = pages[pages.length - 1]

    if (currentPage.options) {
      const routeParams = Object.entries(currentPage.options).reduce((acc, [key, value]) => {
        // å°è¯•è§£æJSONå‚æ•°
        try {
          const parsedValue = JSON.parse(decodeURIComponent(value))
          acc[key] = parsedValue
        } catch {
          acc[key] = decodeURIComponent(value)
        }
        return acc
      }, {} as T)

      params.value = routeParams
    }
  })

  return params
}

// ä½¿ç”¨ç¤ºä¾‹
const { params } = useRouteParams<{ id: string, data: OrderData }>()
```

---

## 3. çŠ¶æ€ç®¡ç†è§„èŒƒ

### 3.1 Pinia Store ç»“æ„è§„èŒƒ

**ç”¨æˆ·çŠ¶æ€ç®¡ç†ç¤ºä¾‹**:
```typescript
// stores/user.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { UserInfo, LoginParams } from '@/types/user'
import { userApi } from '@/api/user'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€
  const userInfo = ref<UserInfo | null>(null)
  const token = ref<string>('')
  const isLoggedIn = computed(() => !!token.value)

  // è®¡ç®—å±æ€§
  const displayName = computed(() => {
    return userInfo.value?.nickname || userInfo.value?.phone || 'ç”¨æˆ·'
  })

  const avatar = computed(() => {
    return userInfo.value?.avatar || '/static/default-avatar.png'
  })

  // åŠ¨ä½œ
  const login = async (params: LoginParams) => {
    try {
      const response = await userApi.login(params)
      const { token: accessToken, user } = response.data

      token.value = accessToken
      userInfo.value = user

      // æŒä¹…åŒ–å­˜å‚¨
      uni.setStorageSync('token', accessToken)
      uni.setStorageSync('userInfo', user)

      return response
    } catch (error) {
      console.error('ç™»å½•å¤±è´¥:', error)
      throw error
    }
  }

  const logout = async () => {
    try {
      await userApi.logout()
    } catch (error) {
      console.error('ç™»å‡ºæ¥å£è°ƒç”¨å¤±è´¥:', error)
    } finally {
      // æ¸…ç†æœ¬åœ°çŠ¶æ€
      token.value = ''
      userInfo.value = null

      // æ¸…ç†æŒä¹…åŒ–å­˜å‚¨
      uni.removeStorageSync('token')
      uni.removeStorageSync('userInfo')

      // è·³è½¬åˆ°ç™»å½•é¡µ
      uni.reLaunch({
        url: '/pages/login/index'
      })
    }
  }

  const updateUserInfo = (updates: Partial<UserInfo>) => {
    if (userInfo.value) {
      userInfo.value = { ...userInfo.value, ...updates }
      uni.setStorageSync('userInfo', userInfo.value)
    }
  }

  const initUserFromStorage = () => {
    try {
      const storedToken = uni.getStorageSync('token')
      const storedUserInfo = uni.getStorageSync('userInfo')

      if (storedToken && storedUserInfo) {
        token.value = storedToken
        userInfo.value = storedUserInfo
      }
    } catch (error) {
      console.error('ä»æœ¬åœ°å­˜å‚¨åˆå§‹åŒ–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
    }
  }

  return {
    // çŠ¶æ€
    userInfo: readonly(userInfo),
    token: readonly(token),

    // è®¡ç®—å±æ€§
    isLoggedIn,
    displayName,
    avatar,

    // åŠ¨ä½œ
    login,
    logout,
    updateUserInfo,
    initUserFromStorage
  }
})
```

### 3.2 è·¨é¡µé¢çŠ¶æ€å…±äº«

**å…¨å±€çŠ¶æ€ç®¡ç†**:
```typescript
// stores/global.ts
import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useGlobalStore = defineStore('global', () => {
  // å…¨å±€åŠ è½½çŠ¶æ€
  const globalLoading = ref(false)

  // ç½‘ç»œçŠ¶æ€
  const networkStatus = ref('unknown')

  // ç³»ç»Ÿä¿¡æ¯
  const systemInfo = ref(uni.getSystemInfoSync())

  // ä¸»é¢˜é…ç½®
  const theme = ref('light')

  // è®¾ç½®å…¨å±€åŠ è½½
  const setGlobalLoading = (loading: boolean) => {
    globalLoading.value = loading
    if (loading) {
      uni.showLoading({ title: 'åŠ è½½ä¸­...', mask: true })
    } else {
      uni.hideLoading()
    }
  }

  // ç›‘å¬ç½‘ç»œçŠ¶æ€
  const initNetworkStatus = () => {
    uni.getNetworkType({
      success: (res) => {
        networkStatus.value = res.networkType
      }
    })

    uni.onNetworkStatusChange((res) => {
      networkStatus.value = res.networkType
    })
  }

  return {
    globalLoading,
    networkStatus,
    systemInfo,
    theme,
    setGlobalLoading,
    initNetworkStatus
  }
})
```

---

## 4. é¡µé¢ç”Ÿå‘½å‘¨æœŸç®¡ç†

### 4.1 ç”Ÿå‘½å‘¨æœŸé’©å­ä½¿ç”¨è§„èŒƒ

```vue
<script setup lang="ts">
import { ref, onMounted, onUnmounted, onActivated, onDeactivated } from 'vue'

// é¡µé¢æ•°æ®
const pageData = ref({})
const timer = ref<number | null>(null)

// é¡µé¢æŒ‚è½½æ—¶æ‰§è¡Œ
onMounted(async () => {
  console.log('é¡µé¢æŒ‚è½½')

  // åŠ è½½é¡µé¢æ•°æ®
  await loadPageData()

  // åˆå§‹åŒ–å®šæ—¶å™¨
  startTimer()

  // ç›‘å¬äº‹ä»¶
  addEventListeners()
})

// é¡µé¢å¸è½½æ—¶æ‰§è¡Œ
onUnmounted(() => {
  console.log('é¡µé¢å¸è½½')

  // æ¸…ç†å®šæ—¶å™¨
  clearTimer()

  // ç§»é™¤äº‹ä»¶ç›‘å¬
  removeEventListeners()

  // å–æ¶ˆç½‘ç»œè¯·æ±‚
  cancelRequests()
})

// é¡µé¢æ¿€æ´»æ—¶æ‰§è¡Œï¼ˆé¡µé¢ç¼“å­˜ï¼‰
onActivated(() => {
  console.log('é¡µé¢æ¿€æ´»')

  // åˆ·æ–°æ•°æ®
  refreshData()
})

// é¡µé¢ç¼“å­˜æ—¶æ‰§è¡Œ
onDeactivated(() => {
  console.log('é¡µé¢ç¼“å­˜')

  // æš‚åœæ“ä½œ
  pauseOperations()
})

// ç§æœ‰æ–¹æ³•
const loadPageData = async () => {
  try {
    const response = await api.getPageData()
    pageData.value = response.data
  } catch (error) {
    console.error('åŠ è½½é¡µé¢æ•°æ®å¤±è´¥:', error)
  }
}

const startTimer = () => {
  timer.value = setInterval(() => {
    // å®šæ—¶ä»»åŠ¡
  }, 30000) as unknown as number
}

const clearTimer = () => {
  if (timer.value) {
    clearInterval(timer.value)
    timer.value = null
  }
}

const addEventListeners = () => {
  // æ·»åŠ äº‹ä»¶ç›‘å¬
}

const removeEventListeners = () => {
  // ç§»é™¤äº‹ä»¶ç›‘å¬
}

const cancelRequests = () => {
  // å–æ¶ˆæœªå®Œæˆçš„ç½‘ç»œè¯·æ±‚
}

const refreshData = async () => {
  // é¡µé¢æ¿€æ´»æ—¶åˆ·æ–°æ•°æ®
  await loadPageData()
}

const pauseOperations = () => {
  // é¡µé¢ç¼“å­˜æ—¶æš‚åœæ“ä½œ
  clearTimer()
}
</script>
```

### 4.2 é¡µé¢ç¼“å­˜ç®¡ç†

```typescript
// composables/usePageCache.ts
import { ref, onMounted, onUnmounted } from 'vue'

export function usePageCache(pageKey: string) {
  const cacheData = ref<any>(null)
  const lastCacheTime = ref<number>(0)
  const CACHE_DURATION = 5 * 60 * 1000 // 5åˆ†é’Ÿç¼“å­˜

  // ä¿å­˜é¡µé¢æ•°æ®åˆ°ç¼“å­˜
  const saveToCache = (data: any) => {
    const cacheInfo = {
      data,
      timestamp: Date.now()
    }

    try {
      uni.setStorageSync(pageKey, cacheInfo)
      cacheData.value = data
      lastCacheTime.value = cacheInfo.timestamp
    } catch (error) {
      console.error('ä¿å­˜ç¼“å­˜å¤±è´¥:', error)
    }
  }

  // ä»ç¼“å­˜åŠ è½½æ•°æ®
  const loadFromCache = () => {
    try {
      const cacheInfo = uni.getStorageSync(pageKey)

      if (cacheInfo && cacheInfo.data) {
        const now = Date.now()

        // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ
        if (now - cacheInfo.timestamp < CACHE_DURATION) {
          cacheData.value = cacheInfo.data
          lastCacheTime.value = cacheInfo.timestamp
          return cacheInfo.data
        } else {
          // æ¸…é™¤è¿‡æœŸç¼“å­˜
          uni.removeStorageSync(pageKey)
        }
      }
    } catch (error) {
      console.error('åŠ è½½ç¼“å­˜å¤±è´¥:', error)
    }

    return null
  }

  // æ¸…é™¤ç¼“å­˜
  const clearCache = () => {
    try {
      uni.removeStorageSync(pageKey)
      cacheData.value = null
      lastCacheTime.value = 0
    } catch (error) {
      console.error('æ¸…é™¤ç¼“å­˜å¤±è´¥:', error)
    }
  }

  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
  const hasValidCache = () => {
    if (!cacheData.value || !lastCacheTime.value) {
      return false
    }

    const now = Date.now()
    return now - lastCacheTime.value < CACHE_DURATION
  }

  // é¡µé¢å¸è½½æ—¶è‡ªåŠ¨ä¿å­˜æ•°æ®
  onMounted(() => {
    loadFromCache()
  })

  return {
    cacheData: readonly(cacheData),
    hasValidCache,
    saveToCache,
    loadFromCache,
    clearCache
  }
}
```

---

## 5. æ•°æ®æµç®¡ç†è§„èŒƒ

### 5.1 æ•°æ®è¯·æ±‚è§„èŒƒ

```typescript
// composables/useApiRequest.ts
import { ref, reactive } from 'vue'
import type { ApiResponse } from '@/types/api'

interface RequestOptions {
  immediate?: boolean
  onSuccess?: (data: any) => void
  onError?: (error: any) => void
  onFinish?: () => void
}

export function useApiRequest<T = any>(
  apiCall: (...args: any[]) => Promise<ApiResponse<T>>,
  options: RequestOptions = {}
) {
  const loading = ref(false)
  const data = ref<T | null>(null)
  const error = ref<any>(null)

  const execute = async (...args: any[]) => {
    try {
      loading.value = true
      error.value = null

      const response = await apiCall(...args)

      if (response.code === 0) {
        data.value = response.data
        options.onSuccess?.(response.data)
        return response.data
      } else {
        throw new Error(response.message || 'è¯·æ±‚å¤±è´¥')
      }
    } catch (err) {
      error.value = err
      options.onError?.(err)
      throw err
    } finally {
      loading.value = false
      options.onFinish?.()
    }
  }

  // ç«‹å³æ‰§è¡Œ
  if (options.immediate) {
    execute()
  }

  return {
    loading: readonly(loading),
    data: readonly(data),
    error: readonly(error),
    execute
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const { loading, data, error, execute } = useApiRequest(
  userApi.getUserInfo,
  {
    immediate: true,
    onSuccess: (userData) => {
      console.log('è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ:', userData)
    },
    onError: (error) => {
      console.error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error)
    }
  }
)
```

### 5.2 åˆ†é¡µæ•°æ®ç®¡ç†

```typescript
// composables/usePagination.ts
import { ref, computed, watch } from 'vue'
import type { ApiResponse } from '@/types/api'

interface PaginationConfig {
  pageSize?: number
  immediate?: boolean
}

export function usePagination<T = any>(
  apiCall: (params: any) => Promise<ApiResponse<T[]>>,
  config: PaginationConfig = {}
) {
  const pageSize = config.pageSize || 20
  const currentPage = ref(1)
  const listData = ref<T[]>([])
  const loading = ref(false)
  const hasMore = ref(true)
  const refreshing = ref(false)

  // æ€»æ•°æ®é‡
  const total = computed(() => listData.value.length)

  // å½“å‰é¡µæ•°æ®
  const currentPageData = computed(() => {
    const start = (currentPage.value - 1) * pageSize
    const end = start + pageSize
    return listData.value.slice(start, end)
  })

  // åŠ è½½æ•°æ®
  const loadData = async (isRefresh = false) => {
    if (loading.value) return

    try {
      loading.value = true
      refreshing.value = isRefresh

      const params = {
        page: currentPage.value,
        limit: pageSize,
        ...(!isRefresh && currentPage.value > 1 ? {} : { reset: true })
      }

      const response = await apiCall(params)
      const newData = response.data || []

      if (isRefresh || currentPage.value === 1) {
        listData.value = newData
      } else {
        listData.value.push(...newData)
      }

      hasMore.value = newData.length >= pageSize

    } catch (error) {
      console.error('åŠ è½½æ•°æ®å¤±è´¥:', error)
      uni.showToast({
        title: 'åŠ è½½å¤±è´¥',
        icon: 'error'
      })
    } finally {
      loading.value = false
      refreshing.value = false
    }
  }

  // åŠ è½½æ›´å¤š
  const loadMore = async () => {
    if (!hasMore.value || loading.value) return

    currentPage.value++
    await loadData()
  }

  // åˆ·æ–°æ•°æ®
  const refresh = async () => {
    currentPage.value = 1
    await loadData(true)
  }

  // é‡ç½®æ•°æ®
  const reset = () => {
    currentPage.value = 1
    listData.value = []
    hasMore.value = true
  }

  // ç›‘å¬é¡µé¢è§¦åº•
  watch(() => currentPage.value, (newPage) => {
    if (newPage > 1 && hasMore.value) {
      loadData()
    }
  })

  // ç«‹å³åŠ è½½
  if (config.immediate !== false) {
    loadData()
  }

  return {
    listData: readonly(listData),
    currentPageData: readonly(currentPageData),
    total,
    currentPage,
    loading,
    hasMore,
    refreshing,
    loadData,
    loadMore,
    refresh,
    reset
  }
}
```

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- **[ç»„ä»¶æ€»è§ˆ](../04-ç»„ä»¶æ–‡æ¡£/ç»„ä»¶æ€»è§ˆ.md)** - ç»„ä»¶ä½“ç³»æ¦‚è§ˆ
- **[ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹](../04-ç»„ä»¶æ–‡æ¡£/ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹.md)** - ç»„ä»¶ä½¿ç”¨æ¡ˆä¾‹
- **[çŠ¶æ€ç®¡ç†æŒ‡å—](./çŠ¶æ€ç®¡ç†æŒ‡å—.md)** - çŠ¶æ€ç®¡ç†è¯¦ç»†è¯´æ˜
- **[æ€§èƒ½ä¼˜åŒ–æŒ‡å—](./æ€§èƒ½ä¼˜åŒ–æŒ‡å—.md)** - æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ
- **[uni-appå¼€å‘æŒ‡å¯¼](./uni-appå¼€å‘æŒ‡å¯¼æ–‡æ¡£.md)** - æ¡†æ¶ä½¿ç”¨æŒ‡å—

---

**æ–‡æ¡£ç»´æŠ¤**: å¨å¨æˆ¿è½¦æŠ€æœ¯å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-11-24
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**ä¸‹æ¬¡å®¡æ ¸**: 2025-12-24