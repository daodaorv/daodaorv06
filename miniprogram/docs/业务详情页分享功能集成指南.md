# 业务详情页分享功能集成指南

**文档版本**: v1.0
**创建时间**: 2025-12-19
**适用页面**: 特惠套餐、社区内容、营地详情、旅游路线、托管中心

---

## 一、集成概述

本指南提供了为业务详情页快速集成分享功能的标准化方案。所有页面遵循统一的集成模式，确保代码一致性和可维护性。

### 已完成页面

✅ **房车详情页** (`pages/vehicle/detail.vue`) - 已完成集成，可作为参考示例

### 待集成页面

- ⏳ 特惠套餐页 (`pages/special-offer/detail.vue`)
- ⏳ 社区内容页 (`pages/community/detail.vue`)
- ⏳ 营地详情页 (`pages/campsite/detail.vue`)
- ⏳ 旅游路线页 (`pages/tour/detail.vue`)
- ⏳ 托管中心页 (`pages/hosting/index.vue`)

---

## 二、集成步骤

### 步骤1: 导入依赖

在 `<script setup>` 部分添加以下导入：

```typescript
import { onShareAppMessage } from '@dcloudio/uni-app';
import { useShare } from '@/composables/useShare';
import { ShareScene } from '@/types/share';
import ShareSheet from '@/components/share/ShareSheet.vue';
import PosterPreview from '@/components/share/PosterPreview.vue';
```

### 步骤2: 初始化分享功能

根据不同页面类型，使用对应的 ShareScene：

```typescript
// 分享功能
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: '【叨叨房车】页面标题',
  desc: '页面描述',
  imageUrl: '分享图片URL',
  path: '/pages/xxx/detail',
  scene: ShareScene.XXX, // 根据页面类型选择
  businessId: 'business_id',
  query: {
    id: 'business_id'
  }
});
```

### 步骤3: 配置微信分享

在 `onLoad` 之后添加：

```typescript
// 配置微信分享
onShareAppMessage(() => {
  return getShareContent();
});

// 打开分享面板
const handleShare = () => {
  openShareSheet();
};
```

### 步骤4: 处理分享来源

在 `onLoad` 函数中添加分享来源处理：

```typescript
onLoad((options: any) => {
  // 现有代码...

  // 处理分享来源
  if (options.share_from) {
    logger.info('来自分享', {
      scene: options.share_scene,
      from: options.share_from,
      businessId: options.share_id
    });
  }
});
```

### 步骤5: 添加分享按钮

在页面合适位置添加分享按钮（通常在标题栏右侧）：

```vue
<view class="share-btn" @tap="handleShare">
  <u-icon name="share" size="20" color="#333"></u-icon>
</view>
```

### 步骤6: 添加分享组件

在 `</view>` 结束标签前添加分享组件：

```vue
<!-- 分享面板 -->
<ShareSheet
  v-model:show="showShareSheet"
  @select="handleShareSelect"
/>

<!-- 海报预览 -->
<PosterPreview
  v-model:show="showPosterPopup"
  :poster-image="posterImage"
  @save="savePoster"
/>
```

---

## 三、各页面具体配置

### 3.1 特惠套餐页 (`pages/special-offer/detail.vue`)

```typescript
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: `【叨叨房车】${offerDetail.value.route.from}→${offerDetail.value.route.to} 特惠套餐`,
  desc: `¥${offerDetail.value.packagePrice}/${offerDetail.value.rentalDays}天，仅剩${offerDetail.value.remainingQuota}个名额`,
  imageUrl: offerDetail.value.vehicle.images[0],
  path: '/pages/special-offer/detail',
  scene: ShareScene.SPECIAL_OFFER,
  businessId: offerDetail.value.id || 'demo_offer',
  query: {
    id: offerDetail.value.id || 'demo_offer'
  }
});
```

**分享按钮位置**: 在套餐基本信息卡片的右上角

### 3.2 社区内容页 (`pages/community/detail.vue`)

```typescript
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: `【叨叨房车社区】${post.value.title}`,
  desc: post.value.content.substring(0, 50) + '...',
  imageUrl: post.value.images[0] || '/static/default-share.jpg',
  path: '/pages/community/detail',
  scene: ShareScene.COMMUNITY,
  businessId: post.value.id || 'demo_post',
  query: {
    id: post.value.id || 'demo_post'
  }
});
```

**分享按钮位置**: 在帖子标题右侧或底部操作栏

**特殊说明**: 社区内容分享可为作者带来曝光奖励积分

### 3.3 营地详情页 (`pages/campsite/detail.vue`)

```typescript
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: `【叨叨房车】${campsite.value.name}`,
  desc: `${campsite.value.location} | ¥${campsite.value.price}/晚 | ${campsite.value.rating}分`,
  imageUrl: campsite.value.images[0],
  path: '/pages/campsite/detail',
  scene: ShareScene.CAMPSITE,
  businessId: campsite.value.id || 'demo_campsite',
  query: {
    id: campsite.value.id || 'demo_campsite'
  }
});
```

**分享按钮位置**: 在营地名称右侧

### 3.4 旅游路线页 (`pages/tour/detail.vue`)

```typescript
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: `【叨叨房车】${tour.value.name}`,
  desc: `${tour.value.days}天${tour.value.days - 1}晚 | ${tour.value.route} | ¥${tour.value.price}/人`,
  imageUrl: tour.value.images[0],
  path: '/pages/tour/detail',
  scene: ShareScene.TOUR,
  businessId: tour.value.id || 'demo_tour',
  query: {
    id: tour.value.id || 'demo_tour'
  }
});
```

**分享按钮位置**: 在路线标题右侧

**特殊说明**: 显示"XX位好友已报名"增加社交信任背书

### 3.5 托管中心页 (`pages/hosting/index.vue`)

```typescript
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: '【叨叨房车】车辆托管服务',
  desc: '专业托管，轻松赚钱，让您的房车为您创造收益',
  imageUrl: '/static/hosting-share.jpg',
  path: '/pages/hosting/index',
  scene: ShareScene.HOSTING,
  businessId: 'hosting_center',
  query: {}
});
```

**分享按钮位置**: 在页面右上角

**特殊说明**:
- 隐私保护：不显示个人收益数据
- 仅展示托管政策和服务优势

---

## 四、ShareScene 枚举对照表

| 页面类型 | ShareScene 值 | 说明 |
|---------|--------------|------|
| 房车详情 | `ShareScene.VEHICLE` | 已完成 |
| 特惠套餐 | `ShareScene.SPECIAL_OFFER` | 待集成 |
| 社区内容 | `ShareScene.COMMUNITY` | 待集成 |
| 营地详情 | `ShareScene.CAMPSITE` | 待集成 |
| 旅游路线 | `ShareScene.TOUR` | 待集成 |
| 托管中心 | `ShareScene.HOSTING` | 待集成 |
| 邀请好友 | `ShareScene.INVITE` | 已完成 |

---

## 五、完整代码示例

以下是房车详情页的完整集成示例（已完成）：

### Template 部分

```vue
<template>
  <view class="vehicle-detail-page">
    <!-- 页面内容 -->
    <view class="info-card">
      <view class="header-row">
        <view class="title-wrap">
          <text class="vehicle-name">{{ vehicle.name }}</text>
        </view>
        <!-- 分享按钮 -->
        <view class="share-btn" @tap="handleShare">
          <u-icon name="share" size="20" color="#333"></u-icon>
        </view>
      </view>
    </view>

    <!-- 其他内容... -->

    <!-- 分享面板 -->
    <ShareSheet
      v-model:show="showShareSheet"
      @select="handleShareSelect"
    />

    <!-- 海报预览 -->
    <PosterPreview
      v-model:show="showPosterPopup"
      :poster-image="posterImage"
      @save="savePoster"
    />
  </view>
</template>
```

### Script 部分

```typescript
<script setup lang="ts">
import { logger } from '@/utils/logger';
import { ref } from 'vue';
import { onLoad, onShareAppMessage } from '@dcloudio/uni-app';
import { useShare } from '@/composables/useShare';
import { ShareScene } from '@/types/share';
import ShareSheet from '@/components/share/ShareSheet.vue';
import PosterPreview from '@/components/share/PosterPreview.vue';

// 页面数据
const vehicle = ref({
  id: '',
  name: '上汽大通RG10 生活家V90',
  // ...其他字段
});

const vehicleImages = ref([
  '/static/场景推荐2.jpg',
  // ...其他图片
]);

// 分享功能
const {
  showShareSheet,
  showPosterPopup,
  posterImage,
  openShareSheet,
  handleShareSelect,
  savePoster,
  getShareContent
} = useShare({
  title: `【叨叨房车】${vehicle.value.name}`,
  desc: `日均¥${vehicle.value.price}起，${vehicle.value.type}，${vehicle.value.seats}座${vehicle.value.beds}卧`,
  imageUrl: vehicleImages.value[0],
  path: '/pages/vehicle/detail',
  scene: ShareScene.VEHICLE,
  businessId: vehicle.value.id || 'demo_vehicle',
  query: {
    id: vehicle.value.id || 'demo_vehicle'
  }
});

onLoad((options: any) => {
  // 加载页面数据
  if (options.id) {
    vehicle.value.id = options.id;
    logger.debug('加载车辆详情:', options.id);
  }

  // 处理分享来源
  if (options.share_from) {
    logger.info('来自分享', {
      scene: options.share_scene,
      from: options.share_from,
      businessId: options.share_id
    });
  }
});

// 配置微信分享
onShareAppMessage(() => {
  return getShareContent();
});

// 打开分享面板
const handleShare = () => {
  openShareSheet();
};
</script>
```

---

## 六、注意事项

### 6.1 数据安全

- ✅ 托管中心页面不显示个人收益数据
- ✅ 所有敏感信息需要脱敏处理
- ✅ 分享链接中不包含敏感参数

### 6.2 用户体验

- ✅ 分享按钮位置醒目但不突兀
- ✅ 分享文案简洁有吸引力
- ✅ 分享图片清晰美观
- ✅ 分享成功后给予反馈提示

### 6.3 性能优化

- ✅ 分享组件按需加载
- ✅ 海报生成使用缓存
- ✅ 图片使用CDN加速

### 6.4 错误处理

- ✅ 网络异常时友好提示
- ✅ 权限拒绝时引导用户授权
- ✅ 分享失败时提供重试选项

---

## 七、测试清单

### 功能测试

- [ ] 分享按钮点击正常
- [ ] 分享面板正常弹出
- [ ] 小程序卡片分享成功
- [ ] 海报生成成功
- [ ] 海报保存到相册成功
- [ ] 分享来源追踪正确

### 数据测试

- [ ] 分享标题正确
- [ ] 分享描述正确
- [ ] 分享图片正确
- [ ] 分享路径正确
- [ ] 追踪参数正确

### 兼容性测试

- [ ] iOS系统正常
- [ ] Android系统正常
- [ ] 不同微信版本正常

---

## 八、快速集成命令

为了提高效率，可以使用以下步骤快速集成：

1. **复制房车详情页的分享代码**
2. **修改 ShareScene 为对应场景**
3. **修改分享标题、描述、图片**
4. **修改 path 和 businessId**
5. **添加分享按钮到页面**
6. **添加分享组件到模板**
7. **测试分享功能**

---

## 九、后续优化建议

1. **分享数据分析**
   - 统计各页面分享次数
   - 分析分享转化率
   - 优化分享文案

2. **分享激励**
   - 社区内容分享奖励积分
   - 邀请好友注册奖励
   - 分享成就系统

3. **分享体验优化**
   - 添加分享引导动画
   - 优化海报生成速度
   - 添加分享成功动画

---

**文档维护**: Claude Code
**最后更新**: 2025-12-19
**版本**: v1.0
