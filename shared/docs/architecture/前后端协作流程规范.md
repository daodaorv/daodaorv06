# 前后端协作流程规范

**文档版本**: v1.0 | **创建时间**: 2025-11-14 | **维护者**: 叨叨房车技术团队

---

## 📋 文档说明

本文档定义叨叨房车项目前后端协作的标准化流程,确保开发效率和代码质量。

**适用范围**:
- 小程序端 (miniprogram/)
- PC管理端 (admin-console/)
- 移动管理端 (mobile-admin/)
- 后端API (backend/)

---

## 📋 目录

1. [协作流程总览](#1-协作流程总览)
2. [需求确认阶段](#2-需求确认阶段)
3. [接口设计阶段](#3-接口设计阶段)
4. [并行开发阶段](#4-并行开发阶段)
5. [联调测试阶段](#5-联调测试阶段)
6. [验收上线阶段](#6-验收上线阶段)
7. [问题处理流程](#7-问题处理流程)
8. [协作工具与规范](#8-协作工具与规范)

---

## 1. 协作流程总览

### 1.1 标准开发流程

```
需求确认 (0.5天)
    ↓
接口设计 (0.5天)
    ↓
并行开发 (2-3天)
    ├─ 后端: 实现API接口
    └─ 前端: 使用Mock数据开发
    ↓
联调测试 (0.5-1天)
    ↓
验收上线 (0.5天)
```

### 1.2 时间分配建议

| 阶段 | 时间占比 | 主要工作 | 参与人员 |
|------|----------|----------|----------|
| 需求确认 | 10% | 确认功能需求和接口定义 | 前后端 |
| 接口设计 | 10% | 编写API文档 | 后端主导 |
| 并行开发 | 50% | 前后端独立开发 | 前后端 |
| 联调测试 | 20% | 前后端联调和测试 | 前后端 |
| 验收上线 | 10% | 功能验收和部署 | 全员 |

### 1.3 协作原则

- ✅ **接口先行**: 先定义接口,再开发功能
- ✅ **文档驱动**: 所有接口必须有完整文档
- ✅ **并行开发**: 前后端使用Mock数据并行开发
- ✅ **及时沟通**: 遇到问题及时沟通,不要等到联调
- ✅ **测试充分**: 联调前各自完成单元测试

---

## 2. 需求确认阶段

### 2.1 需求确认会议

**会议目标**:
- 明确功能需求和业务逻辑
- 确定前后端分工
- 识别技术难点和风险

**会议议程**:
1. 产品经理讲解功能需求 (15分钟)
2. 前端提出页面交互需求 (10分钟)
3. 后端评估技术可行性 (10分钟)
4. 讨论接口定义和数据结构 (15分钟)
5. 确定开发时间和里程碑 (10分钟)

**输出物**:
- [ ] 功能需求确认单
- [ ] 接口需求清单
- [ ] 技术风险评估
- [ ] 开发时间表

### 2.2 需求确认清单

**功能需求确认**:
- [ ] 功能描述清晰
- [ ] 业务规则明确
- [ ] 交互流程完整
- [ ] 异常场景考虑

**技术需求确认**:
- [ ] 数据库表结构确认
- [ ] API接口数量确认
- [ ] 第三方服务依赖确认
- [ ] 性能要求确认

---

## 3. 接口设计阶段

### 3.1 API文档模板

```markdown
## API名称: xxx

### 基本信息
- **接口路径**: /api/v1/xxx
- **请求方法**: GET/POST/PUT/DELETE
- **认证方式**: Bearer Token
- **开发状态**: 开发中/已完成/已测试
- **负责人**: xxx
- **预计完成时间**: 2025-11-xx

### 功能描述
简要描述该接口的功能和用途

### 请求参数

#### Headers
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| Authorization | string | 是 | 认证token | Bearer xxx |
| Content-Type | string | 是 | 内容类型 | application/json |

#### Query Parameters (GET请求)
| 参数名 | 类型 | 必填 | 说明 | 示例 | 默认值 |
|--------|------|------|------|------|--------|
| page | number | 否 | 页码 | 1 | 1 |
| pageSize | number | 否 | 每页数量 | 20 | 20 |

#### Body Parameters (POST/PUT请求)
| 参数名 | 类型 | 必填 | 说明 | 示例 | 验证规则 |
|--------|------|------|------|------|----------|
| name | string | 是 | 名称 | "张三" | 2-20字符 |
| phone | string | 是 | 手机号 | "13800138000" | 11位数字 |

### 响应格式

#### 成功响应 (200)
```json
{
  "code": 0,
  "message": "success",
  "data": {
    "id": 1,
    "name": "张三"
  },
  "meta": {
    "requestId": "abc-123",
    "timestamp": "2025-11-14T10:00:00+08:00"
  }
}
```

#### 错误响应
```json
{
  "code": 1001,
  "message": "参数错误",
  "errors": [
    {
      "field": "phone",
      "message": "手机号格式不正确"
    }
  ]
}
```

### 错误码说明
| 错误码 | 说明 | 处理方式 |
|--------|------|----------|
| 1001 | 参数错误 | 检查请求参数 |
| 1002 | 未授权 | 重新登录 |
| 1003 | 无权限 | 联系管理员 |

### 业务规则
- 规则1: xxx
- 规则2: xxx

### 测试用例

#### 正常场景
- 输入: xxx
- 预期输出: xxx

#### 异常场景
- 输入: xxx
- 预期输出: xxx

### 变更记录
| 日期 | 版本 | 变更内容 | 变更人 |
|------|------|----------|--------|
| 2025-11-14 | v1.0 | 初始版本 | xxx |
```

### 3.2 接口设计评审

**评审清单**:
- [ ] 接口命名符合RESTful规范
- [ ] 请求参数定义完整
- [ ] 响应格式统一
- [ ] 错误码定义清晰
- [ ] 业务规则描述完整
- [ ] 测试用例覆盖全面

**评审流程**:
1. 后端编写API文档
2. 前端审核接口设计
3. 双方讨论并确认
4. 更新文档并归档

---

## 4. 并行开发阶段

### 4.1 后端开发规范

**开发步骤**:
1. 创建数据库表和模型
2. 实现业务逻辑层 (Service)
3. 实现控制器层 (Controller)
4. 编写单元测试
5. 使用Postman测试接口

**代码规范**:
```typescript
// Controller层 - 处理HTTP请求
export class UserController {
  async getUser(req, res) {
    try {
      const userId = req.params.id
      const user = await userService.getUserById(userId)
      return res.success(user)
    } catch (error) {
      return res.error(error)
    }
  }
}

// Service层 - 业务逻辑
export class UserService {
  async getUserById(userId: number) {
    const user = await User.findByPk(userId)
    if (!user) {
      throw new NotFoundError('用户不存在')
    }
    return user
  }
}
```

**测试规范**:
```typescript
// 单元测试
describe('UserService', () => {
  it('should get user by id', async () => {
    const user = await userService.getUserById(1)
    expect(user).toBeDefined()
    expect(user.id).toBe(1)
  })
  
  it('should throw error when user not found', async () => {
    await expect(userService.getUserById(999))
      .rejects.toThrow('用户不存在')
  })
})
```

### 4.2 前端开发规范

**开发步骤**:
1. 创建Mock数据
2. 实现页面UI
3. 实现业务逻辑
4. 编写组件测试
5. 自测功能流程

**Mock数据规范**:
```typescript
// mock/user.ts
export default {
  'GET /api/v1/users/:id': (req) => {
    return {
      code: 0,
      data: {
        id: req.params.id,
        name: '张三',
        phone: '13800138000'
      }
    }
  },
  
  'POST /api/v1/users': {
    code: 0,
    data: {
      id: 1,
      name: '张三'
    }
  }
}
```

**API调用规范**:
```typescript
// api/user.ts
import { request } from '@/utils/request'

export const userApi = {
  // 获取用户信息
  getUser(id: number) {
    return request.get(`/api/v1/users/${id}`)
  },
  
  // 创建用户
  createUser(data: CreateUserDto) {
    return request.post('/api/v1/users', data)
  }
}
```

---

## 5. 联调测试阶段

### 5.1 联调准备

**后端准备**:
- [ ] API接口已部署到测试环境
- [ ] 数据库已初始化测试数据
- [ ] API文档已更新到最新版本
- [ ] 单元测试全部通过

**前端准备**:
- [ ] 关闭Mock数据,切换到真实API
- [ ] 配置测试环境API地址
- [ ] 准备测试账号和数据
- [ ] 功能自测已完成

### 5.2 联调测试流程

**第一步: 基础连通性测试**
- [ ] 测试API请求是否成功
- [ ] 测试认证token是否有效
- [ ] 测试跨域配置是否正确
- [ ] 测试网络错误处理

**第二步: 正常场景测试**
- [ ] 测试正常业务流程
- [ ] 测试数据展示是否正确
- [ ] 测试数据提交是否成功
- [ ] 测试页面跳转是否正常

**第三步: 异常场景测试**
- [ ] 测试参数验证
- [ ] 测试权限验证
- [ ] 测试错误提示
- [ ] 测试网络异常处理

**第四步: 边界条件测试**
- [ ] 测试空数据情况
- [ ] 测试大数据量情况
- [ ] 测试特殊字符处理
- [ ] 测试并发请求

### 5.3 联调测试检查清单

**功能测试**:
- [ ] 所有功能正常运行
- [ ] 数据展示正确
- [ ] 数据提交成功
- [ ] 页面跳转正常

**性能测试**:
- [ ] API响应时间 < 1秒
- [ ] 页面加载时间 < 3秒
- [ ] 列表滚动流畅
- [ ] 图片加载正常

**兼容性测试**:
- [ ] 不同浏览器测试 (PC端)
- [ ] 不同设备测试 (移动端)
- [ ] 不同网络环境测试
- [ ] 不同分辨率测试

**安全性测试**:
- [ ] 认证授权正确
- [ ] 数据权限过滤正确
- [ ] 敏感数据加密
- [ ] XSS/CSRF防护

---

## 6. 验收上线阶段

### 6.1 功能验收

**验收标准**:
- [ ] 所有功能按需求实现
- [ ] 所有测试用例通过
- [ ] 无严重Bug和中等Bug
- [ ] 性能指标达标
- [ ] 代码审查通过

**验收流程**:
1. 开发人员提交验收申请
2. 测试人员执行验收测试
3. 产品经理确认功能
4. 技术负责人代码审查
5. 通过验收,准备上线

### 6.2 上线检查清单

**代码检查**:
- [ ] 代码已合并到主分支
- [ ] 代码格式检查通过
- [ ] TypeScript类型检查通过
- [ ] 单元测试全部通过
- [ ] 代码审查通过

**配置检查**:
- [ ] 环境变量配置正确
- [ ] API地址配置正确
- [ ] 数据库连接配置正确
- [ ] 第三方服务配置正确

**文档检查**:
- [ ] API文档已更新
- [ ] 用户手册已更新
- [ ] 部署文档已准备
- [ ] 变更日志已记录

---

## 7. 问题处理流程

### 7.1 问题分类

**按严重程度分类**:
- **P0 - 紧急**: 系统崩溃、数据丢失、核心功能不可用
- **P1 - 高**: 重要功能异常、性能严重下降
- **P2 - 中**: 一般功能异常、体验问题
- **P3 - 低**: 优化建议、文档问题

### 7.2 问题响应时间

| 严重程度 | 响应时间 | 修复时间 | 负责人 |
|----------|----------|----------|--------|
| P0 - 紧急 | 15分钟内 | 2小时内 | 技术负责人 |
| P1 - 高 | 1小时内 | 1天内 | 模块负责人 |
| P2 - 中 | 4小时内 | 3天内 | 开发人员 |
| P3 - 低 | 1天内 | 1周内 | 开发人员 |

---

## 8. 协作工具与规范

### 8.1 推荐工具

**文档工具**:
- **API文档**: Apifox / Postman
- **项目文档**: Markdown / 语雀
- **流程图**: draw.io / ProcessOn

**沟通工具**:
- **即时通讯**: 微信 / 钉钉
- **项目管理**: Jira / Trello / 飞书
- **代码审查**: GitHub / GitLab

**测试工具**:
- **API测试**: Postman / Apifox
- **抓包工具**: Charles / Fiddler
- **性能测试**: JMeter / LoadRunner

### 8.2 沟通规范

**日常沟通**:
- 使用即时通讯工具进行日常沟通
- 重要决策通过会议确认
- 技术问题优先文字描述,必要时语音/视频
- 及时响应,工作时间内1小时内回复

**会议规范**:
- 提前发送会议议程
- 准时参加会议
- 会议记录归档
- 会议决议跟踪执行

**文档规范**:
- 所有文档使用Markdown格式
- 文档命名规范: `模块名-文档类型-版本号.md`
- 文档版本控制,记录变更历史
- 重要文档定期审核更新

---

**文档维护**: 叨叨房车技术团队
**最后更新**: 2025-11-14
**版本**: v1.0
**下次审核**: 2025-12-14
