# 数据字典

**文档版本**: v1.0 | **创建时间**: 2025-11-12 | **维护者**: 叨叨房车技术团队

## 📋 文档说明

本文档定义叨叨房车租赁平台的完整数据字典，包含所有字段定义、枚举值说明、业务规则和数据验证规则。

**关联文档**：
- [数据库设计.md](./数据库设计.md) - 数据库表结构设计
- [技术栈与架构设计.md](./技术栈与架构设计.md) - 技术架构设计

---

## 📋 目录

1. [枚举值定义](#1-枚举值定义)
2. [字段详细说明](#2-字段详细说明)
3. [业务规则说明](#3-业务规则说明)
4. [数据验证规则](#4-数据验证规则)
5. [状态流转规则](#5-状态流转规则)

---

## 1. 枚举值定义

### 1.1 用户相关枚举

#### user_type (用户类型)
| 值 | 说明 | 描述 |
|---|---|---|
| customer | 客户用户 | C端小程序用户，可以浏览车辆、创建订单、支付等 |
| mobile_admin | 移动管理员 | B端移动管理用户，门店员工，负责订单处理、车辆管理 |
| pc_admin | PC管理员 | B端PC管理用户，公司管理员，负责系统管理、数据分析 |

#### user_status (用户状态)
| 值 | 说明 | 描述 |
|---|---|---|
| active | 激活 | 用户账户正常，可以使用所有功能 |
| inactive | 未激活 | 用户注册后未激活，部分功能受限 |
| banned | 禁用 | 用户被禁用，无法使用系统 |

#### gender (性别)
| 值 | 说明 | 描述 |
|---|---|---|
| male | 男 | 男性用户 |
| female | 女 | 女性用户 |
| other | 其他 | 其他性别 |

### 1.2 车辆相关枚举

#### vehicle_type (车辆类型)
| 值 | 说明 | 描述 |
|---|---|---|
| motorhome | 自行式房车 | 自带动力，可自行驾驶的房车 |
| trailer | 拖挂式房车 | 需要��辆拖拽的房车 |
| camper_van | 露营车 | 改装的厢式货车，适合露营 |
| rv | 休闲车 | 广义的休闲车辆 |

#### transmission (变速箱类型)
| 值 | 说明 | 描述 |
|---|---|---|
| manual | 手动 | 手动变速箱 |
| automatic | 自动 | 自动变速箱 |

#### fuel_type (燃料类型)
| 值 | 说明 | 描述 |
|---|---|---|
| gasoline | 汽油 | 汽油燃料 |
| diesel | 柴油 | 柴油燃料 |
| hybrid | 混合动力 | 油电混合动力 |
| electric | 电动 | 纯电动 |

#### vehicle_status (车辆状态)
| 值 | 说明 | 描述 |
|---|---|---|
| available | 可用 | 车辆正常，可以租赁 |
| rented | 已出租 | 车辆正在租赁中 |
| maintenance | 维护中 | 车辆正在维护保养 |
| unavailable | 不可用 | 车辆故障或其他原因不可用 |

### 1.3 门店相关枚举

#### store_type (门店类型)
| 值 | 说明 | 描述 |
|---|---|---|
| company | 直营店 | 公司直营门店 |
| franchise | 加盟店 | 加商加盟门店 |
| partner | 合作店 | 合作伙伴门店 |

#### store_user_role (门店用户角色)
| 值 | 说明 | 描述 |
|---|---|---|
| manager | 店长 | 门店负责人，拥有门店所有权限 |
| staff | 员工 | 门店普通员工，拥有基础操作权限 |
| driver | 司机 | 门店司机，主要负责车辆接送服务 |

### 1.4 订单相关枚举

#### order_status (订单状态)
| 值 | 说明 | 描述 | 允许操作 |
|---|---|---|---|
| pending | 待支付 | 订单已创建，等待用户支付 | 支付、取消 |
| paid | 已支付 | 订单已支付，等待门店确认 | 取消(退款) |
| confirmed | 已确认 | 门店已确认订单，等待取车 | 取消(退款) |
| ready | 待取车 | 车辆准备就绪，用户可取车 | 确认取车、取消(退款) |
| in_use | 使用中 | 车辆使用中，等待还车 | 确认还车 |
| completed | 已完成 | 订单已完成，等待结算 | 评价、投诉 |
| cancelled | 已取消 | 订单已取消 | 查看 |
| refunded | 已退款 | 订单已退款 | 查看 |

#### payment_status (支付状态)
| 值 | 说明 | 描述 |
|---|---|---|
| unpaid | 未支付 | 订单金额未支付 |
| partial | 部分支付 | 订单金额部分支付（如押金未付） |
| paid | 已支付 | 订单金额已全部支付 |
| refunded | 已退款 | 订单金额已退款 |

#### deposit_status (押金状态)
| 值 | 说明 | 描述 |
|---|---|---|
| unpaid | 未支付 | 押金未支付 |
| paid | 已支付 | 押金已支付 |
| refunded | 已退还 | 押金已退还 |

### 1.5 支付相关枚举

#### payment_type (支付类型)
| 值 | 说明 | 描述 |
|---|---|---|
| order | 订单支付 | 订单租金支付 |
| deposit | 押金支付 | 车辆押金支付 |
| violation_deposit | 违章押金 | 违章押金支付 |
| penalty | 罚款支付 | 违章罚款等支付 |
| compensation | 赔偿支付 | 车辆损坏赔偿支付 |

#### payment_method (支付方式)
| 值 | 说明 | 描述 |
|---|---|---|
| wechat | 微信支付 | 微信支付 |
| alipay | 支付宝 | 支付宝支付 |
| balance | 余额支付 | 账户余额支付 |
| cash | 现金支付 | 现金支付（门店） |

#### payment_status (支付状态)
| 值 | 说明 | 描述 |
|---|---|---|
| pending | 待支付 | 支付创建，等待用户支付 |
| success | 支付成功 | 支付成功 |
| failed | 支付失败 | 支付失败 |
| cancelled | 支付取消 | 支付取消 |
| refunding | 退款中 | 正在退款 |
| refunded | 已退款 | 退款完成 |

### 1.6 营销相关枚举

#### coupon_type (优惠券类型)
| 值 | 说明 | 描述 |
|---|---|---|
| discount | 折扣券 | 按折扣比例减免 |
| cash | 现金券 | 直接减免固定金额 |
| percentage | 百分比券 | 按百分比减免 |

#### user_coupon_status (用户优惠券状态)
| 值 | 说明 | 描述 |
|---|---|---|
| unused | 未使用 | 优惠券未使用 |
| used | 已使用 | 优惠券已使用 |
| expired | 已过期 | 优惠券已过期 |

### 1.7 系统相关枚举

#### role_type (角色类型)
| 值 | 说明 | 描述 |
|---|---|---|
| super_admin | 超级管理员 | 系统超级管理员，拥有所有权限 |
| pc_admin | PC管理员 | PC端管理员，负责系统管理和数据分析 |
| mobile_admin | 移动管理员 | 移动端管理员，负责门店日常运营 |
| customer | 普通用户 | C端用户，只能查看和管理自己的信息 |

#### config_type (配置类型)
| 值 | 说明 | 描述 |
|---|---|---|
| string | 字符串 | 文本字符串配置 |
| number | 数字 | 数值型配置 |
| boolean | 布尔值 | true/false配置 |
| json | JSON | JSON格式配置 |

#### operation_status (操作状态)
| 值 | 说明 | 描述 |
|---|---|---|
| success | 成功 | 操作执行成功 |
| failed | 失败 | 操作执行失败 |

---

## 2. 字段详细说明

### 2.1 用户表 (users)

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 | 验证规则 |
|--------|------|------|--------|--------|------|----------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 用户ID | 主键 |
| username | VARCHAR | 50 | NO | - | 用户名 | 唯一，4-20字符，字母数字下划线 |
| phone | VARCHAR | 20 | NO | - | 手机号 | 唯一，11位数字，1开头 |
| email | VARCHAR | 100 | YES | - | 邮箱 | 唯一，邮箱格式验证 |
| password_hash | VARCHAR | 255 | NO | - | 密码哈希 | BCrypt哈希，最少60字符 |
| real_name | VARCHAR | 50 | YES | - | 真实姓名 | 2-20字符，中文姓名 |
| id_card | VARCHAR | 20 | YES | - | 身份证号 | 18位身份证号验证 |
| driver_license | VARCHAR | 50 | YES | - | 驾驶证号 | 驾驶证格式验证 |
| avatar_url | VARCHAR | 500 | YES | - | 头像URL | URL格式验证 |
| user_type | ENUM | - | NO | customer | 用户类型 | customer,mobile_admin,pc_admin |
| status | ENUM | - | NO | active | 账户状态 | active,inactive,banned |
| last_login_at | TIMESTAMP | - | YES | NULL | 最后登录时间 | - |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 更新时间 | 自动更新 |

### 2.2 车辆表 (vehicles)

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 | 验证规则 |
|--------|------|------|--------|--------|------|----------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 车辆ID | 主键 |
| vehicle_model_id | BIGINT | - | NO | - | 型号ID | 外键关联vehicle_models |
| license_plate | VARCHAR | 20 | NO | - | 车牌号 | 唯一，车牌号格式验证 |
| vin | VARCHAR | 17 | YES | - | 车架号 | 唯一，17位VIN码验证 |
| year | INT | - | YES | - | 年份 | 1900-当前年份 |
| color | VARCHAR | 50 | YES | - | 颜色 | 颜色名称 |
| mileage | INT | - | NO | 0 | 里程数 | 非负整数，单位km |
| store_id | BIGINT | - | NO | - | 所属门店ID | 外键关联stores |
| daily_rate | DECIMAL | 10,2 | NO | - | 日租金 | 大于0，最多2位小数 |
| weekly_rate | DECIMAL | 10,2 | YES | - | 周租金 | 大于0，最多2位小数 |
| monthly_rate | DECIMAL | 10,2 | YES | - | 月租金 | 大于0，最多2位小数 |
| deposit_amount | DECIMAL | 10,2 | NO | - | 押金金额 | 大于0，最多2位小数 |
| violation_deposit | DECIMAL | 10,2 | NO | 2000.00 | 违章押金 | 大于0，最多2位小数 |
| location_lat | DECIMAL | 10,8 | YES | - | 纬度 | -90到90度 |
| location_lng | DECIMAL | 11,8 | YES | - | 经度 | -180到180度 |
| location_address | TEXT | - | YES | - | 详细地址 | 地址文本 |
| images | JSON | - | YES | - | 车辆图片 | 图片URL数组 |
| features | JSON | - | YES | - | 车辆特性 | 特性标签数组 |
| status | ENUM | - | NO | available | 车辆状态 | available,rented,maintenance,unavailable |
| last_maintenance_at | TIMESTAMP | - | YES | NULL | 最后保养时间 | - |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 更新时间 | 自动更新 |

### 2.3 订单表 (orders)

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 | 验证规则 |
|--------|------|------|--------|--------|------|----------|
| id | BIGINT | - | NO | AUTO_INCREMENT | 订单ID | 主键 |
| order_no | VARCHAR | 32 | NO | - | 订单号 | 唯一，32位订单号 |
| user_id | BIGINT | - | NO | - | 用户ID | 外键关联users |
| vehicle_id | BIGINT | - | NO | - | 车辆ID | 外键关联vehicles |
| store_id | BIGINT | - | NO | - | 取车门店ID | 外键关联stores |
| return_store_id | BIGINT | - | YES | - | 还车门店ID | 外键关联stores |
| start_date | DATE | - | NO | - | 取车日期 | 日期格式，不能是过去 |
| end_date | DATE | - | NO | - | 还车日期 | 日期格式，必须大于取车日期 |
| start_time | TIME | - | NO | - | 取车时间 | 时间格式 HH:MM:SS |
| end_time | TIME | - | NO | - | 还车时间 | 时间格式 HH:MM:SS |
| rental_days | INT | - | NO | - | 租赁天数 | 大于0 |
| daily_rate | DECIMAL | 10,2 | NO | - | 日租金 | 大于0，最多2位小数 |
| total_amount | DECIMAL | 10,2 | NO | - | 订单总金额 | 大于0，最多2位小数 |
| deposit_amount | DECIMAL | 10,2 | NO | - | 押金金额 | 大于0，最多2位小数 |
| violation_deposit | DECIMAL | 10,2 | NO | 2000.00 | 违章押金 | 大于0，最多2位小数 |
| actual_amount | DECIMAL | 10,2 | YES | - | 实际支付金额 | 大于0，最多2位小数 |
| discount_amount | DECIMAL | 10,2 | NO | 0.00 | 优惠金额 | 大于等于0，最多2位小数 |
| coupon_id | BIGINT | - | YES | - | 优惠券ID | 外键关联coupons |
| remark | TEXT | - | YES | - | 订单备注 | 最多500字符 |
| status | ENUM | - | NO | pending | 订单状态 | 订单状态枚举 |
| payment_status | ENUM | - | NO | unpaid | 支付状态 | unpaid,partial,paid,refunded |
| deposit_status | ENUM | - | NO | unpaid | 押金状态 | unpaid,paid,refunded |
| pickup_mileage | INT | - | YES | - | 取车里程数 | 非负整数 |
| return_mileage | INT | - | YES | - | 还车里程数 | 非负整数 |
| pickup_fuel | DECIMAL | 5,2 | YES | - | 取车油量 | 0-100，最多2位小数 |
| return_fuel | DECIMAL | 5,2 | YES | - | 还车油量 | 0-100，最多2位小数 |
| pickup_images | JSON | - | YES | - | 取车照片 | 图片URL数组 |
| return_images | JSON | - | YES | - | 还车照片 | 图片URL数组 |
| contract_url | VARCHAR | 500 | YES | - | 合同文件URL | URL格式验证 |
| pickup_confirmed_at | TIMESTAMP | - | YES | NULL | 取车确认时间 | - |
| pickup_confirmed_by | BIGINT | - | YES | NULL | 取车确认人ID | 外键关联users |
| return_confirmed_at | TIMESTAMP | - | YES | NULL | 还车确认时间 | - |
| return_confirmed_by | BIGINT | - | YES | NULL | 还车确认人ID | 外键关联users |
| cancelled_at | TIMESTAMP | - | YES | NULL | 取消时间 | - |
| cancelled_by | BIGINT | - | YES | NULL | 取消人ID | 外键关联users |
| cancel_reason | VARCHAR | 500 | YES | - | 取消原因 | 最多500字符 |
| completed_at | TIMESTAMP | - | YES | NULL | 完成时间 | - |
| created_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 | - |
| updated_at | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 更新时间 | 自动更新 |

---

## 3. 业务规则说明

### 3.1 用户相关规则
1. **用户名规则**：4-20位字符，只能包含字母、数字、下划线
2. **手机号规则**：11位数字，必须以1开头
3. **密码规则**：最少8位，包含字母和数字
4. **实名认证**：需要提供真实姓名和身份证号
5. **驾驶证验证**：必须提供有效的驾驶证信息才能租车

### 3.2 车辆相关规则
1. **车辆状态流转**：available → rented → available
2. **保养提醒**：车辆每5000公里或3个月需要保养一次
3. **价格计算**：日租金 × 租赁天数，周租和月租有优惠
4. **押金规则**：车辆押金根据车辆价值确定，违章押金统一2000元

### 3.3 订单相关规则
1. **订单有效期**：订单创建后30分钟内需要支付
2. **租期限制**：最短租期1天，最长租期30天
3. **取还车时间**：取车时间为门店营业时间内
4. **订单取消**：取车前24小时可以免费取消，否则收取20%违约金
5. **车辆可用性**：下单时需要检查车辆在租期内是否可用

### 3.4 支付相关规则
1. **支付时效**：订单创建后30分钟内需要完成支付
2. **押金支付**：到店取车时需要支付押金
3. **退款规则**：违章押金在还车30天后无违章记录才退还
4. **支付渠道**：支持微信、支付宝、余额支付

### 3.5 优惠券相关规则
1. **使用限制**：每个订单只能使用一张优惠券
2. **有效期**：优惠券必须在有效期内使用
3. **使用门槛**：需要满足最低消费金额才能使用
4. **适用范围**：部分优惠券仅限特定车型或门店使用

---

## 4. 数据验证规则

### 4.1 通用验证规则
- **非空验证**：必填字段不能为空
- **长度限制**：字符串字段不能超过最大长度
- **格式验证**：邮箱、手机号、URL等需要格式验证
- **数值范围**：数值类型需要在合理范围内
- **日期时间**：日期时间需要符合业务逻辑

### 4.2 业务验证规则
- **唯一性约束**：用户名、手机号、邮箱等需要唯一
- **外键约束**：关联数据必须存在
- **状态约束**：状态变更需要符合业务规则
- **权限验证**：操作需要符合用户权限

### 4.3 数据完整性规则
- **事务一致性**：相关操作需要在一个事务中完成
- **数据同步**：关联数据需要保持同步
- **日志记录**：重要操作需要记录日志
- **异常处理**：异常情况需要友好提示

---

## 5. 状态流转规则

### 5.1 订单状态流转图
```
pending(待支付)
    ↓ 支付成功
paid(已支付)
    ↓ 门店确认
confirmed(已确认)
    ↓ 车辆准备就绪
ready(待取车)
    ↓ 确认取车
in_use(使用中)
    ↓ 确认还车
completed(已完成)

pending(待支付)
    ↓ 超时/取消
cancelled(已取消)
    ↓ 退款
refunded(已退款)

paid(已支付)
    ↓ 取消退款
cancelled(已取消)
    ↓ 退款完成
refunded(已退款)

confirmed(已确认)
    ↓ 取消退款
cancelled(已取消)
    ↓ 退款完成
refunded(已退款)

ready(待取车)
    ↓ 取消退款
cancelled(已取消)
    ↓ 退款完成
refunded(已退款)
```

### 5.2 车辆状态流转图
```
available(可用)
    ↓ 租出
rented(已出租)
    ↓ 还车
available(可用)

available(可用)
    ↓ 维护
maintenance(维护中)
    ↓ 维护完成
available(可用)

rented(已出租)
    ↓ 故障
unavailable(不可用)
    ↓ 修复完成
available(可用)

maintenance(维护中)
    ↓ 延期维护
unavailable(不可用)
    ↓ 修复完成
available(可用)
```

### 5.3 支付状态流转图
```
pending(待支付)
    ↓ 支付成功
success(支付成功)

pending(待支付)
    ↓ 支付失败
failed(支付失败)
    ↓ 重新支付
pending(待支付)

pending(待支付)
    ↓ 取消支付
cancelled(支付取消)

success(支付成功)
    ↓ 申请退款
refunding(退款中)
    ↓ 退款完成
refunded(已退款)

failed(支付失败)
    ↓ 取消
cancelled(支付取消)
```

---

## 6. 数据字典使用指南

### 6.1 前端开发参考
- **枚举值**：用于下拉框、单选框、复选框等组件
- **字段验证**：用于表单验证规则
- **状态显示**：用于状态标签、进度显示
- **错误提示**：用于错误信息提示

### 6.2 后端开发参考
- **数据验证**：用于API请求参数验证
- **业务规则**：用于业务逻辑判断
- **状态管理**：用于状态流转控制
- **数据库操作**：用于数据库约束设置

### 6.3 测试参考
- **测试数据**：用于测试用例设计
- **边界值**：用于边界条件测试
- **异常场景**：用于异常情况测试
- **业务场景**：用于端到端测试

---

**文档维护**: 叨叨房车技术团队
**最后更新**: 2025-11-12
**版本**: v1.0
**下次审核**: 2025-12-12