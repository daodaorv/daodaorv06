# æ•°æ®åº“è®¾è®¡æ–‡æ¡£

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0 | **åˆ›å»ºæ—¶é—´**: 2025-11-12 | **ç»´æŠ¤è€…**: å¨å¨æˆ¿è½¦æŠ€æœ¯å›¢é˜Ÿ

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£å®šä¹‰å¨å¨æˆ¿è½¦ç§Ÿèµå¹³å°çš„å®Œæ•´æ•°æ®åº“è®¾è®¡ï¼ŒåŒ…å«è¡¨ç»“æ„ã€å…³ç³»ã€ç´¢å¼•å’Œçº¦æŸã€‚

**å…³è”æ–‡æ¡£**ï¼š
- [æŠ€æœ¯æ ˆä¸æ¶æ„è®¾è®¡.md](./æŠ€æœ¯æ ˆä¸æ¶æ„è®¾è®¡.md) - æŠ€æœ¯æ ˆå’Œæ¶æ„
- [æ•°æ®å­—å…¸.md](./æ•°æ®å­—å…¸.md) - å­—æ®µå®šä¹‰å’Œè¯´æ˜

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“é…ç½®](#1-æ•°æ®åº“é…ç½®)
2. [æ ¸å¿ƒä¸šåŠ¡è¡¨](#2-æ ¸å¿ƒä¸šåŠ¡è¡¨)
3. [ç³»ç»Ÿç®¡ç†è¡¨](#3-ç³»ç»Ÿç®¡ç†è¡¨)
4. [è¡¨å…³ç³»å›¾](#4-è¡¨å…³ç³»å›¾)
5. [ç´¢å¼•è®¾è®¡](#5-ç´¢å¼•è®¾è®¡)
6. [æ•°æ®å­—å…¸æ˜ å°„](#6-æ•°æ®å­—å…¸æ˜ å°„)

---

## 1. æ•°æ®åº“é…ç½®

### 1.1 åŸºç¡€é…ç½®
- **æ•°æ®åº“**: MySQL 8.0.35
- **å­—ç¬¦é›†**: utf8mb4
- **æ’åºè§„åˆ™**: utf8mb4_unicode_ci
- **æ—¶åŒº**: +08:00
- **å­˜å‚¨å¼•æ“**: InnoDB

### 1.2 å‘½åè§„èŒƒ
- **è¡¨å**: å°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¤æ•°å½¢å¼ (å¦‚: `users`, `orders`)
- **å­—æ®µå**: å°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš” (å¦‚: `user_id`, `created_at`)
- **ç´¢å¼•å**: `idx_è¡¨å_å­—æ®µå` (å¦‚: `idx_orders_user_id`)
- **å¤–é”®å**: `fk_è¡¨å_å­—æ®µå` (å¦‚: `fk_orders_user_id`)

---

## 2. æ ¸å¿ƒä¸šåŠ¡è¡¨

### 2.1 ç”¨æˆ·ç›¸å…³è¡¨

#### users - ç”¨æˆ·è¡¨
```sql
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    phone VARCHAR(20) UNIQUE NOT NULL COMMENT 'æ‰‹æœºå·',
    email VARCHAR(100) UNIQUE COMMENT 'é‚®ç®±',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ',
    real_name VARCHAR(50) COMMENT 'çœŸå®å§“å',
    id_card VARCHAR(20) COMMENT 'èº«ä»½è¯å·',
    driver_license VARCHAR(50) COMMENT 'é©¾é©¶è¯å·',
    avatar_url VARCHAR(500) COMMENT 'å¤´åƒURL',
    user_type ENUM('customer', 'mobile_admin', 'pc_admin') NOT NULL DEFAULT 'customer' COMMENT 'ç”¨æˆ·ç±»å‹',
    status ENUM('active', 'inactive', 'banned') NOT NULL DEFAULT 'active' COMMENT 'è´¦æˆ·çŠ¶æ€',
    last_login_at TIMESTAMP NULL COMMENT 'æœ€åç™»å½•æ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    INDEX idx_username (username),
    INDEX idx_phone (phone),
    INDEX idx_email (email),
    INDEX idx_user_type (user_type),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

#### user_profiles - ç”¨æˆ·æ¡£æ¡ˆè¡¨
```sql
CREATE TABLE user_profiles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ¡£æ¡ˆID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    gender ENUM('male', 'female', 'other') COMMENT 'æ€§åˆ«',
    birthday DATE COMMENT 'ç”Ÿæ—¥',
    address TEXT COMMENT 'è¯¦ç»†åœ°å€',
    emergency_contact VARCHAR(50) COMMENT 'ç´§æ€¥è”ç³»äºº',
    emergency_phone VARCHAR(20) COMMENT 'ç´§æ€¥è”ç³»ç”µè¯',
    work_company VARCHAR(100) COMMENT 'å·¥ä½œå•ä½',
    work_title VARCHAR(50) COMMENT 'èŒä½',
    preferences JSON COMMENT 'ç”¨æˆ·åå¥½è®¾ç½®',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·æ¡£æ¡ˆè¡¨';
```

### 2.2 è½¦è¾†ç›¸å…³è¡¨

#### vehicle_brands - è½¦è¾†å“ç‰Œè¡¨
```sql
CREATE TABLE vehicle_brands (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å“ç‰ŒID',
    name VARCHAR(100) NOT NULL COMMENT 'å“ç‰Œåç§°',
    name_en VARCHAR(100) COMMENT 'è‹±æ–‡åç§°',
    logo_url VARCHAR(500) COMMENT 'å“ç‰ŒLogo',
    description TEXT COMMENT 'å“ç‰Œæè¿°',
    country VARCHAR(50) COMMENT 'å“ç‰Œå›½å®¶',
    status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    INDEX idx_name (name),
    INDEX idx_status (status),
    INDEX idx_sort_order (sort_order)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è½¦è¾†å“ç‰Œè¡¨';
```

#### vehicle_models - è½¦è¾†å‹å·è¡¨
```sql
CREATE TABLE vehicle_models (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å‹å·ID',
    brand_id BIGINT NOT NULL COMMENT 'å“ç‰ŒID',
    name VARCHAR(100) NOT NULL COMMENT 'å‹å·åç§°',
    name_en VARCHAR(100) COMMENT 'è‹±æ–‡åç§°',
    type ENUM('motorhome', 'trailer', 'camper_van', 'rv') NOT NULL COMMENT 'è½¦è¾†ç±»å‹',
    seats INT NOT NULL DEFAULT 4 COMMENT 'åº§ä½æ•°',
    beds INT NOT NULL DEFAULT 2 COMMENT 'åºŠä½æ•°',
    transmission ENUM('manual', 'automatic') NOT NULL COMMENT 'å˜é€Ÿç®±ç±»å‹',
    fuel_type ENUM('gasoline', 'diesel', 'hybrid', 'electric') NOT NULL COMMENT 'ç‡ƒæ–™ç±»å‹',
    description TEXT COMMENT 'å‹å·æè¿°',
    features JSON COMMENT 'ç‰¹æ€§åˆ—è¡¨',
    status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (brand_id) REFERENCES vehicle_brands(id) ON DELETE CASCADE,
    INDEX idx_brand_id (brand_id),
    INDEX idx_name (name),
    INDEX idx_type (type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è½¦è¾†å‹å·è¡¨';
```

#### vehicles - è½¦è¾†è¡¨
```sql
CREATE TABLE vehicles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è½¦è¾†ID',
    vehicle_model_id BIGINT NOT NULL COMMENT 'å‹å·ID',
    license_plate VARCHAR(20) UNIQUE NOT NULL COMMENT 'è½¦ç‰Œå·',
    vin VARCHAR(17) UNIQUE COMMENT 'è½¦æ¶å·',
    year INT COMMENT 'å¹´ä»½',
    color VARCHAR(50) COMMENT 'é¢œè‰²',
    mileage INT DEFAULT 0 COMMENT 'é‡Œç¨‹æ•°(km)',
    store_id BIGINT NOT NULL COMMENT 'æ‰€å±é—¨åº—ID',
    daily_rate DECIMAL(10,2) NOT NULL COMMENT 'æ—¥ç§Ÿé‡‘',
    weekly_rate DECIMAL(10,2) COMMENT 'å‘¨ç§Ÿé‡‘',
    monthly_rate DECIMAL(10,2) COMMENT 'æœˆç§Ÿé‡‘',
    deposit_amount DECIMAL(10,2) NOT NULL COMMENT 'æŠ¼é‡‘é‡‘é¢',
    violation_deposit DECIMAL(10,2) NOT NULL DEFAULT 2000.00 COMMENT 'è¿ç« æŠ¼é‡‘',
    location_lat DECIMAL(10,8) COMMENT 'çº¬åº¦',
    location_lng DECIMAL(11,8) COMMENT 'ç»åº¦',
    location_address TEXT COMMENT 'è¯¦ç»†åœ°å€',
    images JSON COMMENT 'è½¦è¾†å›¾ç‰‡URLs',
    features JSON COMMENT 'è½¦è¾†ç‰¹æ€§',
    status ENUM('available', 'rented', 'maintenance', 'unavailable') NOT NULL DEFAULT 'available' COMMENT 'è½¦è¾†çŠ¶æ€',
    last_maintenance_at TIMESTAMP NULL COMMENT 'æœ€åä¿å…»æ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (vehicle_model_id) REFERENCES vehicle_models(id) ON DELETE RESTRICT,
    INDEX idx_vehicle_model_id (vehicle_model_id),
    INDEX idx_license_plate (license_plate),
    INDEX idx_store_id (store_id),
    INDEX idx_status (status),
    INDEX idx_daily_rate (daily_rate),
    INDEX idx_location (location_lat, location_lng)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è½¦è¾†è¡¨';
```

### 2.3 é—¨åº—ç›¸å…³è¡¨

#### stores - é—¨åº—è¡¨
```sql
CREATE TABLE stores (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é—¨åº—ID',
    name VARCHAR(100) NOT NULL COMMENT 'é—¨åº—åç§°',
    code VARCHAR(20) UNIQUE NOT NULL COMMENT 'é—¨åº—ç¼–ç ',
    type ENUM('company', 'franchise', 'partner') NOT NULL DEFAULT 'company' COMMENT 'é—¨åº—ç±»å‹',
    contact_person VARCHAR(50) COMMENT 'è”ç³»äºº',
    contact_phone VARCHAR(20) COMMENT 'è”ç³»ç”µè¯',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    province VARCHAR(50) COMMENT 'çœä»½',
    city VARCHAR(50) COMMENT 'åŸå¸‚',
    district VARCHAR(50) COMMENT 'åŒºå¿',
    address TEXT NOT NULL COMMENT 'è¯¦ç»†åœ°å€',
    location_lat DECIMAL(10,8) COMMENT 'çº¬åº¦',
    location_lng DECIMAL(11,8) COMMENT 'ç»åº¦',
    business_hours JSON COMMENT 'è¥ä¸šæ—¶é—´',
    services JSON COMMENT 'æœåŠ¡é¡¹ç›®',
    images JSON COMMENT 'é—¨åº—å›¾ç‰‡',
    description TEXT COMMENT 'é—¨åº—æè¿°',
    status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    INDEX idx_name (name),
    INDEX idx_code (code),
    INDEX idx_type (type),
    INDEX idx_city (city),
    INDEX idx_status (status),
    INDEX idx_location (location_lat, location_lng)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é—¨åº—è¡¨';
```

#### store_users - é—¨åº—ç”¨æˆ·å…³è”è¡¨
```sql
CREATE TABLE store_users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å…³è”ID',
    store_id BIGINT NOT NULL COMMENT 'é—¨åº—ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role ENUM('manager', 'staff', 'driver') NOT NULL COMMENT 'è§’è‰²',
    permissions JSON COMMENT 'æƒé™åˆ—è¡¨',
    status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_store_user (store_id, user_id),
    INDEX idx_store_id (store_id),
    INDEX idx_user_id (user_id),
    INDEX idx_role (role)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é—¨åº—ç”¨æˆ·å…³è”è¡¨';
```

### 2.4 è®¢å•ç›¸å…³è¡¨

#### orders - è®¢å•è¡¨
```sql
CREATE TABLE orders (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è®¢å•ID',
    order_no VARCHAR(32) UNIQUE NOT NULL COMMENT 'è®¢å•å·',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    vehicle_id BIGINT NOT NULL COMMENT 'è½¦è¾†ID',
    store_id BIGINT NOT NULL COMMENT 'å–è½¦é—¨åº—ID',
    return_store_id BIGINT COMMENT 'è¿˜è½¦é—¨åº—ID',
    start_date DATE NOT NULL COMMENT 'å–è½¦æ—¥æœŸ',
    end_date DATE NOT NULL COMMENT 'è¿˜è½¦æ—¥æœŸ',
    start_time TIME NOT NULL COMMENT 'å–è½¦æ—¶é—´',
    end_time TIME NOT NULL COMMENT 'è¿˜è½¦æ—¶é—´',
    rental_days INT NOT NULL COMMENT 'ç§Ÿèµå¤©æ•°',
    daily_rate DECIMAL(10,2) NOT NULL COMMENT 'æ—¥ç§Ÿé‡‘',
    total_amount DECIMAL(10,2) NOT NULL COMMENT 'è®¢å•æ€»é‡‘é¢',
    deposit_amount DECIMAL(10,2) NOT NULL COMMENT 'æŠ¼é‡‘é‡‘é¢',
    violation_deposit DECIMAL(10,2) NOT NULL DEFAULT 2000.00 COMMENT 'è¿ç« æŠ¼é‡‘',
    actual_amount DECIMAL(10,2) COMMENT 'å®é™…æ”¯ä»˜é‡‘é¢',
    discount_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'ä¼˜æƒ é‡‘é¢',
    coupon_id BIGINT COMMENT 'ä¼˜æƒ åˆ¸ID',
    remark TEXT COMMENT 'è®¢å•å¤‡æ³¨',
    status ENUM('pending', 'paid', 'confirmed', 'ready', 'in_use', 'completed', 'cancelled', 'refunded') NOT NULL DEFAULT 'pending' COMMENT 'è®¢å•çŠ¶æ€',
    payment_status ENUM('unpaid', 'partial', 'paid', 'refunded') NOT NULL DEFAULT 'unpaid' COMMENT 'æ”¯ä»˜çŠ¶æ€',
    deposit_status ENUM('unpaid', 'paid', 'refunded') NOT NULL DEFAULT 'unpaid' COMMENT 'æŠ¼é‡‘çŠ¶æ€',
    pickup_mileage INT COMMENT 'å–è½¦é‡Œç¨‹æ•°',
    return_mileage INT COMMENT 'è¿˜è½¦é‡Œç¨‹æ•°',
    pickup_fuel DECIMAL(5,2) COMMENT 'å–è½¦æ²¹é‡',
    return_fuel DECIMAL(5,2) COMMENT 'è¿˜è½¦æ²¹é‡',
    pickup_images JSON COMMENT 'å–è½¦ç…§ç‰‡',
    return_images JSON COMMENT 'è¿˜è½¦ç…§ç‰‡',
    contract_url VARCHAR(500) COMMENT 'åˆåŒæ–‡ä»¶URL',
    pickup_confirmed_at TIMESTAMP NULL COMMENT 'å–è½¦ç¡®è®¤æ—¶é—´',
    pickup_confirmed_by BIGINT NULL COMMENT 'å–è½¦ç¡®è®¤äººID',
    return_confirmed_at TIMESTAMP NULL COMMENT 'è¿˜è½¦ç¡®è®¤æ—¶é—´',
    return_confirmed_by BIGINT NULL COMMENT 'è¿˜è½¦ç¡®è®¤äººID',
    cancelled_at TIMESTAMP NULL COMMENT 'å–æ¶ˆæ—¶é—´',
    cancelled_by BIGINT NULL COMMENT 'å–æ¶ˆäººID',
    cancel_reason VARCHAR(500) COMMENT 'å–æ¶ˆåŸå› ',
    completed_at TIMESTAMP NULL COMMENT 'å®Œæˆæ—¶é—´',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (vehicle_id) REFERENCES vehicles(id) ON DELETE RESTRICT,
    FOREIGN KEY (store_id) REFERENCES stores(id) ON DELETE RESTRICT,
    FOREIGN KEY (return_store_id) REFERENCES stores(id) ON DELETE SET NULL,
    FOREIGN KEY (pickup_confirmed_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (return_confirmed_by) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (cancelled_by) REFERENCES users(id) ON DELETE SET NULL,

    INDEX idx_order_no (order_no),
    INDEX idx_user_id (user_id),
    INDEX idx_vehicle_id (vehicle_id),
    INDEX idx_store_id (store_id),
    INDEX idx_status (status),
    INDEX idx_start_date (start_date),
    INDEX idx_end_date (end_date),
    INDEX idx_created_at (created_at),
    INDEX idx_user_status (user_id, status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢å•è¡¨';
```

#### order_status_logs - è®¢å•çŠ¶æ€æ—¥å¿—è¡¨
```sql
CREATE TABLE order_status_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    order_id BIGINT NOT NULL COMMENT 'è®¢å•ID',
    from_status VARCHAR(20) COMMENT 'åŸçŠ¶æ€',
    to_status VARCHAR(20) NOT NULL COMMENT 'æ–°çŠ¶æ€',
    operator_id BIGINT COMMENT 'æ“ä½œäººID',
    operator_type ENUM('system', 'user', 'admin', 'mobile_admin') NOT NULL DEFAULT 'system' COMMENT 'æ“ä½œäººç±»å‹',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',

    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    INDEX idx_order_id (order_id),
    INDEX idx_operator_id (operator_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è®¢å•çŠ¶æ€æ—¥å¿—è¡¨';
```

### 2.5 æ”¯ä»˜ç›¸å…³è¡¨

#### payments - æ”¯ä»˜è®°å½•è¡¨
```sql
CREATE TABLE payments (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ”¯ä»˜ID',
    payment_no VARCHAR(32) UNIQUE NOT NULL COMMENT 'æ”¯ä»˜å•å·',
    order_id BIGINT NOT NULL COMMENT 'è®¢å•ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    type ENUM('order', 'deposit', 'violation_deposit', 'penalty', 'compensation') NOT NULL COMMENT 'æ”¯ä»˜ç±»å‹',
    amount DECIMAL(10,2) NOT NULL COMMENT 'æ”¯ä»˜é‡‘é¢',
    method ENUM('wechat', 'alipay', 'balance', 'cash') NOT NULL COMMENT 'æ”¯ä»˜æ–¹å¼',
    channel VARCHAR(50) COMMENT 'æ”¯ä»˜æ¸ é“',
    third_party_no VARCHAR(100) COMMENT 'ç¬¬ä¸‰æ–¹æ”¯ä»˜å•å·',
    status ENUM('pending', 'success', 'failed', 'cancelled', 'refunding', 'refunded') NOT NULL DEFAULT 'pending' COMMENT 'æ”¯ä»˜çŠ¶æ€',
    paid_at TIMESTAMP NULL COMMENT 'æ”¯ä»˜æ—¶é—´',
    refund_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'é€€æ¬¾é‡‘é¢',
    refund_reason VARCHAR(500) COMMENT 'é€€æ¬¾åŸå› ',
    refund_at TIMESTAMP NULL COMMENT 'é€€æ¬¾æ—¶é—´',
    remark VARCHAR(500) COMMENT 'å¤‡æ³¨',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT,

    INDEX idx_payment_no (payment_no),
    INDEX idx_order_id (order_id),
    INDEX idx_user_id (user_id),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¯ä»˜è®°å½•è¡¨';
```

### 2.6 è¥é”€ç›¸å…³è¡¨

#### coupons - ä¼˜æƒ åˆ¸è¡¨
```sql
CREATE TABLE coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ä¼˜æƒ åˆ¸ID',
    name VARCHAR(100) NOT NULL COMMENT 'ä¼˜æƒ åˆ¸åç§°',
    code VARCHAR(20) UNIQUE NOT NULL COMMENT 'ä¼˜æƒ åˆ¸ä»£ç ',
    type ENUM('discount', 'cash', 'percentage') NOT NULL COMMENT 'ä¼˜æƒ åˆ¸ç±»å‹',
    value DECIMAL(10,2) NOT NULL COMMENT 'ä¼˜æƒ åˆ¸é¢å€¼',
    min_amount DECIMAL(10,2) DEFAULT 0.00 COMMENT 'æœ€ä½æ¶ˆè´¹é‡‘é¢',
    max_discount DECIMAL(10,2) COMMENT 'æœ€å¤§ä¼˜æƒ é‡‘é¢',
    quantity INT NOT NULL COMMENT 'å‘æ”¾æ•°é‡',
    used_quantity INT DEFAULT 0 COMMENT 'å·²ä½¿ç”¨æ•°é‡',
    per_user_limit INT DEFAULT 1 COMMENT 'æ¯äººé™é¢†æ•°é‡',
    valid_from TIMESTAMP NOT NULL COMMENT 'æœ‰æ•ˆæœŸå¼€å§‹',
    valid_until TIMESTAMP NOT NULL COMMENT 'æœ‰æ•ˆæœŸç»“æŸ',
    applicable_stores JSON COMMENT 'é€‚ç”¨é—¨åº—',
    applicable_vehicles JSON COMMENT 'é€‚ç”¨è½¦å‹',
    description TEXT COMMENT 'ä½¿ç”¨è¯´æ˜',
    status ENUM('active', 'inactive', 'expired') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    INDEX idx_code (code),
    INDEX idx_type (type),
    INDEX idx_status (status),
    INDEX idx_valid_period (valid_from, valid_until)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ä¼˜æƒ åˆ¸è¡¨';
```

#### user_coupons - ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨
```sql
CREATE TABLE user_coupons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'ç”¨æˆ·ä¼˜æƒ åˆ¸ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    coupon_id BIGINT NOT NULL COMMENT 'ä¼˜æƒ åˆ¸ID',
    order_id BIGINT COMMENT 'ä½¿ç”¨çš„è®¢å•ID',
    code VARCHAR(20) NOT NULL COMMENT 'ä¼˜æƒ åˆ¸ä»£ç ',
    status ENUM('unused', 'used', 'expired') NOT NULL DEFAULT 'unused' COMMENT 'ä½¿ç”¨çŠ¶æ€',
    received_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'é¢†å–æ—¶é—´',
    used_at TIMESTAMP NULL COMMENT 'ä½¿ç”¨æ—¶é—´',
    expired_at TIMESTAMP NOT NULL COMMENT 'è¿‡æœŸæ—¶é—´',

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (coupon_id) REFERENCES coupons(id) ON DELETE CASCADE,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE SET NULL,

    INDEX idx_user_id (user_id),
    INDEX idx_coupon_id (coupon_id),
    INDEX idx_status (status),
    INDEX idx_expired_at (expired_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨';
```

---

## 3. ç³»ç»Ÿç®¡ç†è¡¨

### 3.1 æƒé™ç®¡ç†è¡¨

#### roles - è§’è‰²è¡¨
```sql
CREATE TABLE roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'è§’è‰²ID',
    name VARCHAR(50) UNIQUE NOT NULL COMMENT 'è§’è‰²åç§°',
    code VARCHAR(20) UNIQUE NOT NULL COMMENT 'è§’è‰²ä»£ç ',
    description TEXT COMMENT 'è§’è‰²æè¿°',
    permissions JSON COMMENT 'æƒé™åˆ—è¡¨',
    status ENUM('active', 'inactive') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    INDEX idx_code (code),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='è§’è‰²è¡¨';
```

#### user_roles - ç”¨æˆ·è§’è‰²å…³è”è¡¨
```sql
CREATE TABLE user_roles (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å…³è”ID',
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    role_id BIGINT NOT NULL COMMENT 'è§’è‰²ID',
    granted_by BIGINT COMMENT 'æˆæƒäººID',
    granted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'æˆæƒæ—¶é—´',
    expires_at TIMESTAMP NULL COMMENT 'è¿‡æœŸæ—¶é—´',

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,
    FOREIGN KEY (granted_by) REFERENCES users(id) ON DELETE SET NULL,

    UNIQUE KEY uk_user_role (user_id, role_id),
    INDEX idx_user_id (user_id),
    INDEX idx_role_id (role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è§’è‰²å…³è”è¡¨';
```

### 3.2 ç³»ç»Ÿé…ç½®è¡¨

#### system_configs - ç³»ç»Ÿé…ç½®è¡¨
```sql
CREATE TABLE system_configs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'é…ç½®ID',
    module VARCHAR(50) NOT NULL COMMENT 'é…ç½®æ¨¡å—',
    key VARCHAR(100) NOT NULL COMMENT 'é…ç½®é”®',
    value TEXT COMMENT 'é…ç½®å€¼',
    description TEXT COMMENT 'é…ç½®æè¿°',
    type ENUM('string', 'number', 'boolean', 'json') NOT NULL DEFAULT 'string' COMMENT 'å€¼ç±»å‹',
    is_public BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å…¬å¼€',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',

    UNIQUE KEY uk_module_key (module, key),
    INDEX idx_module (module)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç³»ç»Ÿé…ç½®è¡¨';
```

### 3.3 æ—¥å¿—è¡¨

#### operation_logs - æ“ä½œæ—¥å¿—è¡¨
```sql
CREATE TABLE operation_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    user_id BIGINT COMMENT 'æ“ä½œç”¨æˆ·ID',
    user_type ENUM('customer', 'mobile_admin', 'pc_admin') COMMENT 'ç”¨æˆ·ç±»å‹',
    module VARCHAR(50) NOT NULL COMMENT 'æ“ä½œæ¨¡å—',
    action VARCHAR(50) NOT NULL COMMENT 'æ“ä½œåŠ¨ä½œ',
    resource_type VARCHAR(50) COMMENT 'èµ„æºç±»å‹',
    resource_id BIGINT COMMENT 'èµ„æºID',
    ip_address VARCHAR(45) COMMENT 'IPåœ°å€',
    user_agent TEXT COMMENT 'ç”¨æˆ·ä»£ç†',
    request_data JSON COMMENT 'è¯·æ±‚æ•°æ®',
    response_data JSON COMMENT 'å“åº”æ•°æ®',
    status ENUM('success', 'failed') NOT NULL COMMENT 'æ“ä½œçŠ¶æ€',
    error_message TEXT COMMENT 'é”™è¯¯ä¿¡æ¯',
    duration_ms INT COMMENT 'æ‰§è¡Œæ—¶é•¿(æ¯«ç§’)',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',

    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_user_id (user_id),
    INDEX idx_module (module),
    INDEX idx_action (action),
    INDEX idx_resource (resource_type, resource_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ“ä½œæ—¥å¿—è¡¨';
```

---

## 4. è¡¨å…³ç³»å›¾

### 4.1 æ ¸å¿ƒä¸šåŠ¡å…³ç³»
```
users (ç”¨æˆ·)
â”œâ”€â”€ user_profiles (ç”¨æˆ·æ¡£æ¡ˆ) [1:1]
â”œâ”€â”€ orders (è®¢å•) [1:N]
â”œâ”€â”€ payments (æ”¯ä»˜) [1:N]
â”œâ”€â”€ user_coupons (ç”¨æˆ·ä¼˜æƒ åˆ¸) [1:N]
â”œâ”€â”€ store_users (é—¨åº—ç”¨æˆ·) [1:N]
â””â”€â”€ user_roles (ç”¨æˆ·è§’è‰²) [1:N]

stores (é—¨åº—)
â”œâ”€â”€ vehicles (è½¦è¾†) [1:N]
â”œâ”€â”€ store_users (é—¨åº—ç”¨æˆ·) [1:N]
â””â”€â”€ orders (è®¢å•) [1:N]

vehicle_brands (è½¦è¾†å“ç‰Œ)
â””â”€â”€ vehicle_models (è½¦è¾†å‹å·) [1:N]
    â””â”€â”€ vehicles (è½¦è¾†) [1:N]
        â””â”€â”€ orders (è®¢å•) [1:N]

orders (è®¢å•)
â”œâ”€â”€ order_status_logs (çŠ¶æ€æ—¥å¿—) [1:N]
â”œâ”€â”€ payments (æ”¯ä»˜è®°å½•) [1:N]
â””â”€â”€ user_coupons (ä¼˜æƒ åˆ¸ä½¿ç”¨) [1:1]

coupons (ä¼˜æƒ åˆ¸)
â””â”€â”€ user_coupons (ç”¨æˆ·ä¼˜æƒ åˆ¸) [1:N]
```

---

## 5. ç´¢å¼•è®¾è®¡

### 5.1 ä¸»è¦ç´¢å¼•åˆ—è¡¨
- **users**: username, phone, email, user_type, status
- **vehicles**: store_id, status, license_plate, daily_rate
- **orders**: user_id, vehicle_id, store_id, status, start_date, end_date
- **payments**: order_id, user_id, type, status
- **stores**: city, status, location_lat, location_lng

### 5.2 å¤åˆç´¢å¼•
- **orders**: (user_id, status) - ç”¨æˆ·è®¢å•æŸ¥è¯¢ä¼˜åŒ–
- **vehicles**: (store_id, status) - é—¨åº—è½¦è¾†æŸ¥è¯¢ä¼˜åŒ–
- **vehicles**: (location_lat, location_lng) - åœ°ç†ä½ç½®æŸ¥è¯¢ä¼˜åŒ–

---

## 6. æ•°æ®å­—å…¸æ˜ å°„

è¯¦ç»†çš„å­—æ®µå®šä¹‰å’Œæšä¸¾å€¼è¯´æ˜è¯·å‚è€ƒï¼š[æ•°æ®å­—å…¸.md](./æ•°æ®å­—å…¸.md)

---

## 7. æ•°æ®åº“åˆå§‹åŒ–

### 7.1 åŸºç¡€æ•°æ®æ’å…¥
```sql
-- æ’å…¥é»˜è®¤è§’è‰²
INSERT INTO roles (name, code, description, permissions) VALUES
('è¶…çº§ç®¡ç†å‘˜', 'super_admin', 'ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜', '["*"]'),
('PCç®¡ç†å‘˜', 'pc_admin', 'PCç«¯ç®¡ç†å‘˜', '["order:*", "user:*", "vehicle:*"]'),
('ç§»åŠ¨ç®¡ç†å‘˜', 'mobile_admin', 'ç§»åŠ¨ç«¯ç®¡ç†å‘˜', '["order:read", "order:update", "vehicle:read"]'),
('æ™®é€šç”¨æˆ·', 'customer', 'Cç«¯ç”¨æˆ·', '["order:create", "order:read:own"]');

-- æ’å…¥é»˜è®¤ç³»ç»Ÿé…ç½®
INSERT INTO system_configs (module, `key`, value, description, type, is_public) VALUES
('order', 'auto_cancel_minutes', '30', 'è®¢å•è‡ªåŠ¨å–æ¶ˆæ—¶é—´(åˆ†é’Ÿ)', 'number', false),
('payment', 'deposit_refund_days', '30', 'è¿ç« æŠ¼é‡‘é€€è¿˜å¤©æ•°', 'number', false),
('system', 'maintenance_mode', 'false', 'ç³»ç»Ÿç»´æŠ¤æ¨¡å¼', 'boolean', true);
```

### 7.2 æµ‹è¯•æ•°æ®
```sql
-- æ’å…¥æµ‹è¯•é—¨åº—
INSERT INTO stores (name, code, contact_person, contact_phone, province, city, address) VALUES
('åŒ—äº¬æœé˜³åº—', 'BJ001', 'å¼ ç»ç†', '13800138000', 'åŒ—äº¬å¸‚', 'åŒ—äº¬å¸‚', 'æœé˜³åŒºå»ºå›½è·¯88å·');

-- æ’å…¥æµ‹è¯•è½¦è¾†å“ç‰Œ
INSERT INTO vehicle_brands (name, name_en, country) VALUES
('é•¿åŸæˆ¿è½¦', 'GreatWall RV', 'ä¸­å›½'),
('ä¸Šæ±½å¤§é€š', 'SAIC Maxus', 'ä¸­å›½');
```

---

**æ–‡æ¡£ç»´æŠ¤**: å¨å¨æˆ¿è½¦æŠ€æœ¯å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2025-11-12
**ç‰ˆæœ¬**: v1.0
**ä¸‹æ¬¡å®¡æ ¸**: 2025-12-12