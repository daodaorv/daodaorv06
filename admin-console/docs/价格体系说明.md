# 叨叨房车租赁平台 - 价格体系说明文档

> **版本**: v1.0
> **最后更新**: 2025-12-21
> **维护者**: 开发团队

---

## 📋 目录

1. [价格体系概述](#价格体系概述)
2. [两层价格架构](#两层价格架构)
3. [车型基础价格](#车型基础价格)
4. [车辆基础租金](#车辆基础租金)
5. [动态定价系统](#动态定价系统)
6. [价格计算流程](#价格计算流程)
7. [使用场景](#使用场景)
8. [常见问题](#常见问题)

---

## 价格体系概述

叨叨房车租赁平台采用**两层价格架构**，分别服务于不同的业务场景：

```
┌─────────────────────────────────────────────────────────┐
│                    价格体系架构                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  第一层：车型级别价格（VehicleModel.dailyPrice）        │
│  ├─ 用途：价格策略管理、动态定价                        │
│  ├─ 管理：营销管理 → 价格日历                          │
│  └─ 特点：统一的车型基础价格                            │
│                                                          │
│  第二层：车辆级别价格（Vehicle.dailyPrice）             │
│  ├─ 用途：实际车辆租金管理                              │
│  ├─ 管理：车辆管理 → 车辆列表 → 基础租金计算器         │
│  └─ 特点：根据车况、购买价格等因素个性化定价           │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 两层价格架构

### 为什么需要两层价格？

**业务需求：**
1. **价格策略管理**需要在车型级别设置统一的基础价格
2. **实际车辆管理**需要根据车况、购买价格等因素有不同的价格
3. 两者服务于不同的业务场景，互不冲突

**设计优势：**
- ✅ 价格策略管理更灵活（按车型统一管理）
- ✅ 车辆定价更精准（考虑车况等个性化因素）
- ✅ 业务逻辑清晰（各司其职）

---

## 车型基础价格

### 数据模型

```typescript
interface VehicleModel {
  id: number
  modelName: string
  dailyPrice: number  // 车型基础日租金
  // ... 其他字段
}
```

### 用途

**1. 价格策略管理（价格日历）**
- 设置车型的统一基础价格
- 作为动态定价的基准价格
- 应用城市因子、时间因子等进行调整

**2. 动态定价展示**
- 用户在小程序端看到的价格
- 根据城市、日期等因素动态计算

### 管理位置

**路径**: 营销管理 → 价格日历

**功能**:
- 查看车型价格日历
- 批量调价
- 查看价格详情
- 应用城市因子、时间因子

---

## 车辆基础租金

### 数据模型

```typescript
interface Vehicle {
  id: number
  modelId: number
  licensePlate: string

  // 🆕 车况评级
  conditionGrade: 'A' | 'B' | 'C' | 'D'
  conditionScore?: number

  // 🆕 基础租金
  dailyPrice: number
  suggestedDailyPrice?: number
  priceSource: 'calculated' | 'manual' | 'inherited'

  // 🆕 租金计算参数（可选，用于追溯）
  calculationParams?: {
    targetAnnualReturn: number
    residualValueRate: number
    annualOperatingRate: number
    operatingCostRate: number
    conditionPremium: number
    calculatedAt: string
  }
}
```

### 车况评级

| 等级 | 名称 | 车龄范围 | 溢价系数 | 说明 |
|-----|------|---------|---------|------|
| A | 优秀 | 0-12个月 | 1.30 | 新车，车况极佳 |
| B | 良好 | 13-36个月 | 1.15 | 次新车，车况良好 |
| C | 一般 | 37-60个月 | 0.90 | 中等车龄，车况一般 |
| D | 较旧 | 60个月以上 | 0.75 | 老旧车辆，车况较差 |

### 价格来源

- **calculated**: 使用基础租金计算器计算
- **manual**: 管理员手动设置
- **inherited**: 继承自车型基础价格

### 管理位置

**路径**: 车辆管理 → 车辆列表 → 编辑车辆 → 基础租金计算器

**功能**:
- 输入购买价格、购买日期
- 自动检测车况评级
- 配置财务参数（年化收益率、投资周期、残值率）
- 配置运营参数（年运营率、成本占比）
- 查看计算明细
- 应用建议价格

---

## 动态定价系统

### 价格计算公式

```
最终租金 = 车型基础价格 × (1 + 城市因子) × (1 + 时间因子)
```

### 因子类型

**1. 城市因子**
- 根据城市等级调整价格
- 一线城市：+20%
- 二线城市：+10%
- 三线城市：0%

**2. 时间因子**
- 法定节假日：+30%
- 周末：+15%
- 工作日：0%
- 淡季：-10%

### 示例

```
车型基础价格：500元/天
城市因子：+20%（一线城市）
时间因子：+30%（国庆节）

最终租金 = 500 × (1 + 0.2) × (1 + 0.3) = 780元/天
```

---

## 价格计算流程

### 车辆基础租金计算流程

```
1. 输入参数
   ├─ 购买价格：300,000元
   ├─ 购买日期：2023-01-01
   └─ 车况评级：B（自动检测）

2. 系统参数（可配置）
   ├─ 目标年化收益率：3%
   ├─ 投资周期：5年
   ├─ 残值率：30%
   ├─ 年运营率：30%
   └─ 运营成本占比：40%

3. 计算步骤
   ├─ 步骤1：计算预期总资产
   │   预期总资产 = 购买价格 × (1 + 年化收益率)^投资周期
   │   = 300,000 × (1 + 0.03)^5 = 347,782元
   │
   ├─ 步骤2：计算残值
   │   残值 = 购买价格 × 残值率
   │   = 300,000 × 0.30 = 90,000元
   │
   ├─ 步骤3：计算所需净收入
   │   所需净收入 = 预期总资产 - 残值
   │   = 347,782 - 90,000 = 257,782元
   │
   ├─ 步骤4：计算总营收
   │   总营收 = 所需净收入 ÷ (1 - 运营成本占比)
   │   = 257,782 ÷ (1 - 0.40) = 429,637元
   │
   ├─ 步骤5：计算年均营收
   │   年均营收 = 总营收 ÷ 投资周期
   │   = 429,637 ÷ 5 = 85,927元/年
   │
   ├─ 步骤6：计算实际年运营天数
   │   实际年运营天数 = 365 × 年运营率
   │   = 365 × 0.30 = 110天
   │
   ├─ 步骤7：计算基础日租金
   │   基础日租金 = 年均营收 ÷ 实际年运营天数
   │   = 85,927 ÷ 110 = 781元/天
   │
   └─ 步骤8：应用车况溢价
       建议日租金 = 基础日租金 × 车况溢价系数
       = 781 × 1.15 (B级) = 898元/天

4. 输出结果
   └─ 建议日租金：898元/天
```

### 动态定价计算流程

```
1. 获取车型基础价格
   └─ VehicleModel.dailyPrice = 500元/天

2. 应用城市因子
   ├─ 查询门店所在城市
   ├─ 获取城市因子：+20%
   └─ 价格 = 500 × (1 + 0.2) = 600元/天

3. 应用时间因子
   ├─ 查询日期是否为节假日
   ├─ 获取时间因子：+30%
   └─ 价格 = 600 × (1 + 0.3) = 780元/天

4. 输出最终价格
   └─ 最终租金：780元/天
```

---

## 使用场景

### 场景1：新增车辆

**步骤：**
1. 在"车辆管理 → 车辆列表"中新增车辆
2. 填写基本信息（车牌号、购买价格、购买日期等）
3. 打开"基础租金计算器"
4. 系统自动检测车况评级
5. 调整财务和运营参数（可选）
6. 查看计算明细和建议价格
7. 点击"应用价格"或手动输入价格
8. 保存车辆信息

**结果：**
- 车辆有了个性化的基础租金
- 价格来源标记为"calculated"或"manual"
- 计算参数被保存，便于追溯

### 场景2：调整车型价格策略

**步骤：**
1. 在"营销管理 → 价格日历"中选择车型和门店
2. 查看价格日历
3. 选择需要调价的日期
4. 批量调价或单日调价
5. 应用城市因子、时间因子
6. 保存价格策略

**结果：**
- 车型的动态定价被更新
- 用户在小程序端看到新的价格
- 不影响车辆的基础租金

### 场景3：配置系统参数

**步骤：**
1. 在"系统管理 → 租金计算参数"中配置参数
2. 修改财务参数（年化收益率、投资周期、残值率）
3. 修改运营参数（年运营率、成本占比）
4. 保存配置

**结果：**
- 新的计算参数生效
- 后续使用计算器时使用新参数
- 已保存的车辆租金不受影响

---

## 常见问题

### Q1: 车型基础价格和车辆基础租金有什么区别？

**A**:
- **车型基础价格**：用于价格策略管理和动态定价，是车型级别的统一价格
- **车辆基础租金**：用于实际车辆管理，是车辆级别的个性化价格，考虑车况等因素

### Q2: 修改车型基础价格会影响车辆基础租金吗？

**A**: 不会。两者是独立的价格体系，互不影响。

### Q3: 用户在小程序端看到的价格是哪个？

**A**: 用户看到的是**动态定价**，基于车型基础价格，应用城市因子、时间因子等计算得出。

### Q4: 车辆基础租金的作用是什么？

**A**: 车辆基础租金主要用于：
1. 内部管理：了解每辆车的成本和收益
2. 定价参考：为价格策略提供参考依据
3. 财务分析：计算车辆的投资回报率

### Q5: 如何确保车辆基础租金的准确性？

**A**:
1. 使用基础租金计算器，基于财务模型科学计算
2. 定期审查和调整系统参数
3. 根据实际运营数据优化参数配置
4. 保存计算参数，便于追溯和审计

### Q6: 可以手动设置车辆基础租金吗？

**A**: 可以。管理员可以：
1. 使用计算器计算后手动调整
2. 直接手动输入价格
3. 系统会记录价格来源（calculated/manual/inherited）

### Q7: 系统参数修改后，已有车辆的价格会变化吗？

**A**: 不会。系统参数修改只影响后续使用计算器的新计算，已保存的车辆价格不会自动更新。

### Q8: 如何批量更新车辆基础租金？

**A**: 目前需要逐个车辆使用计算器重新计算。未来可以考虑开发批量计算功能。

---

## 附录：相关文档

### 代码文件

**车辆基础租金相关：**
- `admin-console/src/types/system.ts` - 类型定义
- `admin-console/src/utils/baseRentalCalculator.ts` - 计算逻辑
- `admin-console/src/constants/conditionGrades.ts` - 车况评级配置
- `admin-console/src/components/vehicle/BaseRentalCalculator.vue` - 计算器组件
- `admin-console/src/views/vehicle/VehicleList.vue` - 车辆列表页面
- `admin-console/src/views/system/RentalCalculationConfig.vue` - 参数配置页面

**价格策略管理相关：**
- `admin-console/src/api/priceCalendar.ts` - 价格日历 API
- `admin-console/src/views/marketing/PriceCalendar.vue` - 价格日历页面
- `admin-console/src/utils/pricingHelper.ts` - 动态定价计算

### 菜单路径

- **车辆管理** → 车辆列表 → 编辑车辆 → 基础租金计算器
- **营销管理** → 价格日历
- **系统管理** → 租金计算参数

---

**文档版本**: v1.0
**最后更新**: 2025-12-21
**维护者**: 开发团队
**状态**: ✅ 已完成
