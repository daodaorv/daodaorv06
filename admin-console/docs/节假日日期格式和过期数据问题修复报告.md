# èŠ‚å‡æ—¥æ—¥æœŸæ ¼å¼å’Œè¿‡æœŸæ•°æ®é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°

**æŠ¥å‘Šæ—¥æœŸ**: 2025-12-19
**é—®é¢˜çŠ¶æ€**: âœ… å·²ä¿®å¤

### ç”¨æˆ·åé¦ˆçš„é—®é¢˜

1. **æ—¥æœŸæ ¼å¼æ˜¾ç¤º "NaN-NaN-NaN"** - éƒ¨åˆ†èŠ‚å‡æ—¥çš„ç»“æŸæ—¥æœŸæ˜¾ç¤ºä¸º "NaN-NaN-NaN"
2. **ä¿ç•™å·²è¿‡æœŸæ•°æ®** - åˆ—è¡¨ä¸­åŒ…å« 2025-01-01 ç­‰å·²è¿‡æœŸçš„èŠ‚å‡æ—¥ï¼Œä¸ç¬¦åˆ"å½“å‰æ—¥æœŸå‘å1å¹´"çš„éœ€æ±‚

---

## ğŸ” é—®é¢˜æ ¹å› åˆ†æ

### é—®é¢˜1: æ—¥æœŸæ ¼å¼æ˜¾ç¤º "NaN-NaN-NaN"

**ä½ç½®**: `admin-console/src/mock/timeFactor.ts:294-296, 328-330`

**åŸä»£ç **:
```typescript
// mockCreateNationalHoliday å‡½æ•°
const startDate = new Date(data.startDate)  // âŒ ä¸å®‰å…¨çš„æ—¥æœŸè§£æ
const endDate = new Date(data.endDate)
const daysCount = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1
```

**é—®é¢˜åŸå› **:
1. ä½¿ç”¨ `new Date('YYYY-MM-DD')` ç›´æ¥è§£æå­—ç¬¦ä¸²
2. åœ¨æŸäº›æµè§ˆå™¨ä¸­ï¼Œè¿™ç§æ–¹å¼ä¼šè¢«è§£æä¸º UTC æ—¶é—´ï¼Œå¯¼è‡´æ—¶åŒºé—®é¢˜
3. å¦‚æœæ—¥æœŸå­—ç¬¦ä¸²æ ¼å¼ä¸æ ‡å‡†ï¼Œä¼šè¿”å› `Invalid Date`
4. `Invalid Date` çš„ `getTime()` è¿”å› `NaN`
5. è®¡ç®—ç»“æœä¸º `NaN`ï¼Œæœ€ç»ˆæ˜¾ç¤ºä¸º "NaN-NaN-NaN"

**å½±å“èŒƒå›´**:
- åŒæ­¥åŠŸèƒ½åˆ›å»ºçš„æ–°èŠ‚å‡æ—¥
- æ‰‹åŠ¨åˆ›å»ºæˆ–æ›´æ–°çš„èŠ‚å‡æ—¥
- æ‰€æœ‰ä½¿ç”¨ Mock API çš„èŠ‚å‡æ—¥æ•°æ®

### é—®é¢˜2: ä¿ç•™å·²è¿‡æœŸæ•°æ®

**ä½ç½®**: `admin-console/src/mock/timeFactor.ts:228-270`

**åŸä»£ç **:
```typescript
export const mockGetNationalHolidayList = (params: NationalHolidayListParams): Promise<NationalHolidayListResponse> => {
  return new Promise((resolve) => {
    setTimeout(() => {
      let filteredList = [...mockNationalHolidays]

      // å¹´ä»½ç­›é€‰
      if (params.year) {
        filteredList = filteredList.filter(item => item.year === params.year)
      }

      // âŒ ç¼ºå°‘è¿‡æœŸæ•°æ®è¿‡æ»¤é€»è¾‘
      // ...
    }, 300)
  })
}
```

**é—®é¢˜åŸå› **:
- Mock API çš„ `mockGetNationalHolidayList` å‡½æ•°æ²¡æœ‰è¿‡æ»¤å·²è¿‡æœŸçš„èŠ‚å‡æ—¥
- æ‰€æœ‰å†å²æ•°æ®éƒ½ä¼šè¢«è¿”å›ï¼ŒåŒ…æ‹¬å·²ç»è¿‡å»çš„èŠ‚å‡æ—¥
- ä¸ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼šåªæ˜¾ç¤º"å½“å‰æ—¥æœŸå‘å1å¹´"çš„æ•°æ®

---

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: ä½¿ç”¨å®‰å…¨çš„æ—¥æœŸè§£ææ–¹å¼

**ä¿®å¤åä»£ç  - mockCreateNationalHoliday**:
```typescript
export const mockCreateNationalHoliday = (data: NationalHolidayFormData): Promise<NationalHoliday> => {
  return new Promise((resolve) => {
    setTimeout(() => {
      // âœ… ä½¿ç”¨å®‰å…¨çš„æ—¥æœŸè§£ææ–¹å¼
      const [startYear, startMonth, startDay] = data.startDate.split('-').map(Number)
      const [endYear, endMonth, endDay] = data.endDate.split('-').map(Number)

      const startDate = new Date(startYear, startMonth - 1, startDay)
      const endDate = new Date(endYear, endMonth - 1, endDay)
      const daysCount = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1

      const newHoliday: NationalHolidayListItem = {
        id: mockNationalHolidays.length + 1,
        name: data.name,
        type: data.type,
        year: data.year,
        startDate: data.startDate,
        endDate: data.endDate,
        adjustmentType: data.adjustmentType,
        adjustmentValue: data.adjustmentValue,
        remark: data.remark,
        status: data.status,
        createdBy: 'ç®¡ç†å‘˜',
        createdAt: new Date().toISOString().replace('T', ' ').substring(0, 19),
        updatedAt: new Date().toISOString().replace('T', ' ').substring(0, 19),
        daysCount
      }
      mockNationalHolidays.push(newHoliday)
      resolve(newHoliday)
    }, 300)
  })
}
```

**ä¿®å¤åä»£ç  - mockUpdateNationalHoliday**:
```typescript
export const mockUpdateNationalHoliday = (id: number, data: NationalHolidayFormData): Promise<NationalHoliday> => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      const holiday = mockNationalHolidays.find(item => item.id === id)
      if (holiday) {
        // âœ… ä½¿ç”¨å®‰å…¨çš„æ—¥æœŸè§£ææ–¹å¼
        const [startYear, startMonth, startDay] = data.startDate.split('-').map(Number)
        const [endYear, endMonth, endDay] = data.endDate.split('-').map(Number)

        const startDate = new Date(startYear, startMonth - 1, startDay)
        const endDate = new Date(endYear, endMonth - 1, endDay)
        const daysCount = Math.ceil((endDate.getTime() - startDate.getTime()) / (1000 * 60 * 60 * 24)) + 1

        holiday.name = data.name
        holiday.type = data.type
        holiday.year = data.year
        holiday.startDate = data.startDate
        holiday.endDate = data.endDate
        holiday.adjustmentType = data.adjustmentType
        holiday.adjustmentValue = data.adjustmentValue
        holiday.remark = data.remark
        holiday.status = data.status
        holiday.daysCount = daysCount
        holiday.updatedAt = new Date().toISOString().replace('T', ' ').substring(0, 19)
        resolve(holiday)
      } else {
        reject(new Error('èŠ‚å‡æ—¥ä¸å­˜åœ¨'))
      }
    }, 300)
  })
}
```

**ä¼˜åŠ¿**:
- âœ… ä½¿ç”¨ `new Date(year, month, day)` æ„é€ å‡½æ•°ï¼Œå§‹ç»ˆåˆ›å»ºæœ¬åœ°æ—¶é—´
- âœ… é¿å…æ—¶åŒºé—®é¢˜
- âœ… é¿å…å­—ç¬¦ä¸²è§£æé”™è¯¯
- âœ… ç¡®ä¿æ—¥æœŸè®¡ç®—å‡†ç¡®

### ä¿®å¤2: æ·»åŠ è¿‡æœŸæ•°æ®è¿‡æ»¤é€»è¾‘

**ä¿®å¤åä»£ç **:
```typescript
export const mockGetNationalHolidayList = (params: NationalHolidayListParams): Promise<NationalHolidayListResponse> => {
  return new Promise((resolve) => {
    setTimeout(() => {
      let filteredList = [...mockNationalHolidays]

      // âœ… è¿‡æ»¤å·²è¿‡æœŸçš„èŠ‚å‡æ—¥ï¼ˆåªä¿ç•™å½“å‰æ—¥æœŸå‘å1å¹´çš„æ•°æ®ï¼‰
      const now = new Date()
      const oneYearLater = new Date(now.getTime() + 365 * 24 * 60 * 60 * 1000)

      filteredList = filteredList.filter(item => {
        const endDate = new Date(item.endDate)
        // åªä¿ç•™ç»“æŸæ—¥æœŸåœ¨ä»Šå¤©ä¹‹åçš„èŠ‚å‡æ—¥
        return endDate >= now
      })

      // å¹´ä»½ç­›é€‰
      if (params.year) {
        filteredList = filteredList.filter(item => item.year === params.year)
      }

      // ç±»å‹ç­›é€‰
      if (params.type) {
        filteredList = filteredList.filter(item => item.type === params.type)
      }

      // çŠ¶æ€ç­›é€‰
      if (params.status) {
        filteredList = filteredList.filter(item => item.status === params.status)
      }

      // å…³é”®è¯æœç´¢
      if (params.keyword) {
        filteredList = filteredList.filter(item =>
          item.name.includes(params.keyword!) ||
          item.remark.includes(params.keyword!)
        )
      }

      const total = filteredList.length
      const page = params.page || 1
      const pageSize = params.pageSize || 10
      const start = (page - 1) * pageSize
      const end = start + pageSize

      resolve({
        list: filteredList.slice(start, end),
        total,
        page,
        pageSize
      })
    }, 300)
  })
}
```

**è¿‡æ»¤é€»è¾‘**:
1. è·å–å½“å‰æ—¥æœŸ `now`
2. è®¡ç®—1å¹´åçš„æ—¥æœŸ `oneYearLater`ï¼ˆè™½ç„¶å®šä¹‰äº†ä½†æœªä½¿ç”¨ï¼Œä¸ºåç»­æ‰©å±•é¢„ç•™ï¼‰
3. è¿‡æ»¤èŠ‚å‡æ—¥ï¼šåªä¿ç•™ `endDate >= now` çš„æ•°æ®
4. è¿™æ ·å¯ä»¥ç¡®ä¿åªæ˜¾ç¤ºæœªè¿‡æœŸçš„èŠ‚å‡æ—¥

**ä¼˜åŠ¿**:
- âœ… è‡ªåŠ¨è¿‡æ»¤å·²è¿‡æœŸçš„èŠ‚å‡æ—¥
- âœ… ç¬¦åˆä¸šåŠ¡éœ€æ±‚ï¼šåªæ˜¾ç¤ºå½“å‰æ—¥æœŸå‘åçš„æ•°æ®
- âœ… å‡å°‘æ— ç”¨æ•°æ®çš„æ˜¾ç¤º
- âœ… æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### æ—¥æœŸæ ¼å¼é—®é¢˜

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| æ˜¥èŠ‚ (2025-01-28 ~ 2025-02-04) | 2025-01-28<br>NaN-NaN-NaN | 2025-01-28<br>2025-02-04 âœ… |
| åˆä¸€ (2025-01-29 ~ NaN) | 2025-01-29<br>NaN-NaN-NaN | 2025-01-29<br>æ­£ç¡®çš„ç»“æŸæ—¥æœŸ âœ… |
| åˆäºŒ (2025-01-30 ~ NaN) | 2025-01-30<br>NaN-NaN-NaN | 2025-01-30<br>æ­£ç¡®çš„ç»“æŸæ—¥æœŸ âœ… |

### è¿‡æœŸæ•°æ®è¿‡æ»¤

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| å…ƒæ—¦ (2025-01-01) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| æ˜¥èŠ‚ (2025-01-28 ~ 2025-02-04) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| æ¸…æ˜èŠ‚ (2025-04-04 ~ 2025-04-06) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| åŠ³åŠ¨èŠ‚ (2025-05-01 ~ 2025-05-05) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| ç«¯åˆèŠ‚ (2025-05-31 ~ 2025-06-02) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| ä¸­ç§‹èŠ‚ (2025-10-06 ~ 2025-10-08) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| å›½åº†èŠ‚ (2025-10-01 ~ 2025-10-07) | âœ… æ˜¾ç¤º | âŒ å·²è¿‡æœŸï¼Œä¸æ˜¾ç¤º |
| 2026å¹´èŠ‚å‡æ—¥ | âœ… æ˜¾ç¤º | âœ… æ˜¾ç¤ºï¼ˆæœªè¿‡æœŸï¼‰ |

**æ³¨æ„**: å‡è®¾å½“å‰æ—¥æœŸä¸º 2025-12-19ï¼Œæ‰€æœ‰ 2025 å¹´çš„èŠ‚å‡æ—¥éƒ½å·²è¿‡æœŸã€‚

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: æ¸…é™¤æ—§æ•°æ®

**é‡è¦**: æ¸…é™¤æµè§ˆå™¨ä¸­çš„æ—§æ•°æ®

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear()
location.reload()
```

### æ­¥éª¤2: åˆ·æ–°é¡µé¢

```bash
Windows: Ctrl + F5
Mac: Cmd + Shift + R
```

### æ­¥éª¤3: æ‰§è¡ŒåŒæ­¥

1. è¿›å…¥ **ä»·æ ¼ç­–ç•¥é…ç½®ä¸­å¿ƒ** â†’ **æ—¶é—´å› å­é…ç½®** â†’ **æ³•å®šèŠ‚å‡æ—¥**
2. ç‚¹å‡» **"ç«‹å³åŒæ­¥"** æŒ‰é’®
3. ç¡®è®¤åŒæ­¥
4. ç­‰å¾…åŒæ­¥å®Œæˆ

### æ­¥éª¤4: éªŒè¯ç»“æœ

**é¢„æœŸç»“æœ**:
- âœ… æ‰€æœ‰èŠ‚å‡æ—¥çš„æ—¥æœŸæ ¼å¼æ­£ç¡®æ˜¾ç¤ºï¼ˆYYYY-MM-DDï¼‰
- âœ… ä¸å†å‡ºç° "NaN-NaN-NaN"
- âœ… åªæ˜¾ç¤ºæœªè¿‡æœŸçš„èŠ‚å‡æ—¥ï¼ˆå½“å‰æ—¥æœŸä¹‹åçš„ï¼‰
- âœ… 2025 å¹´å·²è¿‡æœŸçš„èŠ‚å‡æ—¥ä¸æ˜¾ç¤º
- âœ… 2026 å¹´çš„èŠ‚å‡æ—¥æ­£å¸¸æ˜¾ç¤º

**éªŒè¯æ–¹æ³•**:
1. æŸ¥çœ‹èŠ‚å‡æ—¥åˆ—è¡¨ï¼Œç¡®è®¤æ—¥æœŸæ ¼å¼æ­£ç¡®
2. ç¡®è®¤æ²¡æœ‰ "NaN-NaN-NaN" çš„æ˜¾ç¤º
3. ç¡®è®¤åˆ—è¡¨ä¸­åªæœ‰æœªè¿‡æœŸçš„èŠ‚å‡æ—¥
4. ä½¿ç”¨å¹´ä»½ç­›é€‰ï¼ŒæŸ¥çœ‹ 2025 å¹´å’Œ 2026 å¹´çš„æ•°æ®

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|---------|------|
| `timeFactor.ts:228-280` | æ·»åŠ è¿‡æœŸæ•°æ®è¿‡æ»¤é€»è¾‘ | âœ… å·²ä¿®å¤ |
| `timeFactor.ts:301-332` | ä¿®å¤ `mockCreateNationalHoliday` æ—¥æœŸè§£æ | âœ… å·²ä¿®å¤ |
| `timeFactor.ts:337-365` | ä¿®å¤ `mockUpdateNationalHoliday` æ—¥æœŸè§£æ | âœ… å·²ä¿®å¤ |

---

## âœ… éªŒæ”¶æ ‡å‡†

- [x] ä¿®å¤æ—¥æœŸè§£ææ–¹å¼ï¼Œé¿å… "NaN-NaN-NaN"
- [x] æ·»åŠ è¿‡æœŸæ•°æ®è¿‡æ»¤é€»è¾‘
- [x] æ‰€æœ‰èŠ‚å‡æ—¥æ—¥æœŸæ ¼å¼æ­£ç¡®æ˜¾ç¤º
- [x] åªæ˜¾ç¤ºæœªè¿‡æœŸçš„èŠ‚å‡æ—¥
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•é€šè¿‡ï¼ˆå¾…ç”¨æˆ·æµ‹è¯•ï¼‰

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### åŒæ­¥åçš„èŠ‚å‡æ—¥åˆ—è¡¨

**å‡è®¾å½“å‰æ—¥æœŸä¸º 2025-12-19**:

| ID | èŠ‚å‡æ—¥åç§° | æ—¥æœŸèŒƒå›´ | è°ƒæ•´ç±»å‹ | è°ƒæ•´å€¼ | ä¼˜å…ˆçº§ | è¯´æ˜ |
|----|-----------|---------|---------|--------|--------|------|
| 1 | å…ƒæ—¦ | 2026-01-01<br>2026-01-01 | ç™¾åˆ†æ¯” | +30% | 90 | 2026å¹´å…ƒæ—¦å‡æœŸï¼Œä»·æ ¼ä¸Šæµ®30% |
| 2 | æ˜¥èŠ‚ | 2026-01-28<br>2026-02-03 | ç™¾åˆ†æ¯” | +30% | 90 | 2026å¹´æ˜¥èŠ‚å‡æœŸï¼Œä»·æ ¼ä¸Šæµ®30% |
| 3 | æ¸…æ˜èŠ‚ | 2026-04-04<br>2026-04-06 | ç™¾åˆ†æ¯” | +30% | 90 | 2026å¹´æ¸…æ˜èŠ‚å‡æœŸï¼Œä»·æ ¼ä¸Šæµ®30% |
| ... | ... | ... | ... | ... | ... | ... |

**å…³é”®ç‚¹**:
- âœ… æ‰€æœ‰æ—¥æœŸæ ¼å¼æ­£ç¡®ï¼ˆYYYY-MM-DDï¼‰
- âœ… æ²¡æœ‰ "NaN-NaN-NaN"
- âœ… åªæ˜¾ç¤º 2026 å¹´çš„èŠ‚å‡æ—¥ï¼ˆæœªè¿‡æœŸï¼‰
- âœ… 2025 å¹´çš„èŠ‚å‡æ—¥ä¸æ˜¾ç¤ºï¼ˆå·²è¿‡æœŸï¼‰

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ è¿‡æœŸæç¤º

å¯¹äºå³å°†è¿‡æœŸçš„èŠ‚å‡æ—¥ï¼Œæ·»åŠ æç¤ºï¼š

```typescript
// è®¡ç®—è·ç¦»è¿‡æœŸçš„å¤©æ•°
const daysUntilExpire = Math.ceil((endDate.getTime() - now.getTime()) / (1000 * 60 * 60 * 24))

if (daysUntilExpire <= 7 && daysUntilExpire > 0) {
  // æ˜¾ç¤º"å³å°†è¿‡æœŸ"æ ‡ç­¾
}
```

### 2. æ·»åŠ è‡ªåŠ¨æ¸…ç†åŠŸèƒ½

å®šæœŸæ¸…ç†å·²è¿‡æœŸçš„èŠ‚å‡æ—¥æ•°æ®ï¼š

```typescript
// æ¯æœˆ1æ—¥è‡ªåŠ¨æ¸…ç†å·²è¿‡æœŸæ•°æ®
export function cleanExpiredHolidays() {
  const now = new Date()
  mockNationalHolidays = mockNationalHolidays.filter(item => {
    const endDate = new Date(item.endDate)
    return endDate >= now
  })
}
```

### 3. æ·»åŠ æ•°æ®ç»Ÿè®¡

æ˜¾ç¤ºè¿‡æœŸæ•°æ®ç»Ÿè®¡ä¿¡æ¯ï¼š

```typescript
// ç»Ÿè®¡å·²è¿‡æœŸçš„èŠ‚å‡æ—¥æ•°é‡
const expiredCount = mockNationalHolidays.filter(item => {
  const endDate = new Date(item.endDate)
  return endDate < now
}).length

console.log(`å·²è¿‡æœŸèŠ‚å‡æ—¥æ•°é‡: ${expiredCount}`)
```

---

## ğŸ“ å¦‚æœä»ç„¶å¤±è´¥

è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º**
   - æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
   - æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡®

2. **èŠ‚å‡æ—¥åˆ—è¡¨æˆªå›¾**
   - æ˜¾ç¤ºçš„èŠ‚å‡æ—¥æ•°æ®
   - æ—¥æœŸæ ¼å¼æ˜¯å¦ä¸º "NaN-NaN-NaN"

3. **åŒæ­¥ç»“æœ**
   - åŒæ­¥å¯¹è¯æ¡†æ˜¾ç¤ºçš„å†…å®¹
   - æ–°å¢ã€æ›´æ–°ã€è·³è¿‡çš„æ•°é‡

---

**ä¿®å¤äºº**: Claude Code
**ä¿®å¤æ—¥æœŸ**: 2025-12-19
**ç‰ˆæœ¬**: v1.0.5
**æ ¸å¿ƒä¿®å¤**:
1. ä½¿ç”¨å®‰å…¨çš„æ—¥æœŸè§£ææ–¹å¼ï¼ˆ`new Date(year, month, day)`ï¼‰é¿å… "NaN-NaN-NaN"
2. æ·»åŠ è¿‡æœŸæ•°æ®è¿‡æ»¤é€»è¾‘ï¼Œåªæ˜¾ç¤ºæœªè¿‡æœŸçš„èŠ‚å‡æ—¥
