# 叨叨房车管理端开发指南

**文档版本**: v2.0 | **创建时间**: 2024-11-24 | **更新时间**: 2024-11-24

---

## 1. 开发环境搭建

### 1.1 系统要求

- **操作系统**: Windows 10+, macOS 10.15+, Ubuntu 18.04+
- **Node.js**: 18.18.0 LTS (必需)
- **npm**: 9.0+ 或 yarn 1.22+
- **Git**: 2.20+
- **VSCode**: 1.80+ (推荐)

### 1.2 快速开始

```bash
# 克隆项目
git clone <repository-url>
cd daodao/admin-console

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 浏览器访问: http://localhost:5173
```

### 1.3 环境配置

创建 `.env.local` 文件：
```env
# API服务地址
VITE_API_BASE_URL=http://localhost:3000

# 应用配置
VITE_APP_TITLE=叨叨房车管理系统
VITE_APP_VERSION=2.0.0

# 开发配置
VITE_MOCK=false
VITE_DEV_TOOLS=true

# 权限配置
VITE_PERMISSION_MODE=backend  # backend|frontend
```

---

## 2. 项目架构概览

### 2.1 技术栈

**核心技术**:
- Vue 3.5.0 (Composition API)
- TypeScript 5.1.6
- Element Plus 2.11.7
- Vite 4.4.9

**状态和路由**:
- Pinia 2.1.7 (状态管理)
- Vue Router 4.2.5 (路由管理)

**开发工具**:
- ESLint + Prettier (代码规范)
- Vitest (单元测试)
- Husky (Git钩子)

### 2.2 目录结构

```
admin-console/
├── src/
│   ├── api/                    # API接口层
│   │   ├── index.ts           # 请求配置
│   │   ├── auth.ts            # 认证接口
│   │   ├── user.ts            # 用户管理
│   │   ├── vehicle.ts         # 车辆管理
│   │   └── modules/           # 业务模块接口
│   ├── assets/                 # 静态资源
│   │   ├── images/            # 图片
│   │   ├���─ icons/             # 图标
│   │   └── styles/            # 全局样式
│   ├── components/             # 公共组件
│   │   ├── common/            # 通用组件
│   │   │   ├── SearchForm.vue
│   │   │   ├── DataTable.vue
│   │   │   └── ConfirmDialog.vue
│   │   ├── business/          # 业务组件
│   │   │   ├── UserSelector.vue
│   │   │   ├── VehicleCard.vue
│   │   │   └── OrderStatus.vue
│   │   └── layout/            # 布局组件
│   │       ├── Sidebar.vue
│   │       ├── Header.vue
│   │       └── Breadcrumb.vue
│   ├── composables/           # 组合式函数
│   │   ├── useAuth.ts         # 认证逻辑
│   │   ├── usePermission.ts   # 权限控制
│   │   ├── useTable.ts        # 表格逻辑
│   │   └── useDialog.ts       # 弹窗逻辑
│   ├── directives/            # 自定义指令
│   │   ├── permission.ts      # 权限指令
│   │   └── loading.ts         # 加载指令
│   ├── layouts/               # 页面布局
│   │   ├── DefaultLayout.vue  # 默认布局
│   │   └── AuthLayout.vue     # 登录布局
│   ├── router/                # 路由配置
│   │   ├── index.ts           # 路由主文件
│   │   ├── guards.ts          # 路由守卫
│   │   └── routes/            # 路由定义
│   ├── stores/                # Pinia状态管理
│   │   ├── auth.ts            # 认证状态
│   │   ├── permission.ts      # 权限状态
│   │   ├── user.ts            # 用户状态
│   │   └── app.ts             # 应用状态
│   ├── types/                 # TypeScript类型
│   │   ├── api.ts             # API类型
│   │   ├── user.ts            # 用户类型
│   │   ├── vehicle.ts         # 车辆类型
│   │   └── common.ts          # 通用类型
│   ├── utils/                 # 工具函数
│   │   ├── request.ts         # HTTP请求
│   │   ├── auth.ts            # 认证工具
│   │   ├── format.ts          # 格式化工具
│   │   └── validation.ts      # 验证工具
│   └── views/                 # 页面组件
│       ├── login/             # 登录页面
│       ├── dashboard/         # 工作台
│       ├── users/             # 用户管理
│       ├── vehicles/          # 车辆管理
│       ├── orders/            # 订单管理
│       └── system/            # 系统管理
```

---

## 3. 权限控制系统开发

### 3.1 权限数据结构

```typescript
// types/permission.ts
export interface Permission {
  id: string
  code: string
  name: string
  type: 'menu' | 'button' | 'api'
  parentId?: string
  path?: string
  icon?: string
  sort: number
}

export interface Role {
  id: string
  name: string
  code: string
  permissions: Permission[]
  dataScope: DataScope
}

export interface DataScope {
  type: 'all' | 'region' | 'store' | 'self'
  regionIds?: string[]
  storeIds?: string[]
}
```

### 3.2 权限Store实现

```typescript
// stores/permission.ts
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import type { Permission, Role } from '@/types/permission'

export const usePermissionStore = defineStore('permission', () => {
  // 状态
  const permissions = ref<Permission[]>([])
  const roles = ref<Role[]>([])
  const routes = ref<any[]>([])

  // 计算属性
  const permissionCodes = computed(() =>
    permissions.value.map(p => p.code)
  )

  const menuPermissions = computed(() =>
    permissions.value.filter(p => p.type === 'menu')
  )

  // 方法
  const hasPermission = (code: string | string[]) => {
    if (!code) return true

    const codes = Array.isArray(code) ? code : [code]
    return codes.every(c => permissionCodes.value.includes(c))
  }

  const hasAnyPermission = (codes: string[]) => {
    return codes.some(c => permissionCodes.value.includes(c))
  }

  const setPermissions = (permissionList: Permission[]) => {
    permissions.value = permissionList
  }

  const setRoles = (roleList: Role[]) => {
    roles.value = roleList
  }

  const generateRoutes = () => {
    // 基于权限生成路由
    const filteredRoutes = filterRoutesByPermission(asyncRoutes, permissions.value)
    routes.value = filteredRoutes
    return filteredRoutes
  }

  return {
    permissions,
    roles,
    routes,
    permissionCodes,
    menuPermissions,
    hasPermission,
    hasAnyPermission,
    setPermissions,
    setRoles,
    generateRoutes
  }
})
```

### 3.3 权限指令

```typescript
// directives/permission.ts
import type { App, Directive } from 'vue'
import { usePermissionStore } from '@/stores/permission'

const permission: Directive = {
  mounted(el, binding) {
    const { value } = binding
    const permissionStore = usePermissionStore()

    if (value && !permissionStore.hasPermission(value)) {
      el.style.display = 'none'
      // 或者完全移除元素
      // el.parentNode?.removeChild(el)
    }
  },
  updated(el, binding) {
    const { value, oldValue } = binding
    if (value !== oldValue) {
      const permissionStore = usePermissionStore()
      if (value && !permissionStore.hasPermission(value)) {
        el.style.display = 'none'
      } else {
        el.style.display = ''
      }
    }
  }
}

export function setupPermissionDirective(app: App) {
  app.directive('permission', permission)
}
```

### 3.4 权限组件使用

```vue
<template>
  <!-- 指令方式 -->
  <el-button v-permission="'user:create'" type="primary">
    创建用户
  </el-button>

  <!-- 组件方式 -->
  <PermissionWrapper code="user:edit">
    <el-button type="warning">编辑</el-button>
  </PermissionWrapper>

  <!-- 多个权限 -->
  <el-button v-permission="['user:edit', 'user:delete']">
    操作
  </el-button>

  <!-- 任一权限 -->
  <el-button v-if="hasAnyPermission(['admin', 'user:edit'])">
    管理操作
  </el-button>
</template>

<script setup lang="ts">
import { usePermissionStore } from '@/stores/permission'

const permissionStore = usePermissionStore()

const hasAnyPermission = (codes: string[]) => {
  return permissionStore.hasAnyPermission(codes)
}
</script>
```

---

## 4. 页面开发规范

### 4.1 标准页面结构

```vue
<template>
  <div class="page-container">
    <!-- 页面头部 -->
    <div class="page-header">
      <div class="page-title">
        <h2>{{ title }}</h2>
        <el-breadcrumb separator="/">
          <el-breadcrumb-item
            v-for="item in breadcrumb"
            :key="item.path"
            :to="item.path"
          >
            {{ item.title }}
          </el-breadcrumb-item>
        </el-breadcrumb>
      </div>

      <div class="page-actions">
        <el-button
          v-permission="addPermission"
          type="primary"
          @click="handleAdd"
        >
          新增
        </el-button>
        <el-button @click="handleRefresh">刷新</el-button>
      </div>
    </div>

    <!-- 搜索区域 -->
    <el-card class="search-card">
      <SearchForm
        v-model="searchForm"
        :fields="searchFields"
        @search="handleSearch"
        @reset="handleReset"
      />
    </el-card>

    <!-- 数据表格 -->
    <el-card class="table-card">
      <DataTable
        v-loading="loading"
        :data="tableData"
        :columns="tableColumns"
        :pagination="pagination"
        @selection-change="handleSelectionChange"
        @page-change="handlePageChange"
        @size-change="handleSizeChange"
      >
        <template #actions="{ row }">
          <el-button
            v-permission="editPermission"
            size="small"
            @click="handleEdit(row)"
          >
            编辑
          </el-button>
          <el-button
            v-permission="deletePermission"
            size="small"
            type="danger"
            @click="handleDelete(row)"
          >
            删除
          </el-button>
        </template>
      </DataTable>
    </el-card>

    <!-- 编辑弹窗 -->
    <EditDialog
      v-model="dialogVisible"
      :form-data="formData"
      @submit="handleSubmit"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, computed } from 'vue'
import { useRoute } from 'vue-router'
import { usePermissionStore } from '@/stores/permission'
import { useTable } from '@/composables/useTable'
import SearchForm from '@/components/common/SearchForm.vue'
import DataTable from '@/components/common/DataTable.vue'
import EditDialog from './components/EditDialog.vue'

// 权限控制
const permissionStore = usePermissionStore()

// 页面配置
const title = '用户管理'
const addPermission = 'user:create'
const editPermission = 'user:edit'
const deletePermission = 'user:delete'

// 面包屑
const breadcrumb = computed(() => [
  { title: '首页', path: '/dashboard' },
  { title: '用户管理', path: '/users' }
])

// 表格相关逻辑
const {
  loading,
  tableData,
  pagination,
  searchForm,
  handleSearch,
  handleReset,
  handlePageChange,
  handleSizeChange,
  handleSelectionChange,
  fetchData
} = useTable()

// 搜索字段配置
const searchFields = [
  {
    prop: 'name',
    label: '用户名',
    type: 'input',
    placeholder: '请输入用户名'
  },
  {
    prop: 'status',
    label: '状态',
    type: 'select',
    options: [
      { label: '全部', value: '' },
      { label: '启用', value: 'active' },
      { label: '禁用', value: 'inactive' }
    ]
  }
]

// 表格列配置
const tableColumns = [
  { prop: 'id', label: 'ID', width: 80 },
  { prop: 'name', label: '用户名', width: 120 },
  { prop: 'email', label: '邮箱', width: 200 },
  { prop: 'role', label: '角色', width: 100 },
  { prop: 'status', label: '状态', width: 100 },
  { prop: 'createdAt', label: '创建时间', width: 180 }
]

// 弹窗控制
const dialogVisible = ref(false)
const formData = ref({})

// 方法
const handleAdd = () => {
  formData.value = {}
  dialogVisible.value = true
}

const handleEdit = (row: any) => {
  formData.value = { ...row }
  dialogVisible.value = true
}

const handleDelete = async (row: any) => {
  try {
    await ElMessageBox.confirm('确定要删除该用户吗？', '提示', {
      type: 'warning'
    })

    // 调用删除API
    await userApi.delete(row.id)

    ElMessage.success('删除成功')
    fetchData()
  } catch (error) {
    // 用户取消或删除失败
  }
}

const handleSubmit = async (data: any) => {
  try {
    if (data.id) {
      await userApi.update(data.id, data)
      ElMessage.success('更新成功')
    } else {
      await userApi.create(data)
      ElMessage.success('创建成功')
    }

    dialogVisible.value = false
    fetchData()
  } catch (error) {
    ElMessage.error('操作失败')
  }
}

const handleRefresh = () => {
  fetchData()
}

// 生命周期
onMounted(() => {
  fetchData()
})
</script>

<style scoped lang="scss">
.page-container {
  padding: 20px;
}

.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.page-title {
  h2 {
    margin: 0 0 8px 0;
    font-size: 20px;
    font-weight: 500;
  }
}

.search-card {
  margin-bottom: 20px;
}

.table-card {
  .el-card__body {
    padding: 0;
  }
}
</style>
```

---

## 5. 组件开发规范

### 5.1 通用组件 - DataTable

```vue
<!-- components/common/DataTable.vue -->
<template>
  <div class="data-table">
    <el-table
      v-bind="$attrs"
      :data="data"
      :loading="loading"
      @selection-change="handleSelectionChange"
    >
      <!-- 选择列 -->
      <el-table-column
        v-if="selectable"
        type="selection"
        width="55"
        :reserve-selection="true"
      />

      <!-- 序号列 -->
      <el-table-column
        v-if="showIndex"
        type="index"
        label="序号"
        width="60"
        :index="indexMethod"
      />

      <!-- 数据列 -->
      <el-table-column
        v-for="column in columns"
        :key="column.prop"
        :prop="column.prop"
        :label="column.label"
        :width="column.width"
        :min-width="column.minWidth"
        :fixed="column.fixed"
        :formatter="column.formatter"
      >
        <template #default="scope" v-if="column.slot">
          <slot :name="column.slot" v-bind="scope" />
        </template>
      </el-table-column>

      <!-- 操作列 -->
      <el-table-column
        v-if="$slots.actions"
        label="操作"
        :width="actionWidth"
        :fixed="actionFixed"
      >
        <template #default="scope">
          <slot name="actions" v-bind="scope" />
        </template>
      </el-table-column>
    </el-table>

    <!-- 分页 -->
    <el-pagination
      v-if="pagination"
      class="pagination"
      :current-page="pagination.page"
      :page-size="pagination.size"
      :page-sizes="pagination.sizes"
      :total="pagination.total"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handleCurrentChange"
    />
  </div>
</template>

<script setup lang="ts">
import { computed } from 'vue'

interface Props {
  data: any[]
  loading?: boolean
  columns: any[]
  pagination?: {
    page: number
    size: number
    total: number
    sizes?: number[]
  }
  selectable?: boolean
  showIndex?: boolean
  actionWidth?: number
  actionFixed?: boolean | 'left' | 'right'
}

interface Emits {
  (e: 'selection-change', selection: any[]): void
  (e: 'page-change', page: number): void
  (e: 'size-change', size: number): void
}

const props = withDefaults(defineProps<Props>(), {
  loading: false,
  selectable: false,
  showIndex: true,
  actionWidth: 200,
  actionFixed: 'right'
})

const emit = defineEmits<Emits>()

// 计算序号
const indexMethod = (index: number) => {
  if (props.pagination) {
    return (props.pagination.page - 1) * props.pagination.size + index + 1
  }
  return index + 1
}

// 事件处理
const handleSelectionChange = (selection: any[]) => {
  emit('selection-change', selection)
}

const handleCurrentChange = (page: number) => {
  emit('page-change', page)
}

const handleSizeChange = (size: number) => {
  emit('size-change', size)
}
</script>

<style scoped lang="scss">
.data-table {
  .el-table {
    width: 100%;
  }

  .pagination {
    display: flex;
    justify-content: center;
    padding: 20px 0;
  }
}
</style>
```

### 5.2 通用组件 - SearchForm

```vue
<!-- components/common/SearchForm.vue -->
<template>
  <el-form
    ref="formRef"
    :model="formData"
    :inline="true"
    label-width="80px"
    class="search-form"
  >
    <el-form-item
      v-for="field in fields"
      :key="field.prop"
      :label="field.label"
      :prop="field.prop"
    >
      <!-- 输入框 -->
      <el-input
        v-if="field.type === 'input'"
        v-model="formData[field.prop]"
        :placeholder="field.placeholder"
        clearable
        @keyup.enter="handleSearch"
      />

      <!-- 选择器 -->
      <el-select
        v-if="field.type === 'select'"
        v-model="formData[field.prop]"
        :placeholder="field.placeholder"
        clearable
      >
        <el-option
          v-for="option in field.options"
          :key="option.value"
          :label="option.label"
          :value="option.value"
        />
      </el-select>

      <!-- 日期选择器 -->
      <el-date-picker
        v-if="field.type === 'date'"
        v-model="formData[field.prop]"
        type="date"
        :placeholder="field.placeholder"
        clearable
      />

      <!-- 日期范围选择器 -->
      <el-date-picker
        v-if="field.type === 'daterange'"
        v-model="formData[field.prop]"
        type="daterange"
        range-separator="至"
        start-placeholder="开始日期"
        end-placeholder="结束日期"
        clearable
      />
    </el-form-item>

    <el-form-item>
      <el-button type="primary" @click="handleSearch">
        搜索
      </el-button>
      <el-button @click="handleReset">
        重置
      </el-button>
    </el-form-item>
  </el-form>
</template>

<script setup lang="ts">
import { ref, reactive, watch } from 'vue'
import type { FormInstance } from 'element-plus'

interface SearchField {
  prop: string
  label: string
  type: 'input' | 'select' | 'date' | 'daterange'
  placeholder?: string
  options?: Array<{ label: string; value: any }>
}

interface Props {
  fields: SearchField[]
  modelValue: Record<string, any>
}

interface Emits {
  (e: 'update:modelValue', value: Record<string, any>): void
  (e: 'search'): void
  (e: 'reset'): void
}

const props = defineProps<Props>()
const emit = defineEmits<Emits>()

const formRef = ref<FormInstance>()

// 表单数据
const formData = reactive<Record<string, any>>({})

// 初始化表单数据
const initFormData = () => {
  props.fields.forEach(field => {
    formData[field.prop] = props.modelValue[field.prop] || ''
  })
}

// 监听外部数据变化
watch(() => props.modelValue, (newVal) => {
  Object.assign(formData, newVal)
}, { deep: true })

// 监听表单数据变化
watch(formData, (newVal) => {
  emit('update:modelValue', { ...newVal })
}, { deep: true })

// 搜索
const handleSearch = () => {
  emit('search')
}

// 重置
const handleReset = () => {
  formRef.value?.resetFields()
  props.fields.forEach(field => {
    formData[field.prop] = ''
  })
  emit('reset')
}

// 初始化
initFormData()
</script>

<style scoped lang="scss">
.search-form {
  .el-form-item {
    margin-bottom: 0;
  }
}
</style>
```

---

## 6. API接口开发规范

### 6.1 API接口封装

```typescript
// api/modules/user.ts
import request from '@/utils/request'
import type { User, UserQueryParams, CreateUserDto, UpdateUserDto } from '@/types/user'

export const userApi = {
  // 获取用户列表
  getList: (params: UserQueryParams) => {
    return request.get<ApiResponse<User[]>>('/api/v1/users', { params })
  },

  // 获取用户详情
  getDetail: (id: string) => {
    return request.get<ApiResponse<User>>(`/api/v1/users/${id}`)
  },

  // 创建用户
  create: (data: CreateUserDto) => {
    return request.post<ApiResponse<User>>('/api/v1/users', data)
  },

  // 更新用户
  update: (id: string, data: UpdateUserDto) => {
    return request.put<ApiResponse<User>>(`/api/v1/users/${id}`, data)
  },

  // 删除用户
  delete: (id: string) => {
    return request.delete<ApiResponse<null>>(`/api/v1/users/${id}`)
  },

  // 批量删除
  batchDelete: (ids: string[]) => {
    return request.post<ApiResponse<null>>('/api/v1/users/batch-delete', { ids })
  },

  // 更新状态
  updateStatus: (id: string, status: string) => {
    return request.patch<ApiResponse<null>>(`/api/v1/users/${id}/status`, { status })
  }
}
```

### 6.2 请求拦截器配置

```typescript
// utils/request.ts
import axios, { AxiosError, AxiosResponse } from 'axios'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useAuthStore } from '@/stores/auth'
import router from '@/router'

// 创建axios实例
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()

    // 添加token
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }

    // 添加请求ID
    config.headers['X-Request-ID'] = generateRequestId()

    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  (response: AxiosResponse) => {
    const { data } = response

    // API响应格式检查
    if (data.code !== 0) {
      ElMessage.error(data.message || '请求失败')
      return Promise.reject(new Error(data.message || '请求失败'))
    }

    return data
  },
  async (error: AxiosError) => {
    const { response } = error

    if (response) {
      const { status, data } = response

      switch (status) {
        case 401:
          // Token过期或无效
          await ElMessageBox.confirm('登录状态已过期，请重新登录', '提示', {
            type: 'warning',
            confirmButtonText: '重新登录'
          })

          const authStore = useAuthStore()
          authStore.logout()
          router.push('/login')
          break

        case 403:
          ElMessage.error('没有权限访问该资源')
          break

        case 404:
          ElMessage.error('请求的资源不存在')
          break

        case 422:
          // 表单验证错误
          const errorMessage = (data as any)?.message || '参数验证失败'
          ElMessage.error(errorMessage)
          break

        case 500:
          ElMessage.error('服务器内部错误，请稍后重试')
          break

        default:
          ElMessage.error((data as any)?.message || '网络错误，请稍后重试')
      }
    } else {
      // 网络错误
      ElMessage.error('网络连接失败，请检查网络设置')
    }

    return Promise.reject(error)
  }
)

// 生成请求ID
function generateRequestId(): string {
  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`
}

export default request
```

---

## 7. 开发工具配置

### 7.1 VSCode工作区配置

```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  },
  "typescript.preferences.importModuleSpecifier": "relative",
  "emmet.includeLanguages": {
    "vue": "html"
  },
  "files.associations": {
    "*.vue": "vue"
  },
  "eslint.workingDirectories": ["admin-console"],
  "typescript.suggest.autoImports": true,
  "typescript.updateImportsOnFileMove.enabled": "always"
}
```

### 7.2 推荐VSCode插件

```json
// .vscode/extensions.json
{
  "recommendations": [
    "Vue.volar",
    "Vue.vscode-typescript-vue-plugin",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "ms-vscode.vscode-typescript-next",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense",
    "ms-vscode.vscode-json",
    "gruntfuggly.todo-tree"
  ]
}
```

### 7.3 代码质量配置

```javascript
// .eslintrc.js
module.exports = {
  root: true,
  env: {
    browser: true,
    es2021: true,
    node: true
  },
  extends: [
    'eslint:recommended',
    '@vue/typescript/recommended',
    '@vue/prettier',
    '@vue/prettier/@typescript-eslint'
  ],
  parserOptions: {
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    '@typescript-eslint/no-unused-vars': ['error', { argsIgnorePattern: '^_' }],
    '@typescript-eslint/explicit-function-return-type': 'off',
    '@typescript-eslint/explicit-module-boundary-types': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    'vue/multi-word-component-names': 'off',
    'vue/no-unused-components': 'warn'
  },
  overrides: [
    {
      files: ['**/__tests__/*.{j,t}s?(x)', '**/tests/unit/**/*.spec.{j,t}s?(x)'],
      env: {
        jest: true
      }
    }
  ]
}
```

---

## 8. 测试开发规范

### 8.1 单元测试

```typescript
// tests/unit/components/DataTable.spec.ts
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import DataTable from '@/components/common/DataTable.vue'

describe('DataTable.vue', () => {
  const mockData = [
    { id: 1, name: '测试用户1', email: 'test1@example.com' },
    { id: 2, name: '测试用户2', email: 'test2@example.com' }
  ]

  const mockColumns = [
    { prop: 'id', label: 'ID' },
    { prop: 'name', label: '姓名' },
    { prop: 'email', label: '邮箱' }
  ]

  it('renders table with correct data', () => {
    const wrapper = mount(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns
      }
    })

    const rows = wrapper.findAll('.el-table__row')
    expect(rows).toHaveLength(2)
  })

  it('emits selection-change event when selection changes', async () => {
    const wrapper = mount(DataTable, {
      props: {
        data: mockData,
        columns: mockColumns,
        selectable: true
      }
    })

    await wrapper.find('.el-checkbox__input').setValue(true)

    expect(wrapper.emitted('selection-change')).toBeTruthy()
  })
})
```

### 8.2 组件测试

```typescript
// tests/unit/composables/usePermission.spec.ts
import { describe, it, expect, beforeEach } from 'vitest'
import { setActivePinia, createPinia } from 'pinia'
import { usePermissionStore } from '@/stores/permission'

describe('usePermission', () => {
  beforeEach(() => {
    setActivePinia(createPinia())
  })

  it('should check permission correctly', () => {
    const store = usePermissionStore()

    store.setPermissions([
      { code: 'user:view', type: 'button' as const },
      { code: 'user:create', type: 'button' as const }
    ])

    expect(store.hasPermission('user:view')).toBe(true)
    expect(store.hasPermission('user:edit')).toBe(false)
    expect(store.hasPermission(['user:view', 'user:create'])).toBe(true)
    expect(store.hasAnyPermission(['user:edit', 'user:create'])).toBe(true)
  })
})
```

---

## 9. 构建和部署

### 9.1 构建配置优化

```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    vue(),
    process.env.ANALYZE && visualizer({
      filename: 'dist/stats.html',
      open: true
    })
  ].filter(Boolean),

  resolve: {
    alias: {
      '@': resolve(__dirname, 'src')
    }
  },

  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@use "@/styles/variables" as *;`
      }
    }
  },

  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,

    rollupOptions: {
      output: {
        manualChunks: {
          // 基础框架
          'vue-vendor': ['vue', 'vue-router', 'pinia'],

          // UI组件库
          'element-plus': ['element-plus'],

          // 工具库
          'utils': ['lodash-es', 'dayjs', 'axios'],

          // 图表库
          'charts': ['echarts']
        }
      }
    },

    chunkSizeWarningLimit: 1000
  },

  server: {
    port: 5173,
    open: true,
    cors: true,

    proxy: {
      '/api': {
        target: 'http://localhost:3000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  },

  define: {
    __VUE_I18N_FULL_INSTALL__: true,
    __VUE_I18N_LEGACY_API__: false,
    __INTLIFY_PROD_DEVTOOLS__: false
  }
})
```

### 9.2 Docker部署配置

```dockerfile
# Dockerfile
# 多阶段构建
FROM node:18-alpine as builder

WORKDIR /app

# 复制package文件
COPY package*.json ./
RUN npm ci --only=production

# 复制源代码
COPY . .

# 构建应用
RUN npm run build

# 生产镜像
FROM nginx:alpine

# 复制构建结果
COPY --from=builder /app/dist /usr/share/nginx/html

# 复制nginx配置
COPY nginx.conf /etc/nginx/nginx.conf

# 暴露端口
EXPOSE 80

# 启动nginx
CMD ["nginx", "-g", "daemon off;"]
```

```nginx
# nginx.conf
events {
    worker_connections 1024;
}

http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # Gzip压缩
        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

        # 处理前端路由
        location / {
            try_files $uri $uri/ /index.html;
        }

        # API代理
        location /api/ {
            proxy_pass http://backend:3000/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # 静态资源缓存
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
}
```

---

## 10. 常见问题解决

### 10.1 开发环境问题

**Q: Element Plus组件样式不生效**
```bash
# 检查样式导入
# main.ts
import 'element-plus/dist/index.css'
import 'element-plus/theme-chalk/dark/css-vars.css'
```

**Q: TypeScript类型错误**
```bash
# 清理缓存并重新安装
rm -rf node_modules package-lock.json
npm install

# 重新生成类型
npm run type-check
```

**Q: 权限指令不生效**
```typescript
// 检查指令注册
// main.ts
import { setupPermissionDirective } from '@/directives/permission'

const app = createApp(App)
setupPermissionDirective(app)
```

### 10.2 构建问题

**Q: 构建包体积过大**
```typescript
// vite.config.ts
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'element-plus': ['element-plus'],
          'vendor': ['vue', 'vue-router', 'pinia']
        }
      }
    }
  }
})
```

---

## 11. 最佳实践

### 11.1 性能优化

1. **组件懒加载**
2. **图片懒加载**
3. **虚拟滚动**
4. **代码分割**
5. **缓存策略**

### 11.2 代码质量

1. **TypeScript严格模式**
2. **ESLint规则检查**
3. **单元测试覆盖**
4. **代码审查流程**
5. **自动化CI/CD**

### 11.3 安全实践

1. **输入验证**
2. **XSS防护**
3. **CSRF防护**
4. **敏感信息保护**
5. **权限验证**

---

## 12. 技术支持

### 12.1 文档资源

- [Vue 3官方文档](https://vuejs.org/)
- [Element Plus组件库](https://element-plus.org/)
- [Pinia状态管理](https://pinia.vuejs.org/)
- [Vite构建工具](https://vitejs.dev/)

### 12.2 开发工具

- **Vue DevTools**: 浏览器扩展，用于调试Vue应用
- **TypeScript编译器**: 类型检查和编译
- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化

### 12.3 问题反馈

- **Bug报告**: 提交Issue到项目仓库
- **功能建议**: 提交Feature Request
- **技术讨论**: 项目讨论区

---

**提示**: 开发前请务必阅读项目根目录的 `CLAUDE.md` 了解整体开发规范。